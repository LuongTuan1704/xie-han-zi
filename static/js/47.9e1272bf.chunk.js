"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[47],{9047:function(e,t,n){n.r(t),n.d(t,{default:function(){return X}});var a=n(4165),r=n(5861),i=n(9439),s=n(1413),o=n(2751),c=n(4491),l=n(807),p=n(7313),d=n(5859),u=n(259),f=n(1309),h=n(5476),_="Sidebar_Note_wrapper__5iR0R",x="Sidebar_Note_paginations-wrapper__k4gZE",m="Sidebar_Note_pagination-input-wrraper__UJtcw",g="Sidebar_Note_paginations-modify-page-input__Qi7gP",y="Sidebar_Note_input-wrraper__yyQSL",Z="Sidebar_Note_input__2XH9t",b=n(771),v=n(7241);function w(e,t,n){return E.apply(this,arguments)}function E(){return(E=(0,r.Z)((0,a.Z)().mark((function e(t,n,r){var i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.itemPerPage,t-1<0&&(t=1),e.next=4,b.Db.folders.orderBy("id").offset((t-1)*i).limit(i).toArray();case 4:s=e.sent,r({type:"go_to_page",playload:{data:s,toPage:t}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r,i,s,o,c,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.db_name,r=void 0===n?"folders":n,i=t.paginations,s=i.page,o=i.itemPerPage,e.next=4,b.Db[r].orderBy("id").offset((s-1)*o).limit(o).toArray();case 4:return c=e.sent,e.next=7,b.Db[r].count();case 7:return l=e.sent,p=Math.ceil(l/o),e.abrupt("return",Promise.resolve({data:c,paginations:{toltalPage:p,toltalRecords:l}}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return P.apply(this,arguments)}function P(){return(P=(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.Db.folders.orderBy("id").toArray();case 2:return t=e.sent,e.abrupt("return",Promise.resolve(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return O.apply(this,arguments)}function O(){return(O=(0,r.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.Db.folders.orderBy("id").toArray();case 2:return n=e.sent,n=(0,v.OZ)(n,"name",t),e.abrupt("return",Promise.resolve(n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return A.apply(this,arguments)}function A(){return(A=(0,r.Z)((0,a.Z)().mark((function e(t,n){var r,i,s,o,c,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.path,i=t.type,s=t.paginations,o=n._id,c=n.name,l=r.split("/"),p=l[0],e.t0=i,e.next="CREATE_FOLDER_AT_ROOT"===e.t0?7:"CREATE_FILE_AT_ROOT"===e.t0?10:"CREATE_FOLDER"===e.t0?15:"CREATE_FILE"===e.t0?23:29;break;case 7:return e.next=9,b.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 9:case 14:case 18:return e.abrupt("return",k({db_name:"folders",paginations:s}));case 10:return e.next=12,b.Db.folders.add({_id:o,path:o,name:c});case 12:return e.next=14,b.Db.files.add({_id:o,data:""});case 15:if(r){e.next=19;break}return e.next=18,b.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 19:return e.next=21,b.Db.folders.where("_id").equals(p).modify((function(e){var t=(0,v.nG)([e],l,"_id");console.log("refObj ",t),t.children.push({_id:o,path:"".concat(r,"/").concat(o),isFolder:!0,name:c,children:[]})})).then((function(){return k({db_name:"folders",paginations:s})}));case 21:return d=e.sent,e.abrupt("return",d);case 23:return e.next=25,b.Db.folders.where("_id").equals(p).modify((function(e){(0,v.nG)([e],l,"_id").children.push({_id:o,path:"".concat(r,"/").concat(o),name:c})})).then((function(){return k({db_name:"folders",paginations:s})}));case 25:return d=e.sent,e.next=28,b.Db.files.add({_id:o,data:""});case 28:return e.abrupt("return",d);case 29:throw new Error("invalid action type!");case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return L.apply(this,arguments)}function L(){return(L=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r,i,s,o,c,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,r=t.type,i=t.paginations,s=n.split("/"),o=s.length-1,c=s[0],e.next=6,b.Db.folders.where("_id").equals(c).first();case 6:l=e.sent,e.t0=r,e.next="DELETE_FOLDER"===e.t0?10:"DELETE_FILE"===e.t0?21:31;break;case 10:if(c!==s[o]){e.next=16;break}return e.next=13,b.Db.folders.where("_id").equals(c).delete();case 13:p=(0,v.x_)([l],"_id"),e.next=18;break;case 16:return e.next=18,b.Db.folders.where("_id").equals(c).modify((function(e){var t=(0,v.nG)([e],s.slice(0,o),"_id");t.children=t.children.filter((function(e){return e._id!==s[o]})),p=(0,v.x_)([t],"_id")}));case 18:return e.next=20,b.Db.files.where("_id").anyOf(p).delete();case 20:case 30:return e.abrupt("return",k({db_name:"folders",paginations:i}));case 21:if(c!==s[o]){e.next=26;break}return e.next=24,b.Db.folders.where("_id").equals(c).delete();case 24:e.next=28;break;case 26:return e.next=28,b.Db.folders.where("_id").equals(c).modify((function(e){var t=(0,v.nG)([e],s.slice(0,o),"_id");t.children=t.children.filter((function(e){return e._id!==s[o]}))}));case 28:return e.next=30,b.Db.files.where("_id").equals(s[o]).delete();case 31:throw new Error("invalid action type!");case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return T.apply(this,arguments)}function T(){return(T=(0,r.Z)((0,a.Z)().mark((function e(t,n){var r,i,s,o,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.path,i=t.paginations,s=r.split("/"),o=s[0],c=s.length-1,o!==s[c]){e.next=9;break}return e.next=7,b.Db.folders.where("_id").equals(o).modify((function(e){e.name=n}));case 7:e.next=11;break;case 9:return e.next=11,b.Db.folders.where("_id").equals(o).modify((function(e){(0,v.nG)([e],s,"_id").name=n}));case 11:return e.abrupt("return",k({db_name:"folders",paginations:i}));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=n(4942),I=n(4976),G=n(6016),q="List_wrapper__vkZ3n",W="List_item__A5fJI",B="List_main__nuAi5",J="List_title__HdbVJ",M="List_item_icon__OmPkR",V=n(6417),H=function(e){var t=(0,p.useContext)(I.Ut),n=(0,p.useState)({}),_=(0,i.Z)(n,2),x=_[0],m=_[1],g=(0,p.useState)({type:"CREATE_FILE",isShow:!1}),y=(0,i.Z)(g,2),Z=y[0],b=y[1],v=e.item,w=e.dispatch,E=e.paginations,k=e.displayChildren,j=e.setDisplayChildren;return(0,V.jsxs)("li",{className:W,onClick:function(e){e.stopPropagation(),v.children?j((0,s.Z)((0,s.Z)({},k),{},(0,F.Z)({},v._id,!k[v._id]))):t.onclickSubItem(v)},children:[(0,V.jsx)(l.W4,{id:"#".concat(v._id),children:(0,V.jsxs)("div",{className:B,children:[(0,V.jsx)("div",{className:M,children:v.children?k[v._id]?(0,V.jsx)(u.G,{color:"#eab308",icon:f.cC_}):(0,V.jsx)(u.G,{color:"#ca8a04",icon:f.Pk}):(0,V.jsx)(u.G,{color:"#f1f5f9",icon:f.gMD})}),x._id===v._id?(0,V.jsx)(d.Z,{tabIndex:-1,autoFocus:!0,styleWrapper:h.Z["input-wrraper"],className:h.Z.input,onEnterPress:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),!t.target.value){e.next=10;break}return e.next=4,S({path:v.path,paginations:E},t.target.value);case 4:n=e.sent,w({playload:{paginations:n.paginations,data:n.data}}),m({}),console.log("renamed"),e.next=11;break;case 10:m({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}):(0,V.jsx)("div",{className:J,title:v.name,children:v.name})]})}),(0,V.jsxs)(l.xV,{id:"#".concat(v._id),className:h.Z.context_menu_warpper,children:[v.children&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)(l.sN,{className:h.Z.context_menu_item,onClick:function(e){e.stopPropagation(),!k[v._id]&&j((0,s.Z)((0,s.Z)({},k),{},(0,F.Z)({},v._id,!k[v._id]))),b({showAt:v._id,type:"CREATE_FILE",placeholder:"create new file",path:v.path,isShow:!0})},children:[(0,V.jsx)(u.G,{icon:f.b7h})," ",(0,V.jsx)("span",{children:"new file"})]}),(0,V.jsxs)(l.sN,{className:h.Z.context_menu_item,onClick:function(e){e.stopPropagation(),!k[v._id]&&j((0,s.Z)((0,s.Z)({},k),{},(0,F.Z)({},v._id,!k[v._id]))),b({showAt:v._id,type:"CREATE_FOLDER",placeholder:"create new group",path:v.path,isShow:!0})},children:[(0,V.jsx)(u.G,{color:"#ca8a04",icon:f.x58})," ",(0,V.jsx)("span",{children:"new group"})]})]}),(0,V.jsxs)(l.sN,{className:h.Z.context_menu_item,onClick:function(e){e.stopPropagation(),m({_id:v._id})},children:[(0,V.jsx)(u.G,{color:"#1db489",icon:f.BKg})," ",(0,V.jsx)("span",{children:"rename"})]}),(0,V.jsxs)(l.sN,{className:h.Z.context_menu_item,onClick:function(e){e.stopPropagation(),(0,c.Am)((0,V.jsx)(G.Z,{customMsg:"".concat(v.name),fn:(0,r.Z)((0,a.Z)().mark((function e(){var t,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.isFolder?"DELETE_FOLDER":"DELETE_FILE",e.next=3,C({path:v.path,type:t,paginations:E});case 3:n=e.sent,w({playload:{paginations:n.paginations,data:n.data}});case 5:case"end":return e.stop()}}),e)})))}))},children:[(0,V.jsx)(u.G,{color:"#b91c1c",icon:f.Vui})," ",(0,V.jsx)("span",{children:"remove"})]})]}),k[v._id]&&v.children&&(0,V.jsxs)(V.Fragment,{children:[Z.isShow&&Z.showAt===v._id&&(0,V.jsx)(d.Z,{tabIndex:-1,styleWrapper:h.Z["input-wrraper"],className:h.Z.input,type:"text",placeholder:"".concat(Z.placeholder),autoFocus:!0,onEnterPress:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),!t.target.value){e.next=10;break}return n=(0,o.x0)(5),e.next=5,R({path:Z.path,type:Z.type,paginations:E},{_id:n,name:t.target.value});case 5:r=e.sent,w({playload:{paginations:r.paginations,data:r.data}}),b({}),e.next=11;break;case 10:b({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,V.jsx)(z,{dispatch:w,paginations:E,items:v.children})]})]},v._id)};function z(e){var t=e.dispatch,n=e.paginations,a=e.items;console.log("list folder - render!!!");var r=(0,p.useState)((function(){return JSON.parse(localStorage.getItem("folders_state"))||{}})),s=(0,i.Z)(r,2),o=s[0],c=s[1];return(0,p.useEffect)((function(){localStorage.setItem("folders_state",JSON.stringify(o))}),[o]),(0,V.jsx)("ul",{className:q,children:a.map((function(e){return(0,V.jsx)(H,{item:e,dispatch:t,paginations:n,displayChildren:o,setDisplayChildren:c})}))})}var Q=z,U=function(e,t){return"go_to_page"===t.type?(0,s.Z)((0,s.Z)({},e),{},{paginations:(0,s.Z)((0,s.Z)({},e.paginations),{},{page:t.playload.toPage}),datas:t.playload.data}):(0,s.Z)((0,s.Z)({},e),{},{paginations:(0,s.Z)((0,s.Z)({},e.paginations),t.playload.paginations),datas:t.playload.data})},K={paginations:{page:1,itemPerPage:5,toltalPage:null,toltalRecords:null},datas:[]};var X=function(){var e=(0,p.useReducer)(U,K),t=(0,i.Z)(e,2),n=t[0],s=t[1],b=(0,p.useState)({}),E=(0,i.Z)(b,2),j=E[0],P=E[1];return(0,p.useEffect)((function(){(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k({db_name:"folders",paginations:n.paginations});case 2:t=e.sent,s({playload:{paginations:t.paginations,data:t.data}});case 4:case"end":return e.stop()}}),e)})))()}),[]),(0,V.jsxs)("div",{className:_,children:[(0,V.jsx)("div",{style:{flexGrow:1},children:(0,V.jsxs)(l.W4,{id:"#root-tree-folder",children:[(0,V.jsxs)("div",{style:{marginLeft:"-16px"},children:[(0,V.jsx)(Q,{dispatch:s,paginations:n.paginations,items:n.datas}),j.isShow&&(0,V.jsx)("div",{style:{paddingLeft:"16px"},children:(0,V.jsx)(d.Z,{tabIndex:-1,autoFocus:!0,styleWrapper:h.Z["input-wrraper"],className:h.Z.input,type:"text",placeholder:"".concat(j.placeholder),onEnterPress:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),!t.target.value.trim()){e.next=17;break}return r=(0,o.x0)(5),e.prev=3,e.next=6,R({path:"",type:j.type,paginations:n.paginations},{_id:r,name:t.target.value});case 6:i=e.sent,s({playload:{paginations:i.paginations,data:i.data}}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),c.Am.error("[".concat(t.target.value,"] already exists!"),{POSITION:c.Am.POSITION.BOTTOM_RIGHT}),P({});case 14:P({}),e.next=18;break;case 17:P({});case 18:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()})})]}),(0,V.jsxs)(l.xV,{id:"#root-tree-folder",className:h.Z.context_menu_warpper,children:[(0,V.jsxs)(l.sN,{className:h.Z.context_menu_item,onClick:function(e){e.stopPropagation(),P({type:"CREATE_FILE_AT_ROOT",placeholder:"create a new file",isShow:!0})},children:[(0,V.jsx)(u.G,{icon:f.b7h}),(0,V.jsx)("span",{children:"new file"})]}),(0,V.jsxs)(l.sN,{className:h.Z.context_menu_item,onClick:function(e){e.stopPropagation(),P({type:"CREATE_FOLDER_AT_ROOT",placeholder:"create a new folder",isShow:!0})},children:[(0,V.jsx)(u.G,{color:"#ca8a04",icon:f.x58}),(0,V.jsx)("span",{children:"new group"})]})]})]})}),(0,V.jsxs)("form",{style:{display:"flex",alignItems:"center"},onSubmit:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(r=(0,v.Fm)(t))["f-global"]){e.next=23;break}if(!["/All","/all"].includes(r["find-v"])){e.next=12;break}return e.t0=s,e.t1=n.paginations,e.next=8,N();case 8:e.t2=e.sent,e.t3={paginations:e.t1,data:e.t2},e.t4={playload:e.t3},(0,e.t0)(e.t4);case 12:if(!r["find-v"].trim()){e.next=21;break}return e.t5=s,e.t6=n.paginations,e.next=17,D(r["find-v"]);case 17:e.t7=e.sent,e.t8={paginations:e.t6,data:e.t7},e.t9={playload:e.t8},(0,e.t5)(e.t9);case 21:e.next=24;break;case 23:r["find-v"].trim()&&s({playload:{paginations:n.paginations,data:(0,v.OZ)(n.datas,"name",r["find-v"])}});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[(0,V.jsx)(d.Z,{styleWrapper:y,className:Z,name:"find-v",onEnterPress:function(){},placeholder:"Filter"}),(0,V.jsxs)("label",{children:[(0,V.jsx)("input",{type:"checkbox",defaultChecked:!0,name:"f-global"}),"-g"]})]}),(0,V.jsxs)("div",{className:x,children:[(0,V.jsx)(d.Z,{styleWrapper:m,className:g,type:"number",min:0,max:n.paginations.toltalPage,onEnterPress:function(e){+e.target.value<=e.target.max&&w(+e.target.value,n.paginations,s)},placeholder:n.paginations.page})," ","of ",n.paginations.toltalPage,"/",n.paginations.toltalRecords,(0,V.jsx)("button",{style:{marginLeft:"8px",cursor:"pointer"},onClick:function(){w(n.paginations.toltalPage,n.paginations,s)},children:"new"})]})]})}}}]);