"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[608],{7608:function(e,n,t){t.r(n),t.d(n,{default:function(){return Q}});var a=t(3433),r=t(4165),i=t(5861),o=t(9439),l=t(7313),c=t(4491),s=t(771),d=t(6250),u=t(259),p=t(1309),m="tab-controllers_wrapper__IrtVJ",f="tab-controllers_tabs__AKm3-",_="tab-controllers_btn-wrapper__QEJJ0",b="tab-controllers_tab_btn_wraper__Ca1p+",v="tab-controllers_tabActive__7wpT3",h="tab-controllers_tab_btn_delete__QJC4q",x="tab-controllers_tab_btn__-12lp",g=t(6417);var N=function(e){var n=e.tab_array,t=e.Viewer,a=e.onTabClose,r=e.edit_mode,i=e.Enable_fn,c=(0,l.useState)((function(){var e=JSON.parse(localStorage.getItem("tab_"));return null!==e&&void 0!==e&&e._id&&t(null===e||void 0===e?void 0:e._id),e||{}})),s=(0,o.Z)(c,2),d=s[0],N=s[1];return(0,l.useEffect)((function(){localStorage.setItem("tab_",JSON.stringify({tab:d.tab,isEdit:r}))}),[d,r]),(0,l.useEffect)((function(){var e=n[n.length-1];t(null===e||void 0===e?void 0:e._id),N({tab:e,isEdit:r})}),[n.length]),(0,g.jsx)(g.Fragment,{children:n.length?(0,g.jsxs)("div",{className:m,children:[(0,g.jsx)("div",{className:f,children:n.map((function(e){var n;return(0,g.jsxs)("div",{className:"".concat(b," ").concat((null===(n=d.tab)||void 0===n?void 0:n._id)===e._id?v:""),children:[(0,g.jsx)("button",{className:x,onClick:function(){N({tab:e,isEdit:r}),t(e._id)},children:e.name}),(0,g.jsx)("button",{className:h,onClick:function(){a(e,e._id===d.tab._id)},children:(0,g.jsx)(u.G,{icon:p.$9F})})]},e._id)}))}),(0,g.jsxs)("div",{className:_,children:[(0,g.jsx)("input",{id:"Enable_edit_mode",type:"checkbox",defaultChecked:r,onChange:function(e){i.toggleEditMode(e.target.checked,d.tab)}}),(0,g.jsx)("label",{htmlFor:"Enable_edit_mode",title:"edit content",children:(0,g.jsx)(u.G,{icon:p._3l})})]})]}):null})},j=t(3304),E=t(1413);var w=t(2751),y={"float-form-content":"EditPanel_float-form-content__7d6I6",textarea:"EditPanel_textarea__Y-fFr","btn-group":"EditPanel_btn-group__WpbJe","reset-btn":"EditPanel_reset-btn__zgL+0","add-btn":"EditPanel_add-btn__ubJG0",wrapper:"EditPanel_wrapper__JEjCk",header:"EditPanel_header__WyqGL","close-edit-menu":"EditPanel_close-edit-menu__y6mu3","tippy-wrapper":"EditPanel_tippy-wrapper__HbFJl","props-input":"EditPanel_props-input__4dIrq",text_input:"EditPanel_text_input__LBD2-",section_heading:"EditPanel_section_heading__LbMeB","flex-col":"EditPanel_flex-col__8cuOg","flex-row":"EditPanel_flex-row__ZPp2R","btn-remove-element":"EditPanel_btn-remove-element__7HhEn","group-btns":"EditPanel_group-btns__UyB6q","tag-btn":"EditPanel_tag-btn__ePvvC",row:"EditPanel_row__GRBOo","select-wrapper":"EditPanel_select-wrapper__qnUog",option:"EditPanel_option__ycASY","div-center":"EditPanel_div-center__CtiYt",buttons:"EditPanel_buttons__stwwF","checkbox-wrapper":"EditPanel_checkbox-wrapper__5i2N0",selecedElement:"EditPanel_selecedElement__QVSgz"};function k(e,n){var t=(0,l.useState)(!0),a=(0,o.Z)(t,2),r=a[0],i=a[1];(0,j.Z)(["Escape"],(function(e){console.log("".concat(e," has been pressed.")),i(!1)}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,j.Z)(["f"],(function(e){console.log("".concat(e," has been pressed.")),i(!0)}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,l.useImperativeHandle)(n,(function(){return{toggleForm:function(){i((function(e){return!e}))}}}));var c=(0,l.useRef)();return r&&(0,g.jsx)("div",{className:y["float-form-content"],children:(0,g.jsxs)("form",{onReset:function(e){e.preventDefault(),c.current.focus(),c.current.value=""},onSubmit:function(n){n.preventDefault(),function(n){var t=n.replaceAll("{",'<span data-text_view="true" >');t=(t=t.replaceAll("}","</span>")).replaceAll("\n","<br>"),e.TargetElement.insertAdjacentHTML("beforeend",t)}(c.current.value),c.current.value="",i(!1)},children:[(0,g.jsx)("textarea",{className:y.textarea,placeholder:"text here...",ref:c}),(0,g.jsxs)("div",{className:y["btn-group"],children:[(0,g.jsx)("button",{type:"submit",className:y["add-btn"],children:(0,g.jsx)(u.G,{icon:p.XSk})}),(0,g.jsx)("button",{type:"reset",className:y["reset-btn"],children:(0,g.jsx)(u.G,{icon:p.Vui})})]})]})})}var C=(0,l.forwardRef)(k),S="color_SelectColorPanel__5BMDV",T="color_header__fQVIU",O="color_header-radio-wrapper__TS1mA",A="color_main__XV7vN",Z="color_item-wrapper__Jytd2",I=["#fafafa","#0f172a","#111827","#18181b","#171717","#1c1917","#020617","#030712","#09090b","#0a0a0a","#0c0a09","#eab308","#ea580c","#3b82f6","#8b5cf6","#be123c","#ef4444","#cbd5e1","#d1d5db","#d4d4d8","#d4d4d4","#d6d3d1","#fca5a5","#fdba74","#fcd34d","#fde047","#86efac","#93c5fd","#a5b4fc","#d8b4fe","#fda4af","#0dcc821a","#0dcc822a","#0dcc82","#9c88ff1a","#9c88ff2a","#9c88ff","#64a6f51a","#64a6f52a","#64a6f5"],P=[{label:"color",prop:"color"},{label:"bg-color",prop:"backgroundColor"},{label:"br-color",prop:"borderColor"}];var R=function(e){var n=e.handleChangeElementStyles,t=(0,l.useState)(P[0]),a=(0,o.Z)(t,2),r=a[0],i=a[1];return(0,g.jsxs)("div",{className:S,children:[(0,g.jsx)("div",{className:T,children:P.map((function(e){return(0,g.jsxs)("div",{className:O,children:[(0,g.jsx)("input",{type:"radio",name:"props-item",value:e.prop,id:e.label,onChange:function(e){i(e.target.value)}}),(0,g.jsx)("label",{htmlFor:"".concat(e.label),children:e.label})]},e.label)}))}),(0,g.jsxs)("div",{className:A,children:[(0,g.jsxs)("div",{className:Z,children:[(0,g.jsx)("input",{type:"radio",name:"color-item",value:"unset",id:"unset-cl",onChange:function(e){n(r,e.target.value)}}),(0,g.jsx)("label",{htmlFor:"unset-cl",style:{backgroundColor:"unset",border:"2px solid var(--text-color)"}})]}),I.map((function(e){return(0,g.jsxs)("div",{className:Z,children:[(0,g.jsx)("input",{type:"radio",name:"color-item",value:e,id:e,onChange:function(e){n(r,e.target.value)}}),(0,g.jsx)("label",{htmlFor:"".concat(e),style:{backgroundColor:"".concat(e)}})]},e)}))]})]})},F=t(4346),L=[{id:(0,w.x0)(5),label:"display",propName:"display",options:["","flex","block"]},{id:(0,w.x0)(5),label:"gap",propName:"gap"},{id:(0,w.x0)(5),label:"justify-content",propName:"justifyContent",options:["","flex-start","center","flex-end"]},{id:(0,w.x0)(5),label:"align-items",propName:"alignItems",options:["","flex-start","center","flex-end"]},{id:(0,w.x0)(5),label:"Font size",propName:"fontSize"},{id:(0,w.x0)(5),label:"line height",propName:"lineHeight"},{id:(0,w.x0)(5),label:"text align",propName:"textAlign",options:["","left","center","right","justify"]},{id:(0,w.x0)(5),label:"margin",propName:"margin"},{id:(0,w.x0)(5),label:"padding",propName:"padding"},{id:(0,w.x0)(5),label:"border",propName:"border"},{id:(0,w.x0)(5),label:"border - radius",propName:"borderRadius"}],H=function(e){return(0,g.jsx)(F.ZP,{placement:e.position,interactive:!0,hideOnClick:!1,render:function(n){var t=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(n),n));return(0,g.jsx)("div",(0,E.Z)((0,E.Z)({className:y["tippy-wrapper"],tabIndex:"-1"},t),{},{children:e.children}))},children:e.parent_node})},B=function(e){var n=e.items,t=e.TargetElement;return(0,g.jsx)(g.Fragment,{children:n.map((function(e){return e.tags?(0,g.jsx)(l.Fragment,{children:(0,g.jsx)(H,{position:"left-start",parent_node:(0,g.jsx)("div",{className:y["div-center"],children:(0,g.jsx)(u.G,{icon:p.NkB})},(0,w.x0)(5)),children:(0,g.jsx)("div",{className:y["tippy-wrapper"],children:(0,g.jsx)("div",{className:y["group-btns"],children:e.tags.map((function(n){return(0,g.jsx)("button",{className:y["tag-btn"],onClick:function(){e.fn(t,n)},children:n},(0,w.x0)(5))}))})})})},(0,w.x0)(5)):e.buttons?(0,g.jsx)("div",{className:y.buttons,children:e.buttons.map((function(e){return"button"===e.type?(0,g.jsx)("div",{children:!t.dataset.is_main_container&&(0,g.jsx)("button",{title:e.title,className:y["btn-remove-element"],onClick:e.fn,children:(0,g.jsx)(u.G,{icon:e.icon})})},(0,w.x0)(5)):(0,g.jsxs)("div",{className:y["checkbox-wrapper"],children:[(0,g.jsx)("input",{id:"".concat(e.id),type:"checkbox",defaultChecked:e.defaultChecked,onChange:function(n){return e.fn(n.target.checked)}}),(0,g.jsx)("label",{htmlFor:"".concat(e.id),title:e.title,children:(0,g.jsx)(u.G,{color:e.defaultChecked?"var(--LimeGreen)":"",icon:e.icon})})]},(0,w.x0)(5))}))},(0,w.x0)(5)):void 0}))})},M=function(e){var n=e.TargetElement,t=e.fn;return(0,g.jsx)("div",{className:y["flex-col"],children:L.map((function(e){return e.options?(0,g.jsxs)("div",{className:y.row,children:[(0,g.jsx)("span",{children:e.label}),(0,g.jsx)("select",{className:y["select-wrapper"],onChange:function(n){return t(e.propName,n.target.value)},children:e.options.map((function(e){return(0,g.jsx)("option",{className:y.option,value:e,children:e},(0,w.x0)(5))}))})]},e.id):(0,g.jsxs)("div",{className:y.row,children:[(0,g.jsx)("span",{children:e.label}),(0,g.jsx)("input",{className:y["props-input"],defaultValue:n.style[e.propName]||"",type:"".concat(e.type||"text"),onChange:function(n){return t(e.propName,n.target.value)}})]},e.id)}))})},G=function(e){var n=e.items,t=e.TargetElement,a=e.formRef,r=e.fn;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(B,{items:n,TargetElement:t}),(0,g.jsxs)("div",{className:y["div-center"],style:{marginTop:"auto"},children:[(0,g.jsx)(H,{position:"left",parent_node:(0,g.jsx)("div",{className:y["div-center"],children:(0,g.jsx)(u.G,{icon:p.qHV})}),children:(0,g.jsx)(M,{TargetElement:t,fn:r})}),(0,g.jsx)(H,{position:"left",parent_node:(0,g.jsx)("div",{className:y["div-center"],children:(0,g.jsx)(u.G,{icon:p.q2v})}),children:(0,g.jsx)(R,{handleChangeElementStyles:r})}),(0,g.jsx)("button",{className:y["btn-remove-element"],onClick:function(){var e;null===(e=a.current)||void 0===e||e.toggleForm()},children:(0,g.jsx)(u.G,{icon:p.acZ})})]})]})},J={overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1};function z(e,n){var t=(0,l.useRef)(),r=(0,l.useRef)([]),i=(0,l.useState)(null),s=(0,o.Z)(i,2),d=s[0],u=s[1];(0,l.useImperativeHandle)(n,(function(){return{setTargetElement:u,removeSelectedClass:function(){null===d||void 0===d||d.classList.remove("".concat(y.selecedElement)),u(null)}}}));var m=function(e,n){var t;switch(n){case"container":(t=document.createElement("div")).setAttribute("is_container",!0);break;case"heading-1":t=document.createElement("h1");break;case"heading-2":t=document.createElement("h2");break;case"heading-3":t=document.createElement("h3");break;case"paragraph":t=document.createElement("p");break;case"hanzi":(t=document.createElement("span")).style.fontFamily="var(--font-simkai)",t.setAttribute("data-readnable",!0);break;case"inline-block":(t=document.createElement("span")).style.display="inline-block"}t.style.margin="15px 0",t.style.minHeight="15px",t.setAttribute("data-element-tag-name",n),e.appendChild(t),u(t)},f=function(){var e;if(null===(e=d.dataset)||void 0===e||!e.is_main_container){var n=d.parentNode,t=(0,a.Z)(Array.from(n.childNodes)),i=t.length,o=function(e){for(var n=e.parentNode.childNodes,t=0;t<n.length;t++)if(n[t]===e)return t;return-1}(d),l=i-1-o,c=null;l>-1&&(0===l&&(c=t[o-1]),l>=1&&(c=t[o+1])),r.current.push({parent_node:n,distance:l,removeNode:d,removeIndex:o,Node:c}),d.remove(),u(n)}},_=[{label:"create a element",tags:["container","hanzi","paragraph","inline-block","heading-1","heading-2","heading-3"],fn:m},{buttons:[{icon:p._3l,title:"editing element ",type:"checkbox",defaultChecked:(null===d||void 0===d?void 0:d.isContentEditable)||!1,fn:function(e){e?d.setAttribute("contenteditable",!0):d.removeAttribute("contenteditable")}},{icon:p.Vui,title:"remove selected element",type:"button",fn:f},{icon:p.BgY,title:"select parentNode",type:"button",fn:function(){u(d.parentNode)}}]}];return(0,j.Z)(["ArrowDown"],(function(){null!=d.nextSibling&&"#text"!==d.nextSibling.nodeName&&u(d.nextSibling)}),J),(0,j.Z)(["ArrowUp"],(function(){null!=d.previousSibling&&"#text"!==d.previousSibling.nodeName&&u(d.previousSibling)}),J),(0,j.Z)(["Delete"],f,J),(0,j.Z)(["Control","z"],(function(){var e=r.current.pop();e&&(e.distance>-1?(0===e.distance&&(e.Node?e.Node.insertAdjacentElement("afterend",e.removeNode):e.parent_node.append(e.removeNode)),e.distance>=1&&e.Node.insertAdjacentElement("beforebegin",e.removeNode)):e.parent_node.append(e.removeNode),u(e.parent_node.childNodes[e.removeIndex]))}),J),(0,j.Z)(["Backspace"],(function(){var e;null!==(e=d.dataset)&&void 0!==e&&e.is_main_container||u(d.parentNode)}),J),(0,j.Z)(["Alt","h"],(function(){"span"!==d.tagName.toLowerCase()?m(d,"hanzi"):c.Am.warn("kh\xf4ng l\u1ed3ng c\xe1c inline element v\u1edbi nhau!",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,j.Z)(["Alt","i"],(function(){"span"!==d.tagName.toLowerCase()?m(d,"inline-block"):c.Am.warn("kh\xf4ng l\u1ed3ng c\xe1c inline element v\u1edbi nhau!",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,j.Z)(["Alt","p"],(function(){"span"!==d.tagName.toLowerCase()?m(d,"paragraph"):c.Am.warn("kh\xf4ng \u0111\u1eb7t block element v\xe0o inline element !",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,j.Z)(["Alt","c"],(function(){"span"!==d.tagName.toLowerCase()?m(d,"container"):c.Am.warn("kh\xf4ng \u0111\u1eb7t block element v\xe0o inline element !",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,l.useEffect)((function(){return null===d||void 0===d||d.classList.add("".concat(y.selecedElement)),function(){null===d||void 0===d||d.classList.remove("".concat(y.selecedElement))}}),[d]),(0,g.jsx)("div",{className:y.wrapper,children:d&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(C,{TargetElement:d,ref:t}),(0,g.jsx)(G,{items:_,TargetElement:d,formRef:t,fn:function(e,n){d.style[e]=n}})]})})}var D=(0,l.forwardRef)(z),V=t(72),q=(0,l.forwardRef)((function(e,n){var t=(0,l.useState)(null),a=(0,o.Z)(t,2),r=a[0],i=a[1];return(0,j.Z)(["Escape"],(function(e){i(null)}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,l.useImperativeHandle)(n,(function(){return{setData:i}})),r?(0,g.jsx)("div",{className:d.Z.view_pinyin_tooltip,style:{top:r.react.top-2*r.react.height,left:r.react.left},children:r.text}):null}));function U(e,n){var t=(0,l.useRef)(),u=(0,l.useRef)(),p=(0,l.useState)(!1),m=(0,o.Z)(p,2),f=m[0],_=m[1],b=(0,l.useRef)(),v=(0,l.useState)((function(){return JSON.parse(localStorage.getItem("tab_array"))||[]})),h=(0,o.Z)(v,2),x=h[0],j=h[1];(0,l.useEffect)((function(){x&&localStorage.setItem("tab_array",JSON.stringify(x))}),[x]);var E=function(e,n){s.Db.transaction("rw",s.Db.files,(0,i.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.Db.files.where("_id").equals(e._id).modify((function(e){e.data=b.current.innerHTML})).then((function(){c.Am.success("Saved [ ".concat(e.name," ] "),{position:c.Am.POSITION.BOTTOM_CENTER})}));case 2:case"end":return n.stop()}}),n)})))).then((function(){n()})).catch((function(e){console.error(e.stack)}))},w=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}b.current.innerHTML=null,e.next=8;break;case 4:return e.next=6,s.Db.files.where("_id").equals(n).first();case 6:t=e.sent,b.current&&(b.current.innerHTML=t.data);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){var e=b.current;function n(n){if(f)e.style.cursor="pointer",t.current.setTargetElement(n.target);else if(n.target.dataset.readnable){var a=new SpeechSynthesisUtterance(n.target.innerText);speechSynthesis.speaking||(a.lang="zh-CN",a.volume=1,speechSynthesis.speak(a))}}function a(e){var n=window.getSelection(),t=n.toString();"hanzi"===n.focusNode.parentNode.dataset.elementTagName&&t.length>0&&u.current.setData({text:(0,V.ZP)(t.replace(/"\n"/g,"").split(/\s+/).filter(Boolean).join(" "),{segment:"segmentit",group:!0}).join(" "),react:n.getRangeAt(0).getBoundingClientRect()})}return e&&(e.addEventListener("click",n),e.addEventListener("mouseup",a)),function(){console.log("clean up"),null===e||void 0===e||e.removeEventListener("click",n),null===e||void 0===e||e.removeEventListener("mouseup",a)}}),[f]);return(0,l.useImperativeHandle)(n,(function(){return{addNewTab:function(e){j((function(n){return localStorage.setItem("tab_",JSON.stringify({tab:e,isEdit:f})),n.find((function(n){return n._id===e._id}))?(c.Am.info("[ ".concat(e.name," ] is opend."),{position:c.Am.POSITION.BOTTOM_CENTER,toastId:"custom-id"}),n):(c.Am.success("Open [ ".concat(e.name," ] !"),{position:c.Am.POSITION.BOTTOM_CENTER}),[].concat((0,a.Z)(n),[e]))}))}}})),(0,g.jsxs)("div",{className:d.Z.wrapper,children:[(0,g.jsx)(N,{Viewer:w,onTabClose:function(e,n){var r=x.findIndex((function(n){return n._id===e._id})),i=(0,a.Z)(x);i.splice(r,1),f&&n?(t.current.removeSelectedClass(),E(e,(function(){b.current.innerHTML=null,_(!1),j(i)}))):j(i)},tab_array:x,edit_mode:f,Enable_fn:{toggleEditMode:function(e,n){n&&f?(t.current.removeSelectedClass(),E(n,(function(){return _(e)}))):_(e)}}}),(0,g.jsxs)("div",{className:d.Z["main-wrapper"],style:{height:"".concat(f?99:100,"%")},children:[(0,g.jsx)("div",{ref:b,"data-is_main_container":!0,className:d.Z["main-content"]}),(0,g.jsx)(q,{ref:u}),f&&(0,g.jsx)(D,{ref:t})]})]})}var Q=(0,l.forwardRef)(U)}}]);