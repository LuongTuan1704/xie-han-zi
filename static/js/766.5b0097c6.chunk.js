"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[766],{1766:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(4165),a=n(5861),s=n(9439),i=n(1413),c=n(3433),o=n(7313),u=n(3304),l=n(259),d=n(1309),h=n(6250),f=n(771),m=n(7241),g=n(2751),p=n(6417),v=function(e,t){return{_id:e._id,type:t,ui:"Translate",data:e,translateText:e["c-v"===t?"hanzi":"Vietnamese_meaning"],lang:"c-v"===t?"Vi\u1ec7t":"Trung",answer:"".concat(e["c-v"===t?"Vietnamese_meaning":"hanzi"])}},x=function(e,t){if(t.listRender){for(var n=[["Vietnamese_meaning","hanzi"],["pinyin","hanzi"]],r=n.length,a=[[],[]],s=0;s<t.row;++s){var i=Math.floor(Math.random()*r);a[0][s]={a:e[s][n[i][0]],match:e[s][n[i][1]]},a[1][s]={b:e[s][n[i][1]],match:e[s][n[i][0]]}}(0,m.zz)(a[0]),(0,m.zz)(a[1]);for(var c={QuestionList:[],type:"Chooses",rows:t.row,isFinal:t.isFinal},o=0;o<a[0].length;++o)c.QuestionList.push({a:{q:a[0][o].a,match:a[0][o].match},b:{q:a[1][o].b,match:a[1][o].match}});return c}for(var u=void 0,l=0;l<e.length;l++)t.tempQTestArrayID.current.includes(e[l]._id)||(u=e[l]);if(u)return Math.random()>=.5?v(u,"c-v"):v(u,"v-c")},y=function(e,t){if(console.log(e.answer),!e.answer.trim())return{isOk:!0,match:100};var n=(0,c.Z)(e.answer.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),r=(0,c.Z)(t.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),a=.6*n.length,s=0,i=0;if("c-v"===e.type)for(var o=0;o<r.length;o++)n.includes(r[o])&&s++;if("v-c"===e.type){if(!e.data.Vietnamese_meaning.trim())return{isOk:!0,match:100};n.filter((function(e){return!!r.includes(e)&&(s++,!0)}))}for(var u=0;u<r.length;u++)n[u]===r[u]&&i++;return i===n.length?{isOk:!0,match:100}:s>a?{isOk:!0,match:~~(s/n.length*100)}:{isOk:!1,match:~~(s/n.length*100)}};function b(e){var t=e.data,n=e.style;return(0,p.jsxs)("li",{style:(0,i.Z)({},n),className:h.Z.T_row,children:[(0,p.jsx)("div",{"data-selected":0,"data-match":t.a.match,onClick:function(t){t.stopPropagation(),e.match(t)},className:h.Z.Item,children:t.a.q}),(0,p.jsx)("div",{"data-selected":0,"data-match":t.b.q,onClick:function(t){t.stopPropagation(),e.match(t)},className:h.Z.Item,children:t.b.q})]})}var T={Translate:function(e){var t=(0,o.useRef)(null);return(0,p.jsxs)("div",{className:h.Z["Q-wrapper"],children:[(0,p.jsxs)("header",{children:[" ","D\u1ecbch t\u1eeb v\u1ef1ng ph\xeda d\u01b0\u1edbi sang ti\u1ebfng ",e.datas.lang,"."]}),(0,p.jsxs)("main",{children:[(0,p.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},className:h.Z["T-Item"],onClick:function(){if("c-v"===e.datas.type){var t=new SpeechSynthesisUtterance(e.datas.data.hanzi);speechSynthesis.speaking||(t.lang="zh-CN",t.volume=1,speechSynthesis.speak(t))}},children:(0,p.jsx)("span",{style:{padding:"0 15px"},children:e.datas.translateText})}),(0,p.jsx)("div",{className:h.Z["T-Item"],children:(0,p.jsx)("form",{onSubmit:function(n){e.handleSubmit(n,t.current)},children:(0,p.jsx)("input",{type:"text",name:"answer",autoComplete:"off",placeholder:"nh\u1eadp b\u1ea3n d\u1ecbch"})})})]}),(0,p.jsx)("footer",{ref:t})]})},Chooses:function(e){var t=e.datas.QuestionList.length,n=(0,o.useRef)(0),r=(0,o.useRef)(null);(0,o.useEffect)((function(){return function(){n.current=0,r.current=null}}),[]);var a=function(a){if(!+a.target.dataset.selected)if(r.current)if(a.target.style.border="2px solid var(--BrightRed)",r.current.dataset.match===a.target.dataset.match){if(a.target.style.border="none",r.current.style.border="none",a.target.style.backgroundColor="var(--bg_green-hover)",r.current.style.backgroundColor="var(--bg_green-hover)",a.target.dataset.selected=1,r.current.dataset.selected=1,r.current=null,n.current++,n.current>=t&&!e.datas.isFinal)var s=setTimeout((function(){e.nextQuestion(),clearTimeout(s)}),1500);if(n.current>=t&&e.datas.isFinal)var i=setTimeout((function(){n.current=0,e.reset(!0),clearTimeout(i)}),1500)}else var c=setTimeout((function(){a.target.style.border="none",r.current.style.border="none",a.target.dataset.selected=0,r.current.dataset.selected=0,r.current=null,clearTimeout(c)}),500);else a.target.style.border="2px solid var(--BrightRed)",r.current=a.target,r.current.dataset.selected=1};return(0,p.jsx)("div",{className:h.Z["T-wrapper"],children:(0,p.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:(0,m.C1)(e.datas.QuestionList,5).map((function(e){return(0,p.jsx)("ul",{className:h.Z["T-list"],children:e.map((function(e){return(0,p.jsx)(b,{data:e,style:{height:"calc(100% /5)"},match:a},(0,g.x0)(5))}))},(0,g.x0)(5))}))})})}};function k(e){var t=e.tag,n=e.datas,i=e.props,c=(0,o.useState)(!1),g=(0,s.Z)(c,2),v=g[0],b=g[1],k=(0,o.useState)({ui:"Translate"}),w=(0,s.Z)(k,2),j=w[0],Z=w[1],_=(0,o.useRef)(),I=(0,o.useRef)([]),C=(0,o.useRef)({UI:T[(null===j||void 0===j?void 0:j.ui)||"Translate"]});(0,u.Z)(["Escape"],(function(e){console.log("".concat(e," has been pressed.")),i.back()}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,o.useLayoutEffect)((function(){console.log("reset"),C.current={UI:T[(null===j||void 0===j?void 0:j.ui)||"Translate"]}}),[v,null===j||void 0===j?void 0:j.ui]),(0,o.useEffect)((function(){return v&&(C.current={UI:T.Translate}),(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.Db.tags.orderBy("id").toArray();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e._id===t._id}))[0].QTestArrayID);case 4:case"end":return e.stop()}}),e)})))().then((function(e){I.current=e,e.length===n.length?b(!0):Z(x(n,{tempQTestArrayID:I}))})),(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("update tempQTestArrayID"),!t._id){e.next=4;break}return e.next=4,(0,m.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:I.current}).then((function(){I.current=[]}));case 4:case"end":return e.stop()}}),e)})))}),[]);var Q=v?100:~~(I.current.length/n.length*100),D=(0,p.jsx)("button",{type:"reset",onClick:function(){(0,m.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:[]}).then((function(){I.current=[],b(!1),Z(x(n,{tempQTestArrayID:I}))}))},children:"reset"});return(0,p.jsx)("div",{className:h.Z["test-wrapper"],children:(0,p.jsxs)("div",{className:h.Z["test-container"],ref:_,children:[(0,p.jsxs)("header",{children:["\xd4n t\u1eadp t\u1eeb v\u1ef1ng ",t.tag_name," (",Q," %)"]}),(0,p.jsx)("button",{title:"press Esc to close",className:h.Z["close-btn"],onClick:function(){i.back()},children:(0,p.jsx)(l.G,{icon:d.g82})}),v?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:"\u0110\xe3 ho\xe0n th\xe0nh"}),D]}):(0,p.jsx)(C.current.UI,{datas:j,handleSubmit:function(e,t){e.preventDefault();var r=Array.from(new FormData(e.target).entries())[0][1],a=y(j,r);a.match?100===a.match?t.innerText="d\u1ecbch \u0111\xfang 100% :)":t.innerText="d\u1ecbch \u0111\xfang kho\u1ea3ng : ".concat(a.match," %"):t.innerText="d\u1ecbch sai ho\xe0n to\xe0n :(",_.current.style.border="2px solid ".concat(a.isOk?"var(--LimeGreen)":"var(--BrightRed)"),a.isOk&&I.current.push(j._id);var s=setTimeout((function(){if(clearTimeout(s),_.current.style.border="2px solid var(--boder-color)",t.innerText="",I.current.length===n.length)return C.current={UI:T.Chooses},void Z(x(n,{isFinal:!0,listRender:!0,row:n.length}));if(a.isOk){var r=Math.floor(Math.random()*n.length);switch(r){case 2:case 4:case 6:C.current={UI:T.Chooses},Z(x(n,{isFinal:!1,listRender:!0,row:r}));break;default:Z(x(n,{tempQTestArrayID:I}))}}e.target.reset()}),1500)},reset:b,nextQuestion:function(){Z(x(n,{tempQTestArrayID:I}))}})]})})}}}]);