"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[816],{9816:function(e,n,t){t.r(n),t.d(n,{default:function(){return W}});var a=t(4165),r=t(5861),i=t(1413),s=t(9439),o=t(810),c=t(9898),p=t(390),l=t(4276),d=t(9766),u=t(6706),f=t(5695),h="Sidebar_Note_wrapper__5iR0R",_="Sidebar_Note_paginations-wrapper__k4gZE",x="Sidebar_Note_pagination-input-wrraper__UJtcw",g="Sidebar_Note_paginations-modify-page-input__Qi7gP",m=t(6851),Z=t(3433);function b(e,n,t){return function e(n,a,r){for(var i=0,s=void 0;i<n.length;){if(n[i][t]===a[r]){var o;if(null!==(o=n[i].children)&&void 0!==o&&o.length&&r!==a.length-1)return e(n[i].children,a,r+1);s=n[i]}i++}if(r===a.length-1)return s}(e,n,0)}function w(e,n){for(var t=[],a=0;a<e.length;a++)t.push(e[a][n]),e[a].children&&t.push.apply(t,(0,Z.Z)(w(e[a].children,n)));return t}function y(){return(y=(0,r.Z)((0,a.Z)().mark((function e(n,t,r){var i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.itemPerPage,n-1<0&&(n=1),e.next=4,m.Db.folders.orderBy("id").reverse().offset((n-1)*i).limit(i).toArray();case 4:s=e.sent,r({type:"go_to_page",playload:{data:s,toPage:n}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return E.apply(this,arguments)}function E(){return(E=(0,r.Z)((0,a.Z)().mark((function e(n){var t,r,i,s,o,c,p,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.db_name,r=void 0===t?"folders":t,i=n.paginations,s=i.page,o=i.itemPerPage,e.next=4,m.Db[r].orderBy("id").reverse().offset((s-1)*o).limit(o).toArray();case 4:return c=e.sent,e.next=7,m.Db[r].count();case 7:return p=e.sent,l=Math.ceil(p/o),e.abrupt("return",Promise.resolve({data:c,paginations:{toltalPage:l,toltalRecords:p}}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,n){return k.apply(this,arguments)}function k(){return(k=(0,r.Z)((0,a.Z)().mark((function e(n,t){var r,i,s,o,c,p,l,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.path,i=n.type,s=n.paginations,o=t._id,c=t.name,p=(p=r).split("/"),l=p[0],e.t0=i,e.next="CREATE_FOLDER_AT_ROOT"===e.t0?8:"CREATE_FILE_AT_ROOT"===e.t0?11:"CREATE_FOLDER"===e.t0?16:"CREATE_FILE"===e.t0?24:30;break;case 8:return e.next=10,m.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 10:case 15:case 19:return e.abrupt("return",v({db_name:"folders",paginations:s}));case 11:return e.next=13,m.Db.folders.add({_id:o,path:o,name:c});case 13:return e.next=15,m.Db.files.add({_id:o,data:""});case 16:if(r){e.next=20;break}return e.next=19,m.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 20:return e.next=22,m.Db.folders.where("_id").equals(l).modify((function(e){var n=b([e],p,"_id");console.log("refObj ",n),n.children.push({_id:o,path:"".concat(r,"/").concat(o),isFolder:!0,name:c,children:[]})})).then((function(){return v({db_name:"folders",paginations:s})}));case 22:return d=e.sent,e.abrupt("return",d);case 24:return e.next=26,m.Db.folders.where("_id").equals(l).modify((function(e){b([e],p,"_id").children.push({_id:o,path:"".concat(r,"/").concat(o),name:c})})).then((function(){return v({db_name:"folders",paginations:s})}));case 26:return d=e.sent,e.next=29,m.Db.files.add({_id:o,data:""});case 29:return e.abrupt("return",d);case 30:throw new Error("invalid action type!");case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return D.apply(this,arguments)}function D(){return(D=(0,r.Z)((0,a.Z)().mark((function e(n){var t,r,i,s,o,c,p,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.path,r=n.type,i=n.paginations,s=(s=t).split("/"),o=s.length-1,c=s[0],e.next=7,m.Db.folders.where("_id").equals(c).first();case 7:p=e.sent,e.t0=r,e.next="DELETE_FOLDER"===e.t0?11:"DELETE_FILE"===e.t0?23:33;break;case 11:if(console.log("delete folder at",t,"type",r),c!==s[o]){e.next=18;break}return e.next=15,m.Db.folders.where("_id").equals(c).delete();case 15:l=w([p],"_id"),e.next=20;break;case 18:return e.next=20,m.Db.folders.where("_id").equals(c).modify((function(e){var n=b([e],s.slice(0,o),"_id");n.children=n.children.filter((function(e){return e._id!==s[o]})),l=w([n],"_id")}));case 20:return e.next=22,m.Db.files.where("_id").anyOf(l).delete();case 22:case 32:return e.abrupt("return",v({db_name:"folders",paginations:i}));case 23:if(c!==s[o]){e.next=28;break}return e.next=26,m.Db.folders.where("_id").equals(c).delete();case 26:e.next=30;break;case 28:return e.next=30,m.Db.folders.where("_id").equals(c).modify((function(e){var n=b([e],s.slice(0,o),"_id");n.children=n.children.filter((function(e){return e._id!==s[o]}))}));case 30:return e.next=32,m.Db.files.where("_id").equals(s[o]).delete();case 33:throw new Error("invalid action type!");case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,n){return R.apply(this,arguments)}function R(){return(R=(0,r.Z)((0,a.Z)().mark((function e(n,t){var r,i,s,o,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.path,i=n.paginations,s=(s=r).split("/"),o=s[0],c=s.length-1,o!==s[c]){e.next=10;break}return e.next=8,m.Db.folders.where("_id").equals(o).modify((function(e){e.name=t}));case 8:e.next=12;break;case 10:return e.next=12,m.Db.folders.where("_id").equals(o).modify((function(e){b([e],s,"_id").name=t}));case 12:return e.abrupt("return",v({db_name:"folders",paginations:i}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=t(4942),A=t(2286),C=t(8672),T=t(1435),F="List_wrapper__vkZ3n",S="List_item__A5fJI",O="List_main__nuAi5",I="List_title__HdbVJ",q="List_item_icon__OmPkR",G=t(2559);var B=function e(n){var t=n.dispatch,h=n.paginations,_=n.items,x=(0,p.useState)((function(){return JSON.parse(localStorage.getItem("folders_state"))||{}})),g=(0,s.Z)(x,2),m=g[0],Z=g[1],b=(0,p.useState)({}),w=(0,s.Z)(b,2),y=w[0],v=w[1],E=(0,p.useState)({type:"CREATE_FILE",isShow:!1}),k=(0,s.Z)(E,2),D=k[0],R=k[1],B=(0,p.useContext)(C.Ut);return(0,p.useEffect)((function(){localStorage.setItem("folders_state",JSON.stringify(m))}),[m]),(0,G.jsx)("ul",{className:F,children:_.map((function(n){return(0,G.jsxs)("li",{className:S,onClick:function(e){e.stopPropagation(),n.children?Z((0,i.Z)((0,i.Z)({},m),{},(0,L.Z)({},n._id,!m[n._id]))):B.onclickSubItem(n)},children:[(0,G.jsx)(c.W4,{id:"#".concat(n._id),children:(0,G.jsxs)("div",{className:O,children:[(0,G.jsx)("div",{className:q,children:n.children?m[n._id]?(0,G.jsx)(d.G,{color:"#eab308",icon:u.cC_}):(0,G.jsx)(d.G,{color:"#ca8a04",icon:u.Pk}):(0,G.jsx)(d.G,{color:"#f1f5f9",icon:u.gMD})}),y._id===n._id?(0,G.jsx)(l.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.stopPropagation(),!r.target.value){e.next=10;break}return e.next=4,P({path:n.path,paginations:h},r.target.value);case 4:i=e.sent,t({playload:{paginations:i.paginations,data:i.data}}),v({}),console.log("renamed"),e.next=11;break;case 10:v({});case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),autoFocus:!0}):(0,G.jsx)("div",{className:I,children:n.name})]})}),(0,G.jsxs)(c.xV,{id:"#".concat(n._id),className:f.Z.context_menu_warpper,children:[n.children&&(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),!m[n._id]&&Z((0,i.Z)((0,i.Z)({},m),{},(0,L.Z)({},n._id,!m[n._id]))),R({showAt:n._id,type:"CREATE_FILE",placeholder:"create new file",path:n.path,isShow:!0})},children:[(0,G.jsx)(d.G,{icon:u.b7h})," ",(0,G.jsx)("span",{children:"new file"})]}),n.children&&(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e,t){e.stopPropagation(),!m[n._id]&&Z((0,i.Z)((0,i.Z)({},m),{},(0,L.Z)({},n._id,!m[n._id]))),R({showAt:n._id,type:"CREATE_FOLDER",placeholder:"create new group",path:n.path,isShow:!0})},children:[(0,G.jsx)(d.G,{color:"#ca8a04",icon:u.x58})," ",(0,G.jsx)("span",{children:"new group"})]}),(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),v({_id:n._id})},children:[(0,G.jsx)(d.G,{color:"#1d4ed8",icon:u.BKg})," ",(0,G.jsx)("span",{children:"rename"})]}),(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),(0,A.Am)((0,G.jsx)(T.Z,{customMsg:"".concat(n.name),fn:(0,r.Z)((0,a.Z)().mark((function e(){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.isFolder?"DELETE_FOLDER":"DELETE_FILE",e.next=3,N({path:n.path,type:r,paginations:h});case 3:i=e.sent,t({playload:{paginations:i.paginations,data:i.data}});case 5:case"end":return e.stop()}}),e)})))}))},children:[(0,G.jsx)(d.G,{color:"#b91c1c",icon:u.Vui})," ",(0,G.jsx)("span",{children:"remove"})]})]}),m[n._id]&&n.children&&(0,G.jsxs)(G.Fragment,{children:[D.isShow&&D.showAt===n._id&&(0,G.jsx)(l.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,type:"text",placeholder:"".concat(D.placeholder),autoFocus:!0,onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),!n.target.value){e.next=10;break}return r=(0,o.x0)(5),e.next=5,j({path:D.path,type:D.type,paginations:h},{_id:r,name:n.target.value});case 5:i=e.sent,t({playload:{paginations:i.paginations,data:i.data}}),R({}),e.next=11;break;case 10:R({});case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}),(0,G.jsx)(e,{dispatch:t,paginations:h,items:n.children})]})]},n._id)}))})};var W=function(){var e=(0,p.useReducer)((function(e,n){return"go_to_page"===n.type?(0,i.Z)((0,i.Z)({},e),{},{paginations:(0,i.Z)((0,i.Z)({},e.paginations),{},{page:n.playload.toPage}),datas:n.playload.data}):(0,i.Z)((0,i.Z)({},e),{},{paginations:(0,i.Z)((0,i.Z)({},e.paginations),n.playload.paginations),datas:n.playload.data})}),{paginations:{page:1,itemPerPage:5,toltalPage:null,toltalRecords:null},datas:[]}),n=(0,s.Z)(e,2),t=n[0],m=n[1],Z=(0,p.useState)({}),b=(0,s.Z)(Z,2),w=b[0],E=b[1];return(0,p.useEffect)((function(){(0,r.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v({db_name:"folders",paginations:t.paginations});case 2:n=e.sent,m({playload:{paginations:n.paginations,data:n.data}});case 4:case"end":return e.stop()}}),e)})))()}),[]),(0,G.jsxs)("div",{className:h,children:[(0,G.jsx)(c.W4,{id:"#root-tree-folder",children:(0,G.jsx)(B,{dispatch:m,paginations:t.paginations,items:t.datas})}),w.isShow&&(0,G.jsx)(l.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,type:"text",placeholder:"".concat(w.placeholder),onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),r=(0,o.x0)(5),!n.target.value){e.next=10;break}return e.next=5,j({path:"",type:w.type,paginations:t.paginations},{_id:r,name:n.target.value});case 5:i=e.sent,m({playload:{paginations:i.paginations,data:i.data}}),E({}),e.next=11;break;case 10:E({});case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}),(0,G.jsxs)(c.xV,{id:"#root-tree-folder",className:f.Z.context_menu_warpper,children:[(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),E({type:"CREATE_FILE_AT_ROOT",isShow:!0})},children:[(0,G.jsx)(d.G,{icon:u.b7h}),(0,G.jsx)("span",{children:"new file"})]}),(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),E({type:"CREATE_FOLDER_AT_ROOT",isShow:!0})},children:[(0,G.jsx)(d.G,{color:"#ca8a04",icon:u.x58}),(0,G.jsx)("span",{children:"new group"})]})]}),(0,G.jsxs)("div",{className:_,children:["page :"," ",(0,G.jsx)(l.Z,{styleWrapper:x,className:g,type:"number",min:0,max:t.paginations.toltalPage,onChangefn:function(e){+e&&function(e,n,t){y.apply(this,arguments)}(+e,t.paginations,m)},placeholder:t.paginations.page})," ","/ ",t.paginations.toltalPage," |",t.paginations.toltalRecords]})]})}}}]);
//# sourceMappingURL=816.2495aae1.chunk.js.map