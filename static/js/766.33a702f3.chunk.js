"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[766],{1766:function(e,t,r){r.r(t),r.d(t,{default:function(){return k}});var n=r(4165),a=r(5861),s=r(9439),i=r(1413),c=r(3433),u=r(7313),o=r(259),l=r(1309),d=r(6250),h=r(771),f=r(7241),m=r(2751),v=r(6417),g=function(e,t){var r="c-v"===t?"vietnamese":"chinese";return{_id:e._id,type:t,ui:"Translate",data:e,q:"translate [ ".concat(e["c-v"===t?"hanzi":"Vietnamese_meaning"]," ] to ").concat(r),answer:"".concat(e["c-v"===t?"Vietnamese_meaning":"hanzi"])}},p=function(e,t){if(t.listRender){for(var r=[["Vietnamese_meaning","hanzi"],["pinyin","hanzi"]],n=r.length,a=[[],[]],s=0;s<t.row;++s){var i=Math.floor(Math.random()*n);a[0][s]={a:e[s][r[i][0]],match:e[s][r[i][1]]},a[1][s]={b:e[s][r[i][1]],match:e[s][r[i][0]]}}(0,f.zz)(a[0]),(0,f.zz)(a[1]);for(var c={QuestionList:[],type:"Chooses",rows:t.row,isFinal:t.isFinal},u=0;u<a[0].length;++u)c.QuestionList.push({a:{q:a[0][u].a,match:a[0][u].match},b:{q:a[1][u].b,match:a[1][u].match}});return c}for(var o=void 0,l=0;l<e.length;l++)t.tempQTestArrayID.current.includes(e[l]._id)||(o=e[l]);if(o)return Math.random()>=.5?g(o,"c-v"):g(o,"v-c")},y=function(e,t){if(console.log(e.answer),!e.answer.trim())return{isOk:!0,match:100};var r=(0,c.Z)(e.answer.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),n=(0,c.Z)(t.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),a=.6*r.length,s=0,i=0;if("c-v"===e.type)for(var u=0;u<n.length;u++)r.includes(n[u])&&s++;if("v-c"===e.type){if(!e.data.Vietnamese_meaning.trim())return{isOk:!0,match:100};r.filter((function(e){return!!n.includes(e)&&(s++,!0)}))}for(var o=0;o<n.length;o++)r[o]===n[o]&&i++;return i===r.length?{isOk:!0,match:100}:s>a?{isOk:!0,match:~~(s/r.length*100)}:{isOk:!1,match:~~(s/r.length*100)}};function x(e){var t=e.data,r=e.style;return(0,v.jsxs)("li",{style:(0,i.Z)({},r),className:d.Z.T_row,children:[(0,v.jsx)("div",{"data-selected":0,"data-match":t.a.match,onClick:function(t){t.stopPropagation(),e.match(t)},className:d.Z.Item,children:t.a.q}),(0,v.jsx)("div",{"data-selected":0,"data-match":t.b.q,onClick:function(t){t.stopPropagation(),e.match(t)},className:d.Z.Item,children:t.b.q})]})}var b={Translate:function(e){var t;return(0,v.jsxs)("div",{style:{width:"50%"},children:[(0,v.jsx)("div",{className:d.Z["T-text"],onClick:function(){if("c-v"===e.datas.type){var t=new SpeechSynthesisUtterance(e.datas.data.hanzi);speechSynthesis.speaking||(t.lang="zh-CN",t.volume=1,speechSynthesis.speak(t))}},children:null===(t=e.datas)||void 0===t?void 0:t.q}),(0,v.jsx)("div",{className:d.Z["T-form"],children:(0,v.jsx)("form",{onSubmit:e.handleSubmit,children:(0,v.jsx)("input",{type:"search",name:"answer"})})})]})},Chooses:function(e){var t=e.datas.QuestionList.length,r=(0,u.useRef)(0),n=(0,u.useRef)(null);(0,u.useEffect)((function(){return function(){r.current=0,n.current=null}}),[]);var a=function(a){if(!+a.target.dataset.selected)if(n.current)if(a.target.style.border="2px solid var(--BrightRed)",n.current.dataset.match===a.target.dataset.match){if(a.target.style.border="none",n.current.style.border="none",a.target.style.backgroundColor="var(--bg_green-hover)",n.current.style.backgroundColor="var(--bg_green-hover)",a.target.dataset.selected=1,n.current.dataset.selected=1,n.current=null,r.current++,r.current>=t&&!e.datas.isFinal)var s=setTimeout((function(){e.nextQuestion(),clearTimeout(s)}),1500);if(r.current>=t&&e.datas.isFinal)var i=setTimeout((function(){r.current=0,e.reset(!0),clearTimeout(i)}),1500)}else var c=setTimeout((function(){a.target.style.border="none",n.current.style.border="none",a.target.dataset.selected=0,n.current.dataset.selected=0,n.current=null,clearTimeout(c)}),500);else a.target.style.border="2px solid var(--BrightRed)",n.current=a.target,n.current.dataset.selected=1};return(0,v.jsx)("div",{className:d.Z["T-wrapper"],children:(0,v.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:(0,f.C1)(e.datas.QuestionList,5).map((function(e){return(0,v.jsx)("ul",{className:d.Z["T-list"],children:e.map((function(e){return(0,v.jsx)(x,{data:e,style:{height:"calc(100% /5)"},match:a},(0,m.x0)(5))}))},(0,m.x0)(5))}))})})}};function k(e){var t=e.tag,r=e.datas,i=e.props,c=(0,u.useState)(!1),m=(0,s.Z)(c,2),g=m[0],x=m[1],k=(0,u.useState)({ui:"Translate"}),w=(0,s.Z)(k,2),T=w[0],_=w[1],Z=(0,u.useRef)(),j=(0,u.useRef)([]),C=(0,u.useRef)({UI:b[(null===T||void 0===T?void 0:T.ui)||"Translate"]});(0,u.useLayoutEffect)((function(){console.log("reset"),C.current={UI:b[(null===T||void 0===T?void 0:T.ui)||"Translate"]}}),[g,null===T||void 0===T?void 0:T.ui]),(0,u.useEffect)((function(){return g&&(C.current={UI:b.Translate}),(0,a.Z)((0,n.Z)().mark((function e(){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.Db.tags.orderBy("id").toArray();case 2:return r=e.sent,e.abrupt("return",r.filter((function(e){return e._id===t._id}))[0].QTestArrayID);case 4:case"end":return e.stop()}}),e)})))().then((function(e){j.current=e,e.length===r.length?x(!0):_(p(r,{tempQTestArrayID:j}))})),(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._id){e.next=3;break}return e.next=3,(0,f.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:j.current}).then((function(){j.current=[]}));case 3:case"end":return e.stop()}}),e)})))}),[]);var I=g?100:~~(j.current.length/r.length*100),Q=(0,v.jsx)("button",{type:"reset",onClick:function(){(0,f.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:[]}).then((function(){j.current=[],x(!1),_(p(r,{tempQTestArrayID:j}))}))},children:"reset"});return(0,v.jsx)("div",{className:d.Z["test-wrapper"],children:(0,v.jsxs)("div",{className:d.Z["test-container"],ref:Z,"data-match":0,"data-progress":I,children:[(0,v.jsx)("button",{className:d.Z["close-btn"],onClick:function(){i.back()},children:(0,v.jsx)(o.G,{icon:l.g82})}),g?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h3",{children:"test complited!"}),Q]}):(0,v.jsx)(C.current.UI,{datas:T,handleSubmit:function(e){e.preventDefault();var t=Array.from(new FormData(e.target).entries())[0][1],n=y(T,t);Z.current.dataset.match="match : ".concat(n.match," %"),Z.current.style.border="2px solid ".concat(n.isOk?"var(--LimeGreen)":"var(--BrightRed)"),n.isOk&&j.current.push(T._id);var a=setTimeout((function(){if(clearTimeout(a),Z.current.style.border="2px solid var(--boder-color)",Z.current.dataset.match="match : 0 %",j.current.length===r.length)return C.current={UI:b.Chooses},void _(p(r,{isFinal:!0,listRender:!0,row:r.length}));if(n.isOk){var t=Math.floor(Math.random()*r.length);switch(t){case 2:case 4:case 6:C.current={UI:b.Chooses},_(p(r,{isFinal:!1,listRender:!0,row:t}));break;default:_(p(r,{tempQTestArrayID:j}))}}e.target.reset()}),1500)},reset:x,nextQuestion:function(){_(p(r,{tempQTestArrayID:j}))}})]})})}}}]);