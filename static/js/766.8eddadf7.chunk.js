"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[766],{1766:function(e,t,r){r.r(t),r.d(t,{default:function(){return k}});var n=r(4165),a=r(5861),s=r(9439),c=r(1413),i=r(3433),u=r(7313),l=r(3304),o=r(2751),d=r(259),h=r(1309),f=r(6250),m=r(771),g=r(7241),x=r(6417),v=function(e,t){return{_id:e._id,type:t,ui:"Translate",data:e,translateText:e["c-v"===t?"hanzi":"Vietnamese_meaning"],lang:"c-v"===t?"Vi\u1ec7t":"Trung",answer:"".concat(e["c-v"===t?"Vietnamese_meaning":"hanzi"])}},p=function(e,t){if(t.listRender){for(var r=[["Vietnamese_meaning","hanzi"],["pinyin","hanzi"]],n=r.length,a=[[],[]],s=0;s<t.row;++s){var c=Math.floor(Math.random()*n);a[0][s]={a:e[s][r[c][0]],match:e[s][r[c][1]]},a[1][s]={b:e[s][r[c][1]],match:e[s][r[c][0]]}}for(var i={QuestionList:[],type:"Chooses",rows:t.row,isFinal:t.isFinal},u=(0,g.C1)(a[0],5),l=(0,g.C1)(a[1],5),o=0;o<u.length;++o){(0,g.zz)(u[o]),(0,g.zz)(l[o]);for(var d=[],h=0;h<u[o].length;++h)d.push({a:{q:u[o][h].a,match:u[o][h].match},b:{q:l[o][h].b,match:l[o][h].match}});i.QuestionList.push(d)}return i}for(var f=void 0,m=0;m<e.length;m++)t.tempQTestArrayID.current.includes(e[m]._id)||(f=e[m]);if(f)return Math.random()>=.5?v(f,"c-v"):v(f,"v-c")},y=function(e,t){if(console.log(e.answer),!e.answer.trim())return{isOk:!0,match:100};var r=(0,i.Z)(e.answer.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),n=(0,i.Z)(t.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),a=.6*r.length,s=0,c=0;if("c-v"===e.type)for(var u=0;u<n.length;u++)r.includes(n[u])&&s++;if("v-c"===e.type){if(!e.data.Vietnamese_meaning.trim())return{isOk:!0,match:100};r.filter((function(e){return!!n.includes(e)&&(s++,!0)}))}for(var l=0;l<n.length;l++)r[l]===n[l]&&c++;return c===r.length?{isOk:!0,match:100}:s>a?{isOk:!0,match:~~(s/r.length*100)}:{isOk:!1,match:~~(s/r.length*100)}};function T(e){var t=e.data,r=e.style,n=e.index,a=(0,u.useRef)();return(0,u.useEffect)((function(){var e=a.current;e.style.transition="all ".concat(500*(n+1),"ms ease"),e.classList.add(f.Z.opacity)}),[]),(0,x.jsxs)("li",{ref:a,style:(0,c.Z)({},r),className:f.Z.T_row,children:[(0,x.jsx)("div",{"data-selected":0,"data-match":t.a.match,onClick:function(t){t.stopPropagation(),e.match(t)},className:f.Z.Item,children:t.a.q}),(0,x.jsx)("div",{"data-selected":0,"data-match":t.b.q,onClick:function(t){t.stopPropagation(),e.match(t)},className:f.Z.Item,children:t.b.q})]},(0,o.x0)(5))}var j={Translate:function(e){var t=(0,u.useRef)(null),r=e.state,n=r.index,a=r.length,s=r.incorrect,c=r.score;return(0,x.jsxs)("div",{className:f.Z["Q-wrapper"],children:[(0,x.jsxs)("header",{children:[" ","D\u1ecbch t\u1eeb v\u1ef1ng ph\xeda d\u01b0\u1edbi sang ti\u1ebfng ",e.datas.lang,"."]}),(0,x.jsxs)("main",{children:[(0,x.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},className:f.Z["T-Item"],onClick:function(){if("c-v"===e.datas.type){var t=new SpeechSynthesisUtterance(e.datas.data.hanzi);speechSynthesis.speaking||(t.lang="zh-CN",t.volume=1,speechSynthesis.speak(t))}},children:(0,x.jsx)("span",{children:e.datas.translateText})}),(0,x.jsx)("div",{className:f.Z["T-Item"],children:(0,x.jsx)("form",{onSubmit:function(r){e.handleSubmit(r,t.current),r.target.children[0].disabled=!0},children:(0,x.jsx)("input",{type:"text",name:"answer",autoComplete:"off",placeholder:"nh\u1eadp b\u1ea3n d\u1ecbch"})})})]}),(0,x.jsxs)("footer",{ref:t,children:[(0,x.jsxs)("div",{className:f.Z.state,children:[(0,x.jsxs)("div",{children:["score :"," ",(0,x.jsx)("span",{style:{color:"var(--LimeGreen)",fontSize:"1.25rem"},children:c})]}),(0,x.jsxs)("div",{className:f.Z["flex-row"],children:[(0,x.jsxs)("div",{className:f.Z["flex-col"],children:[(0,x.jsx)("span",{title:"incorrect",style:{color:"var(--BrightRed)"},children:s}),(0,x.jsx)("span",{title:"question index",style:{color:"var(--text-color)"},children:n})]}),(0,x.jsx)("div",{title:"total question",children:a})]})]}),(0,x.jsx)("div",{className:f.Z["display-status"]})]})]})},Chooses:function(e){var t=(0,u.useState)(0),r=(0,s.Z)(t,2),n=r[0],a=r[1],c=e.datas.QuestionList[n].length,i=(0,u.useRef)(0),l=(0,u.useRef)(null);(0,u.useEffect)((function(){return function(){i.current=0,l.current=null}}),[]);var d=function(t){if(!+t.target.dataset.selected)if(l.current)if(t.target.style.border="2px solid var(--BrightRed)",l.current.dataset.match===t.target.dataset.match){if(t.target.style.border="none",l.current.style.border="none",t.target.style.backgroundColor="var(--bg_green-hover)",l.current.style.backgroundColor="var(--bg_green-hover)",t.target.dataset.selected=1,l.current.dataset.selected=1,l.current=null,i.current++,i.current>=c&&!e.datas.isFinal)var r=setTimeout((function(){e.nextQuestion(),clearTimeout(r)}),1500);if(i.current>=c&&e.datas.isFinal)var s=setTimeout((function(){if(i.current=0,clearTimeout(s),n<e.datas.QuestionList.length-1)return a((function(e){return e+1})),void clearTimeout(s);e.reset(!0)}),1500)}else var u=setTimeout((function(){t.target.style.border="none",l.current.style.border="none",t.target.dataset.selected=0,l.current.dataset.selected=0,l.current=null,clearTimeout(u)}),500);else t.target.style.border="2px solid var(--BrightRed)",l.current=t.target,l.current.dataset.selected=1};return(0,x.jsx)("div",{className:f.Z["T-wrapper"],children:(0,x.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:(0,x.jsx)("ul",{className:f.Z["T-list"],children:e.datas.QuestionList[n].map((function(e,t){return(0,x.jsx)(T,{index:t,data:e,style:{height:"calc(100% /5)"},match:d},(0,o.x0)(5))}))},(0,o.x0)(5))})})}},b=100;function k(e){var t=e.tag,r=e.datas,c=e.props,i=(0,u.useState)(!1),o=(0,s.Z)(i,2),v=o[0],T=o[1],k=(0,u.useState)({}),w=(0,s.Z)(k,2),Z=w[0],_=w[1],I=(0,u.useRef)([]),C=(0,u.useRef)(0),Q=(0,u.useRef)(t.MaxScore||0),N=(0,u.useRef)(0),R=(0,u.useRef)(0),D=(0,u.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.round(b/r.length*e/b)}),[]),S=(0,u.useRef)({UI:j.Translate});(0,l.Z)(["Escape"],(function(e){console.log("".concat(e," has been pressed.")),c.back()}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,u.useLayoutEffect)((function(){console.log("reset"),S.current={UI:j.Translate},C.current>Q.current&&0!=Q.current&&(Q.current=C.current)}),[v,Z]),(0,u.useEffect)((function(){return v&&(S.current={UI:j.Translate}),(0,a.Z)((0,n.Z)().mark((function e(){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Db.tags.orderBy("id").toArray();case 2:return r=e.sent,e.abrupt("return",r.filter((function(e){return e._id===t._id}))[0].QTestArrayID);case 4:case"end":return e.stop()}}),e)})))().then((function(e){I.current=e,e.length===r.length?T(!0):_(p(r,{tempQTestArrayID:I}))})),(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("update tempQTestArrayID"),S.current={UI:j.Translate},!t._id){e.next=8;break}return e.next=5,(0,g.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:I.current}).then((function(){I.current=[]}));case 5:if(0===C.current){e.next=8;break}return e.next=8,(0,g.se)("tags","_id",{key:t._id,field:"MaxScore",newValue:C.current}).then((function(){C.current=0,Q.current=0}));case 8:case"end":return e.stop()}}),e)})))}),[]);var z=(0,x.jsx)("button",{type:"reset",onClick:function(){(0,g.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:[]}).then((function(){R.current=0,N.current=0,I.current=[],T(!1),_(p(r,{tempQTestArrayID:I}))}))},children:"reset"}),A={index:I.current.length,length:r.length,incorrect:N.current,score:C.current};return(0,x.jsx)("div",{className:f.Z["test-wrapper"],children:(0,x.jsxs)("div",{className:f.Z["test-container"],children:[(0,x.jsxs)("header",{children:["\xd4n t\u1eadp t\u1eeb v\u1ef1ng [ ",t.tag_name," ]"]}),(0,x.jsx)("button",{title:"press Esc to close",className:f.Z["close-btn"],onClick:function(){c.back()},children:(0,x.jsx)(d.G,{icon:h.g82})}),v?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"\u0110\xe3 ho\xe0n th\xe0nh"}),Q.current&&(0,x.jsxs)("div",{children:["max score : ",Q.current]}),(0,x.jsxs)("div",{children:["score : ",C.current]}),z]}):(0,x.jsx)(S.current.UI,{datas:Z,state:A,handleSubmit:function(e,t){e.preventDefault();var n=Array.from(new FormData(e.target).entries())[0][1],a=y(Z,n);a.match?100===a.match?(C.current+=D(a.match),t.children[1].innerText="ch\xednh x\xe1c \ud83d\ude00"):(a.match>60&&(C.current+=D(a.match-20)),a.match>80&&(C.current+=D(a.match)),t.children[1].innerText="g\u1ea7n \u0111\xfang \ud83d\ude05 ( ".concat(a.match,"%)")):(++R.current,C.current-=D(b),t.children[1].innerText="sai r\u1ed3i \ud83d\ude2d"),a.isOk?I.current.push(Z._id):(++R.current,R.current>1&&(++N.current,t.children[1].innerText="\u0111\xe1p \xe1n : ".concat(Z.answer)));var s=setTimeout((function(){if(e.target.children[0].disabled=!1,e.target.children[0].focus(),t.children[1].innerText="",I.current.length===r.length)return S.current={UI:j.Chooses},void _(p(r,{isFinal:!0,listRender:!0,row:r.length}));if(a.isOk){R.current=0;var n=Math.floor(Math.random()*r.length);n>2&&n<7?(S.current={UI:j.Chooses},_(p(r,{isFinal:!1,listRender:!0,row:n}))):_(p(r,{tempQTestArrayID:I}))}else R.current>=2&&(R.current=0,_(p(r,{tempQTestArrayID:I})));e.target.reset(),clearTimeout(s)}),1800)},reset:T,nextQuestion:function(){_(p(r,{tempQTestArrayID:I}))}})]})})}}}]);