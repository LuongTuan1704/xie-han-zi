"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[816],{9816:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var a=n(4165),r=n(5861),i=n(1413),s=n(9439),o=n(810),c=n(9898),l=n(390),p=n(4276),d=n(9766),u=n(6706),f=n(5695),h="Sidebar_Note_wrapper__5iR0R",_="Sidebar_Note_paginations-wrapper__k4gZE",x="Sidebar_Note_pagination-input-wrraper__UJtcw",g="Sidebar_Note_paginations-modify-page-input__Qi7gP",m=n(6851),Z=n(3433);function b(e,t,n){return function e(t,a,r){for(var i=0,s=void 0;i<t.length;){if(t[i][n]===a[r]){var o;if(null!==(o=t[i].children)&&void 0!==o&&o.length&&r!==a.length-1)return e(t[i].children,a,r+1);s=t[i]}i++}if(r===a.length-1)return s}(e,t,0)}function w(e,t){for(var n=[],a=0;a<e.length;a++)n.push(e[a][t]),e[a].children&&n.push.apply(n,(0,Z.Z)(w(e[a].children,t)));return n}function y(){return(y=(0,r.Z)((0,a.Z)().mark((function e(t,n,r){var i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.itemPerPage,t-1<0&&(t=1),e.next=4,m.Db.folders.orderBy("id").reverse().offset((t-1)*i).limit(i).toArray();case 4:s=e.sent,r({type:"go_to_page",playload:{data:s,toPage:t}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return E.apply(this,arguments)}function E(){return(E=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r,i,s,o,c,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.db_name,r=void 0===n?"folders":n,i=t.paginations,s=i.page,o=i.itemPerPage,e.next=4,m.Db[r].orderBy("id").reverse().offset((s-1)*o).limit(o).toArray();case 4:return c=e.sent,e.next=7,m.Db[r].count();case 7:return l=e.sent,p=Math.ceil(l/o),e.abrupt("return",Promise.resolve({data:c,paginations:{toltalPage:p,toltalRecords:l}}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return k.apply(this,arguments)}function k(){return(k=(0,r.Z)((0,a.Z)().mark((function e(t,n){var r,i,s,o,c,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.path,i=t.type,s=t.paginations,o=n._id,c=n.name,l=(l=r).split("/"),p=l[0],e.t0=i,e.next="CREATE_FOLDER_AT_ROOT"===e.t0?8:"CREATE_FILE_AT_ROOT"===e.t0?11:"CREATE_FOLDER"===e.t0?16:"CREATE_FILE"===e.t0?24:30;break;case 8:return e.next=10,m.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 10:case 15:case 19:return e.abrupt("return",v({db_name:"folders",paginations:s}));case 11:return e.next=13,m.Db.folders.add({_id:o,path:o,name:c});case 13:return e.next=15,m.Db.files.add({_id:o,data:""});case 16:if(r){e.next=20;break}return e.next=19,m.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 20:return e.next=22,m.Db.folders.where("_id").equals(p).modify((function(e){var t=b([e],l,"_id");console.log("refObj ",t),t.children.push({_id:o,path:"".concat(r,"/").concat(o),isFolder:!0,name:c,children:[]})})).then((function(){return v({db_name:"folders",paginations:s})}));case 22:return d=e.sent,e.abrupt("return",d);case 24:return e.next=26,m.Db.folders.where("_id").equals(p).modify((function(e){b([e],l,"_id").children.push({_id:o,path:"".concat(r,"/").concat(o),name:c})})).then((function(){return v({db_name:"folders",paginations:s})}));case 26:return d=e.sent,e.next=29,m.Db.files.add({_id:o,data:""});case 29:return e.abrupt("return",d);case 30:throw new Error("invalid action type!");case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return D.apply(this,arguments)}function D(){return(D=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r,i,s,o,c,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,r=t.type,i=t.paginations,s=(s=n).split("/"),o=s.length-1,c=s[0],e.next=7,m.Db.folders.where("_id").equals(c).first();case 7:l=e.sent,e.t0=r,e.next="DELETE_FOLDER"===e.t0?11:"DELETE_FILE"===e.t0?23:33;break;case 11:if(console.log("delete folder at",n,"type",r),c!==s[o]){e.next=18;break}return e.next=15,m.Db.folders.where("_id").equals(c).delete();case 15:p=w([l],"_id"),e.next=20;break;case 18:return e.next=20,m.Db.folders.where("_id").equals(c).modify((function(e){var t=b([e],s.slice(0,o),"_id");t.children=t.children.filter((function(e){return e._id!==s[o]})),p=w([t],"_id")}));case 20:return e.next=22,m.Db.files.where("_id").anyOf(p).delete();case 22:case 32:return e.abrupt("return",v({db_name:"folders",paginations:i}));case 23:if(c!==s[o]){e.next=28;break}return e.next=26,m.Db.folders.where("_id").equals(c).delete();case 26:e.next=30;break;case 28:return e.next=30,m.Db.folders.where("_id").equals(c).modify((function(e){var t=b([e],s.slice(0,o),"_id");t.children=t.children.filter((function(e){return e._id!==s[o]}))}));case 30:return e.next=32,m.Db.files.where("_id").equals(s[o]).delete();case 33:throw new Error("invalid action type!");case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return R.apply(this,arguments)}function R(){return(R=(0,r.Z)((0,a.Z)().mark((function e(t,n){var r,i,s,o,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.path,i=t.paginations,s=(s=r).split("/"),o=s[0],c=s.length-1,o!==s[c]){e.next=10;break}return e.next=8,m.Db.folders.where("_id").equals(o).modify((function(e){e.name=n}));case 8:e.next=12;break;case 10:return e.next=12,m.Db.folders.where("_id").equals(o).modify((function(e){b([e],s,"_id").name=n}));case 12:return e.abrupt("return",v({db_name:"folders",paginations:i}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=n(4942),A=n(2286),C=n(8672),T=n(1435),F="List_wrapper__vkZ3n",S="List_item__A5fJI",O="List_main__nuAi5",I="List_title__HdbVJ",q="List_item_icon__OmPkR",G=n(2559);var B=function e(t){var n=t.dispatch,h=t.paginations,_=t.items,x=(0,l.useState)((function(){return JSON.parse(localStorage.getItem("folders_state"))||{}})),g=(0,s.Z)(x,2),m=g[0],Z=g[1],b=(0,l.useState)({}),w=(0,s.Z)(b,2),y=w[0],v=w[1],E=(0,l.useState)({type:"CREATE_FILE",isShow:!1}),k=(0,s.Z)(E,2),D=k[0],R=k[1],B=(0,l.useContext)(C.Ut);return(0,l.useEffect)((function(){localStorage.setItem("folders_state",JSON.stringify(m))}),[m]),(0,G.jsx)("ul",{className:F,children:_.map((function(t){return(0,G.jsxs)("li",{className:S,onClick:function(e){e.stopPropagation(),t.children?Z((0,i.Z)((0,i.Z)({},m),{},(0,L.Z)({},t._id,!m[t._id]))):B.onclickSubItem(t)},children:[(0,G.jsx)(c.W4,{id:"#".concat(t._id),children:(0,G.jsxs)("div",{className:O,children:[(0,G.jsx)("div",{className:q,children:t.children?m[t._id]?(0,G.jsx)(d.G,{color:"#eab308",icon:u.cC_}):(0,G.jsx)(d.G,{color:"#ca8a04",icon:u.Pk}):(0,G.jsx)(d.G,{color:"#f1f5f9",icon:u.gMD})}),y._id===t._id?(0,G.jsx)(p.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.stopPropagation(),!r.target.value){e.next=10;break}return e.next=4,P({path:t.path,paginations:h},r.target.value);case 4:i=e.sent,n({playload:{paginations:i.paginations,data:i.data}}),v({}),console.log("renamed"),e.next=11;break;case 10:v({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),autoFocus:!0}):(0,G.jsx)("div",{className:I,children:t.name})]})}),(0,G.jsxs)(c.xV,{id:"#".concat(t._id),className:f.Z.context_menu_warpper,children:[t.children&&(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),!m[t._id]&&Z((0,i.Z)((0,i.Z)({},m),{},(0,L.Z)({},t._id,!m[t._id]))),R({showAt:t._id,type:"CREATE_FILE",placeholder:"create new file",path:t.path,isShow:!0})},children:[(0,G.jsx)(d.G,{icon:u.b7h})," ",(0,G.jsx)("span",{children:"new file"})]}),t.children&&(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e,n){e.stopPropagation(),!m[t._id]&&Z((0,i.Z)((0,i.Z)({},m),{},(0,L.Z)({},t._id,!m[t._id]))),R({showAt:t._id,type:"CREATE_FOLDER",placeholder:"create new group",path:t.path,isShow:!0})},children:[(0,G.jsx)(d.G,{color:"#ca8a04",icon:u.x58})," ",(0,G.jsx)("span",{children:"new group"})]}),(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),v({_id:t._id})},children:[(0,G.jsx)(d.G,{color:"#1d4ed8",icon:u.BKg})," ",(0,G.jsx)("span",{children:"rename"})]}),(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),(0,A.Am)((0,G.jsx)(T.Z,{customMsg:"".concat(t.name),fn:(0,r.Z)((0,a.Z)().mark((function e(){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.isFolder?"DELETE_FOLDER":"DELETE_FILE",e.next=3,N({path:t.path,type:r,paginations:h});case 3:i=e.sent,n({playload:{paginations:i.paginations,data:i.data}});case 5:case"end":return e.stop()}}),e)})))}))},children:[(0,G.jsx)(d.G,{color:"#b91c1c",icon:u.Vui})," ",(0,G.jsx)("span",{children:"remove"})]})]}),m[t._id]&&t.children&&(0,G.jsxs)(G.Fragment,{children:[D.isShow&&D.showAt===t._id&&(0,G.jsx)(p.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,type:"text",placeholder:"".concat(D.placeholder),autoFocus:!0,onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),!t.target.value){e.next=10;break}return r=(0,o.x0)(5),e.next=5,j({path:D.path,type:D.type,paginations:h},{_id:r,name:t.target.value});case 5:i=e.sent,n({playload:{paginations:i.paginations,data:i.data}}),R({}),e.next=11;break;case 10:R({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,G.jsx)(e,{dispatch:n,paginations:h,items:t.children})]})]},t._id)}))})};var W=function(){var e=(0,l.useReducer)((function(e,t){return"go_to_page"===t.type?(0,i.Z)((0,i.Z)({},e),{},{paginations:(0,i.Z)((0,i.Z)({},e.paginations),{},{page:t.playload.toPage}),datas:t.playload.data}):(0,i.Z)((0,i.Z)({},e),{},{paginations:(0,i.Z)((0,i.Z)({},e.paginations),t.playload.paginations),datas:t.playload.data})}),{paginations:{page:1,itemPerPage:5,toltalPage:null,toltalRecords:null},datas:[]}),t=(0,s.Z)(e,2),n=t[0],m=t[1],Z=(0,l.useState)({}),b=(0,s.Z)(Z,2),w=b[0],E=b[1];return(0,l.useEffect)((function(){(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v({db_name:"folders",paginations:n.paginations});case 2:t=e.sent,m({playload:{paginations:t.paginations,data:t.data}});case 4:case"end":return e.stop()}}),e)})))()}),[]),(0,G.jsxs)("div",{className:h,children:[(0,G.jsx)(c.W4,{id:"#root-tree-folder",children:(0,G.jsx)(B,{dispatch:m,paginations:n.paginations,items:n.datas})}),w.isShow&&(0,G.jsx)(p.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,type:"text",placeholder:"".concat(w.placeholder),onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),r=(0,o.x0)(5),!t.target.value){e.next=10;break}return e.next=5,j({path:"",type:w.type,paginations:n.paginations},{_id:r,name:t.target.value});case 5:i=e.sent,m({playload:{paginations:i.paginations,data:i.data}}),E({}),e.next=11;break;case 10:E({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,G.jsxs)(c.xV,{id:"#root-tree-folder",className:f.Z.context_menu_warpper,children:[(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),E({type:"CREATE_FILE_AT_ROOT",isShow:!0})},children:[(0,G.jsx)(d.G,{icon:u.b7h}),(0,G.jsx)("span",{children:"new file"})]}),(0,G.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),E({type:"CREATE_FOLDER_AT_ROOT",isShow:!0})},children:[(0,G.jsx)(d.G,{color:"#ca8a04",icon:u.x58}),(0,G.jsx)("span",{children:"new group"})]})]}),(0,G.jsxs)("div",{className:_,children:["page :"," ",(0,G.jsx)(p.Z,{styleWrapper:x,className:g,type:"number",min:0,max:n.paginations.toltalPage,onChangefn:function(e){+e&&function(e,t,n){y.apply(this,arguments)}(+e,n.paginations,m)},placeholder:n.paginations.page})," ","/ ",n.paginations.toltalPage," | toltal"," ",n.paginations.toltalRecords]})]})}}}]);
//# sourceMappingURL=816.3a0fb6c3.chunk.js.map