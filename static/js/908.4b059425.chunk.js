"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[908],{5908:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var a=n(4165),r=n(5861),i=n(3433),l=n(9439),c=n(2791),o=n(9085),s=n(4557),d=n(9950),u=n(9806),p=n(1632),f="tab-controllers_wrapper__IrtVJ",m="tab-controllers_tabs__AKm3-",_="tab-controllers_Enable_fn_btns__qJyC6",b="tab-controllers_btn-wrapper__QEJJ0",x="tab-controllers_tab_btn_wraper__Ca1p+",h="tab-controllers_tabActive__7wpT3",v="tab-controllers_tab_btn_delete__QJC4q",g="tab-controllers_tab_btn__-12lp",j=n(184);var E=function(e){var t=e.tab_array,n=e.Viewer,a=e.onTabClose,r=e.edit_mode,i=e.Enable_fn,o=(0,c.useState)((function(){var e=JSON.parse(localStorage.getItem("tab_"));return null!==e&&void 0!==e&&e._id&&n(null===e||void 0===e?void 0:e._id),e||{}})),s=(0,l.Z)(o,2),d=s[0],E=s[1];return(0,c.useEffect)((function(){localStorage.setItem("tab_",JSON.stringify({tab:d.tab,isEdit:r}))}),[d,r]),(0,c.useEffect)((function(){var e=t[t.length-1];n(null===e||void 0===e?void 0:e._id),E({tab:e,isEdit:r})}),[t.length]),(0,j.jsxs)("div",{className:f,children:[(0,j.jsx)("div",{className:m,children:t.map((function(e){var t;return(0,j.jsxs)("div",{className:"".concat(x," ").concat((null===(t=d.tab)||void 0===t?void 0:t._id)===e._id?h:""),children:[(0,j.jsx)("button",{className:g,onClick:function(){E({tab:e,isEdit:r}),n(e._id)},children:e.name}),(0,j.jsx)("button",{className:v,onClick:function(){a(e,e._id===d.tab._id)},children:(0,j.jsx)(u.G,{icon:p.$9F})})]},e._id)}))}),(0,j.jsxs)("div",{className:_,children:[(0,j.jsxs)("div",{className:b,children:[(0,j.jsx)("input",{id:"Enable_readnable",type:"checkbox",onChange:function(e){i.setReadnableContent(e.target.checked,d.tab._id)}}),(0,j.jsx)("label",{htmlFor:"Enable_readnable",title:"reader",children:(0,j.jsx)(u.G,{icon:p.lg3})})]}),(0,j.jsxs)("div",{className:b,children:[(0,j.jsx)("input",{id:"Enable_edit_mode",type:"checkbox",onChange:function(e){i.toggleEditMode(e.target.checked,d.tab)}}),(0,j.jsx)("label",{htmlFor:"Enable_edit_mode",title:"edit content",children:(0,j.jsx)(u.G,{icon:p._3l})})]})]})]})},N=n(4580),y={"float-form-content":"EditPanel_float-form-content__7d6I6",textarea:"EditPanel_textarea__Y-fFr","btn-group":"EditPanel_btn-group__WpbJe","reset-btn":"EditPanel_reset-btn__zgL+0","add-btn":"EditPanel_add-btn__ubJG0",wrapper:"EditPanel_wrapper__JEjCk",header:"EditPanel_header__WyqGL","close-edit-menu":"EditPanel_close-edit-menu__y6mu3","tippy-wrapper":"EditPanel_tippy-wrapper__HbFJl","props-input":"EditPanel_props-input__4dIrq",text_input:"EditPanel_text_input__LBD2-",section_heading:"EditPanel_section_heading__LbMeB","flex-col":"EditPanel_flex-col__8cuOg","flex-row":"EditPanel_flex-row__ZPp2R","btn-remove-element":"EditPanel_btn-remove-element__7HhEn","group-btns":"EditPanel_group-btns__UyB6q","tag-btn":"EditPanel_tag-btn__ePvvC",row:"EditPanel_row__GRBOo",selecedElement:"EditPanel_selecedElement__QVSgz","select-wrapper":"EditPanel_select-wrapper__qnUog",option:"EditPanel_option__ycASY","div-center":"EditPanel_div-center__CtiYt",buttons:"EditPanel_buttons__stwwF","checkbox-wrapper":"EditPanel_checkbox-wrapper__5i2N0"};function w(e,t){var n=(0,c.useState)(null),a=(0,l.Z)(n,2),r=a[0],i=a[1];(0,c.useImperativeHandle)(t,(function(){return{setTargetElement:i}})),(0,c.useEffect)((function(){return(0,N.on)("createElement",(function(e){var t=e.detail;i(t)})),null===r||void 0===r||r.classList.add("".concat(y.selecedElement)),function(){(0,N.S1)("createElement",(function(e){var t=e.detail;i(t)})),null===r||void 0===r||r.classList.remove("".concat(y.selecedElement))}}),[r]);var o=(0,c.useRef)();return(0,j.jsx)("div",{className:y["float-form-content"],children:(0,j.jsxs)("form",{onReset:function(e){e.preventDefault(),o.current.focus(),o.current.value=""},onSubmit:function(e){e.preventDefault(),function(e){var t=e.replaceAll("{",'<span data-text_view="true" >');t=(t=t.replaceAll("}","</span>")).replaceAll("\n","<br>"),r.insertAdjacentHTML("beforeend",t)}(o.current.value),o.current.value="",o.current.focus()},children:[(0,j.jsx)("textarea",{className:y.textarea,placeholder:"span tag {content}",ref:o}),(0,j.jsxs)("div",{className:y["btn-group"],children:[(0,j.jsx)("button",{type:"submit",className:y["add-btn"],children:(0,j.jsx)(u.G,{icon:p.XSk})}),(0,j.jsx)("button",{type:"reset",className:y["reset-btn"],children:(0,j.jsx)(u.G,{icon:p.Vui})})]})]})})}var k=(0,c.forwardRef)(w),C=n(1413),T=n(6459),S=n(5984),P="color_SelectColorPanel__5BMDV",Z="color_header__fQVIU",O="color_header-radio-wrapper__TS1mA",A="color_main__XV7vN",I="color_item-wrapper__Jytd2",L=["#fafafa","#0f172a","#eab308","#3b82f6","#8b5cf6","#ef4444"];var R=function(e){var t=e.handleChangeElementStyles,n=[{label:"color",prop:"color"},{label:"bg-color",prop:"backgroundColor"},{label:"br-color",prop:"borderColor"}],a=(0,c.useState)(n[0]),r=(0,l.Z)(a,2),i=r[0],o=r[1];return console.log("color panel!!!"),(0,j.jsxs)("div",{className:P,children:[(0,j.jsx)("div",{className:Z,children:n.map((function(e){return(0,j.jsxs)("div",{className:O,children:[(0,j.jsx)("input",{type:"radio",name:"props-item",value:e.prop,id:e.label,onChange:function(e){o(e.target.value)}}),(0,j.jsx)("label",{htmlFor:"".concat(e.label),children:e.label})]},e.label)}))}),(0,j.jsx)("div",{className:A,children:L.map((function(e){return(0,j.jsxs)("div",{className:I,children:[(0,j.jsx)("input",{type:"radio",name:"color-item",value:e,id:e,onChange:function(e){t(i,e.target.value)}}),(0,j.jsx)("label",{htmlFor:"".concat(e),style:{backgroundColor:"".concat(e)}})]},e)}))})]})},H=n(3694),J=[{id:(0,S.x0)(5),label:"display",propName:"display",options:["","flex","block"]},{id:(0,S.x0)(5),label:"gap",propName:"gap"},{id:(0,S.x0)(5),label:"justify-content",propName:"justifyContent",options:["","flex-start","center","flex-end"]},{id:(0,S.x0)(5),label:"align-items",propName:"alignItems",options:["","flex-start","center","flex-end"]},{id:(0,S.x0)(5),label:"Font size",propName:"fontSize"},{id:(0,S.x0)(5),label:"line height",propName:"lineHeight"},{id:(0,S.x0)(5),label:"text align",propName:"textAlign",options:["","left","center","right","justify"]},{id:(0,S.x0)(5),label:"margin",propName:"margin"},{id:(0,S.x0)(5),label:"padding",propName:"padding"},{id:(0,S.x0)(5),label:"border",propName:"border"},{id:(0,S.x0)(5),label:"border - radius",propName:"borderRadius"}],M=function(e){return(0,j.jsx)(H.ZP,{placement:e.position,interactive:!0,hideOnClick:!1,render:function(t){var n=Object.assign({},((0,T.Z)(t),t));return(0,j.jsx)("div",(0,C.Z)((0,C.Z)({className:y["tippy-wrapper"],tabIndex:"-1"},n),{},{children:e.children}))},children:e.parent_node})},G=(0,c.memo)((function(e){var t=e.items,n=e.TargetElement;return(0,j.jsx)(j.Fragment,{children:t.map((function(e){return(0,j.jsxs)(j.Fragment,{children:[e.tags&&(0,j.jsx)(M,{position:"left-start",parent_node:(0,j.jsx)("div",{className:y["div-center"],children:(0,j.jsx)(u.G,{icon:p.NkB})},(0,S.x0)(5)),children:(0,j.jsxs)("div",{className:y["tippy-wrapper"],children:[(0,j.jsx)("span",{children:e.label}),(0,j.jsx)("div",{className:y["group-btns"],children:e.tags.map((function(t){return(0,j.jsx)("button",{className:y["tag-btn"],onClick:function(){e.fn(n,t)},children:t},(0,S.x0)(5))}))})]})}),e.buttons&&(0,j.jsx)("div",{className:y.buttons,children:e.buttons.map((function(e){return"button"===e.type?(0,j.jsx)("div",{children:!n.dataset.is_main_container&&(0,j.jsx)("button",{title:e.title,className:y["btn-remove-element"],onClick:function(){e.fn(n)},children:(0,j.jsx)(u.G,{icon:e.icon})})},e.id):(0,j.jsx)("div",{children:(0,j.jsxs)("div",{className:y["checkbox-wrapper"],children:[(0,j.jsx)("input",{id:"".concat(e.id),type:"checkbox",defaultChecked:e.defaultChecked,onChange:function(t){return e.fn(t.target.checked)}}),(0,j.jsx)("label",{htmlFor:"".concat(e.id),title:e.title,children:(0,j.jsx)(u.G,{color:e.defaultChecked?"var(--LimeGreen)":"",icon:e.icon})})]},e.key)},e.id)}))},e.id)]})}))})}),(function(e,t){return e.TargetElement.dataset.is_main_container===t.TargetElement.dataset.is_main_container})),F=function(e){var t=e.TargetElement,n=e.fn;return console.log("styles render!!!"),(0,j.jsxs)("section",{className:y["tippy-wrapper"],children:[(0,j.jsx)("span",{className:y.section_heading,children:"Styles"}),(0,j.jsx)("div",{className:y["flex-col"],children:J.map((function(e){return e.options?(0,j.jsxs)("div",{className:y.row,children:[(0,j.jsx)("span",{children:e.label}),(0,j.jsx)("select",{className:y["select-wrapper"],onChange:function(t){return n(e.propName,t.target.value)},children:e.options.map((function(e){return(0,j.jsx)("option",{className:y.option,value:e,children:e},(0,S.x0)(5))}))})]},e.id):(0,j.jsxs)("div",{className:y.row,children:[(0,j.jsx)("span",{children:e.label}),(0,j.jsx)("input",{className:y["props-input"],defaultValue:t.style[e.propName]||"",type:"".concat(e.type||"text"),onChange:function(t){return n(e.propName,t.target.value)}})]},e.id)}))})]})},q=function(e){var t=e.items,n=e.TargetElement,a=e.fn;return console.log("list render!!!"),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(G,{items:t,TargetElement:n}),(0,j.jsx)(M,{position:"left",parent_node:(0,j.jsx)("div",{className:y["div-center"],children:(0,j.jsx)(u.G,{icon:p.qHV})}),children:(0,j.jsx)(F,{TargetElement:n,fn:a})}),(0,j.jsx)(M,{position:"left",parent_node:(0,j.jsx)("div",{className:y["div-center"],children:(0,j.jsx)(u.G,{icon:p.q2v})}),children:(0,j.jsx)(R,{handleChangeElementStyles:a})})]})};function B(e,t){var n=(0,c.useState)(null),a=(0,l.Z)(n,2),r=a[0],i=a[1];(0,c.useImperativeHandle)(t,(function(){return{setTargetElement:i}}));var o=[{id:(0,S.x0)(5),label:"new element",tags:["container","paragraph","text"],fn:function(e,t){var n;switch(t){case"container":(n=document.createElement("div")).setAttribute("is_container",!0);break;case"paragraph":(n=document.createElement("p")).setAttribute("contenteditable",!1);break;case"text":(n=document.createElement("span")).style.display="inline-block",n.setAttribute("contenteditable",!1)}n.style.margin="15px 0",n.style.minHeight="15px",e.appendChild(n),(0,N.X$)("createElement",n),i(n)}},{id:(0,S.x0)(5),buttons:[{id:(0,S.x0)(5),icon:p.lg3,title:"enable speaker",type:"checkbox",defaultChecked:(null===r||void 0===r?void 0:r.dataset.readnable)||!1,fn:function(e){e?r.setAttribute("data-readnable",!0):r.removeAttribute("data-readnable",!0)}},{id:(0,S.x0)(5),icon:p._3l,title:"editing element ",type:"checkbox",defaultChecked:null===r||void 0===r?void 0:r.isContentEditable,fn:function(e){e?r.setAttribute("contenteditable",!0):r.removeAttribute("contenteditable")}},{id:(0,S.x0)(5),icon:p.Vui,title:"remove element",type:"button",fn:function(e){var t=e.parentNode;e.remove(),i(t)}},{id:(0,S.x0)(5),icon:p.BgY,title:"select parentNode",type:"button",fn:function(e){i(e.parentNode)}}]}];return(0,c.useEffect)((function(){return null===r||void 0===r||r.classList.add("".concat(y.selecedElement)),function(){null===r||void 0===r||r.classList.remove("".concat(y.selecedElement))}}),[r]),console.log("panel render!!!"),(0,j.jsx)("div",{className:y.wrapper,children:r&&(0,j.jsx)(q,{items:o,TargetElement:r,fn:function(e,t){r&&(r.style[e]=t)}})})}var D=(0,c.forwardRef)(B);function V(e,t){var n=(0,c.useRef)(),u=(0,c.useRef)(),p=(0,c.useState)(!1),f=(0,l.Z)(p,2),m=f[0],_=f[1],b=(0,c.useState)(!1),x=(0,l.Z)(b,2),h=x[0],v=x[1],g=(0,c.useRef)(),N=(0,c.useState)((function(){return JSON.parse(localStorage.getItem("tab_array"))||[]})),y=(0,l.Z)(N,2),w=y[0],C=y[1];(0,c.useEffect)((function(){w&&localStorage.setItem("tab_array",JSON.stringify(w))}),[w]);var T=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}g.current.innerHTML=null,e.next=8;break;case 4:return e.next=6,s.Db.files.where("_id").equals(t).first();case 6:n=e.sent,g.current.innerHTML=null===n||void 0===n?void 0:n.data;case 8:return e.abrupt("return");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){var e=g.current;function t(t){if(m&&!h){if(t.target.dataset.readnable){var a=new SpeechSynthesisUtterance(t.target.innerText);a.lang="zh-CN",speechSynthesis.speak(a),a.onend=function(){}}}else h&&(e.style.cursor="pointer",n.current.setTargetElement(t.target),u.current.setTargetElement(t.target))}return e&&e.addEventListener("click",t),function(){console.log("clean up"),null===e||void 0===e||e.removeEventListener("click",t)}}),[h,m]);var S=function(e,t){s.Db.transaction("rw",s.Db.files,(0,r.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.Db.files.where("_id").equals(e._id).modify((function(e){e.data=g.current.innerHTML})).then((function(){o.Am.success("Saved [ ".concat(e.name," ] "),{position:o.Am.POSITION.BOTTOM_CENTER})}));case 2:case"end":return t.stop()}}),t)})))).catch((function(e){console.error(e.stack)})).then((function(){})),t()};return(0,c.useImperativeHandle)(t,(function(){return{addNewTab:function(e){C((function(t){return localStorage.setItem("tab_",JSON.stringify({tab:e,isEdit:h})),t.find((function(t){return t._id===e._id}))?(o.Am.info("[ ".concat(e.name," ] is opend."),{position:o.Am.POSITION.BOTTOM_CENTER,toastId:"custom-id"}),t):(o.Am.success("Open [ ".concat(e.name," ] !"),{position:o.Am.POSITION.BOTTOM_CENTER}),[].concat((0,i.Z)(t),[e]))}))}}})),(0,j.jsxs)("div",{className:d.Z.wrapper,children:[(0,j.jsx)(E,{Viewer:T,onTabClose:function(e,t){var n=w.findIndex((function(t){return t._id===e._id})),l=(0,i.Z)(w);l.splice(n,1),h&&t?s.Db.transaction("rw",s.Db.files,(0,r.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.Db.files.where("_id").equals(e._id).modify((function(e){e.data=g.current.innerHTML})).then((function(){g.current.innerHTML=null,C(l)}));case 2:o.Am.success("Saved [ ".concat(e.name," ] "),{position:o.Am.POSITION.BOTTOM_CENTER});case 3:case"end":return t.stop()}}),t)})))).catch((function(e){console.error(e.stack)})):(g.current.innerHTML=null,C(l))},tab_array:w,edit_mode:h,Enable_fn:{setReadnableContent:_,toggleEditMode:function(e,t){t&&h?S(t,(function(){return v(e)})):v(e)},save:S}}),(0,j.jsxs)("div",{className:d.Z.main,children:[(0,j.jsxs)("div",{className:d.Z["flex-row"],style:{height:"".concat(h?70:100,"%")},children:[(0,j.jsx)("div",{ref:g,"data-is_main_container":!0,className:d.Z["main-content"]}),h&&(0,j.jsx)(D,{ref:n})]}),h&&(0,j.jsx)(k,{ref:u})]})]})}var z=(0,c.forwardRef)(V)}}]);
//# sourceMappingURL=908.4b059425.chunk.js.map