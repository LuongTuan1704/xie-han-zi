"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[64],{9064:function(e,n,t){t.r(n),t.d(n,{default:function(){return W}});var a=t(3433),r=t(4165),i=t(5861),l=t(9439),o=t(7313),c=t(4491),s=t(72),d=t(3304),u=t(771),p=t(259),f=t(1309),m="tab-controllers_wrapper__IrtVJ",_="tab-controllers_tabs__AKm3-",b="tab-controllers_btn-wrapper__QEJJ0",h="tab-controllers_tab_btn_wraper__Ca1p+",v="tab-controllers_tabActive__7wpT3",x="tab-controllers_tab_btn_delete__QJC4q",g="tab-controllers_tab_btn__-12lp",N=t(6417);var j=function(e){var n=e.tab_array,t=e.Viewer,a=e.onTabClose,r=e.edit_mode,i=e.Enable_fn,c=(0,o.useState)((function(){var e=JSON.parse(localStorage.getItem("tab_"));return null!==e&&void 0!==e&&e._id&&t(null===e||void 0===e?void 0:e._id),e||{}})),s=(0,l.Z)(c,2),d=s[0],u=s[1];return(0,o.useEffect)((function(){localStorage.setItem("tab_",JSON.stringify({tab:d.tab,isEdit:r}))}),[d,r]),(0,o.useEffect)((function(){var e=n[n.length-1];t(null===e||void 0===e?void 0:e._id),u({tab:e,isEdit:r})}),[n.length]),(0,N.jsx)(N.Fragment,{children:n.length?(0,N.jsxs)("div",{className:m,children:[(0,N.jsx)("div",{className:_,children:n.map((function(e){var n;return(0,N.jsxs)("div",{className:"".concat(h," ").concat((null===(n=d.tab)||void 0===n?void 0:n._id)===e._id?v:""),children:[(0,N.jsx)("button",{className:g,onClick:function(){u({tab:e,isEdit:r}),t(e._id)},children:e.name}),(0,N.jsx)("button",{className:x,onClick:function(){a(e,e._id===d.tab._id)},children:(0,N.jsx)(p.G,{icon:f.$9F})})]},e._id)}))}),(0,N.jsxs)("div",{className:b,children:[(0,N.jsx)("input",{id:"Enable_edit_mode",type:"checkbox",defaultChecked:r,onChange:function(e){i.toggleEditMode(e.target.checked,d.tab)}}),(0,N.jsx)("label",{htmlFor:"Enable_edit_mode",title:"edit content",children:(0,N.jsx)(p.G,{icon:f._3l})})]})]}):null})},E=t(1413),w=t(6459),k=t(2751),C={"float-form-content":"EditPanel_float-form-content__7d6I6",textarea:"EditPanel_textarea__Y-fFr","btn-group":"EditPanel_btn-group__WpbJe","reset-btn":"EditPanel_reset-btn__zgL+0","add-btn":"EditPanel_add-btn__ubJG0",wrapper:"EditPanel_wrapper__JEjCk",header:"EditPanel_header__WyqGL","close-edit-menu":"EditPanel_close-edit-menu__y6mu3","tippy-wrapper":"EditPanel_tippy-wrapper__HbFJl","props-input":"EditPanel_props-input__4dIrq",text_input:"EditPanel_text_input__LBD2-",section_heading:"EditPanel_section_heading__LbMeB","flex-col":"EditPanel_flex-col__8cuOg","flex-row":"EditPanel_flex-row__ZPp2R","btn-remove-element":"EditPanel_btn-remove-element__7HhEn","group-btns":"EditPanel_group-btns__UyB6q","tag-btn":"EditPanel_tag-btn__ePvvC",row:"EditPanel_row__GRBOo","select-wrapper":"EditPanel_select-wrapper__qnUog",option:"EditPanel_option__ycASY","div-center":"EditPanel_div-center__CtiYt",buttons:"EditPanel_buttons__stwwF","checkbox-wrapper":"EditPanel_checkbox-wrapper__5i2N0",selecedElement:"EditPanel_selecedElement__QVSgz"},T=t(6169);function y(e,n){var t=(0,o.useState)(!0),a=(0,l.Z)(t,2),r=a[0],i=a[1];(0,d.Z)(["Escape"],(function(){i(!1)}),T.c),(0,d.Z)(["f"],(function(){i(!0)}),T.c),(0,o.useImperativeHandle)(n,(function(){return{toggleForm:function(){i((function(e){return!e}))}}}));var c=(0,o.useRef)();return r&&(0,N.jsx)("div",{className:C["float-form-content"],children:(0,N.jsxs)("form",{onReset:function(e){e.preventDefault(),c.current.focus(),c.current.value=""},onSubmit:function(n){n.preventDefault(),function(n){var t=n.replaceAll("{",'<span data-text_view="true" >');t=(t=t.replaceAll("}","</span>")).replaceAll("\n","<br>"),e.TargetElement.insertAdjacentHTML("beforeend",t)}(c.current.value),c.current.value="",i(!1)},children:[(0,N.jsx)("textarea",{className:C.textarea,placeholder:"text here...",ref:c}),(0,N.jsxs)("div",{className:C["btn-group"],children:[(0,N.jsx)("button",{type:"submit",className:C["add-btn"],children:(0,N.jsx)(p.G,{icon:f.XSk})}),(0,N.jsx)("button",{type:"reset",className:C["reset-btn"],children:(0,N.jsx)(p.G,{icon:f.Vui})})]})]})})}var S=(0,o.forwardRef)(y),Z="color_SelectColorPanel__5BMDV",A="color_header__fQVIU",O="color_header-radio-wrapper__TS1mA",P="color_main__XV7vN",I="color_item-wrapper__Jytd2",R=["unset","#fafafa","#0f172a","#111827","#18181b","#171717","#1c1917","#020617","#030712","#09090b","#0a0a0a","#0c0a09","#eab308","#ea580c","#3b82f6","#8b5cf6","#be123c","#ef4444","#cbd5e1","#d1d5db","#d4d4d8","#d4d4d4","#d6d3d1","#fca5a5","#fdba74","#fcd34d","#fde047","#86efac","#93c5fd","#a5b4fc","#d8b4fe","#fda4af","#0dcc821a","#0dcc822a","#0dcc82","#9c88ff1a","#9c88ff2a","#9c88ff","#64a6f51a","#64a6f52a","#64a6f5"],L=[{label:"color",prop:"color"},{label:"bg-color",prop:"backgroundColor"},{label:"br-color",prop:"borderColor"}];var B=function(e){var n=e.handleChangeElementStyles,t=(0,o.useState)(L[0]),a=(0,l.Z)(t,2),r=a[0],i=a[1];return(0,N.jsxs)("div",{className:Z,children:[(0,N.jsx)("div",{className:A,children:L.map((function(e){return(0,N.jsxs)("div",{className:O,children:[(0,N.jsx)("input",{type:"radio",name:"props-item",value:e.prop,id:e.label,onChange:function(e){i(e.target.value)}}),(0,N.jsx)("label",{htmlFor:"".concat(e.label),children:e.label})]},e.label)}))}),(0,N.jsx)("div",{className:P,children:R.map((function(e){return(0,N.jsxs)("div",{className:I,children:[(0,N.jsx)("input",{type:"radio",name:"color-item",value:e,id:e,onChange:function(e){n(r,e.target.value)}}),(0,N.jsx)("label",{htmlFor:"".concat(e),style:{backgroundColor:"".concat(e)}})]},e)}))})]})},F=t(4346),M=[{id:(0,k.x0)(5),label:"display",propName:"display",options:["","flex","block"]},{id:(0,k.x0)(5),label:"gap",propName:"gap"},{id:(0,k.x0)(5),label:"justify-content",propName:"justifyContent",options:["","flex-start","center","flex-end"]},{id:(0,k.x0)(5),label:"align-items",propName:"alignItems",options:["","flex-start","center","flex-end"]},{id:(0,k.x0)(5),label:"Font size",propName:"fontSize"},{id:(0,k.x0)(5),label:"line height",propName:"lineHeight"},{id:(0,k.x0)(5),label:"text align",propName:"textAlign",options:["","left","center","right","justify"]},{id:(0,k.x0)(5),label:"margin",propName:"margin"},{id:(0,k.x0)(5),label:"padding",propName:"padding"},{id:(0,k.x0)(5),label:"border",propName:"border"},{id:(0,k.x0)(5),label:"border - radius",propName:"borderRadius"}],G=function(e){return(0,N.jsx)(F.ZP,{placement:e.position,interactive:!0,hideOnClick:!1,render:function(n){var t=Object.assign({},((0,w.Z)(n),n));return(0,N.jsx)("div",(0,E.Z)((0,E.Z)({className:C["tippy-wrapper"],tabIndex:"-1"},t),{},{children:e.children}))},children:e.parent_node})},J=function(e){var n=e.items,t=e.TargetElement;return(0,N.jsx)(N.Fragment,{children:n.map((function(e){return e.tags?(0,N.jsx)(o.Fragment,{children:(0,N.jsx)(G,{position:"left-start",parent_node:(0,N.jsx)("div",{className:C["div-center"],children:(0,N.jsx)(p.G,{icon:f.NkB})},(0,k.x0)(5)),children:(0,N.jsx)("div",{className:C["tippy-wrapper"],children:(0,N.jsx)("div",{className:C["group-btns"],children:e.tags.map((function(n){return(0,N.jsx)("button",{className:C["tag-btn"],onClick:function(){e.fn(t,n)},children:n},(0,k.x0)(5))}))})})})},(0,k.x0)(5)):e.buttons?(0,N.jsx)("div",{className:C.buttons,children:e.buttons.map((function(e){return"button"===e.type?(0,N.jsx)("div",{children:!t.dataset.is_main_container&&(0,N.jsx)("button",{title:e.title,className:C["btn-remove-element"],onClick:e.fn,children:(0,N.jsx)(p.G,{icon:e.icon})})},(0,k.x0)(5)):(0,N.jsxs)("div",{className:C["checkbox-wrapper"],children:[(0,N.jsx)("input",{id:"".concat(e.id),type:"checkbox",defaultChecked:e.defaultChecked,onChange:function(n){return e.fn(n.target.checked)}}),(0,N.jsx)("label",{htmlFor:"".concat(e.id),title:e.title,children:(0,N.jsx)(p.G,{color:e.defaultChecked?"var(--LimeGreen)":"",icon:e.icon})})]},(0,k.x0)(5))}))},(0,k.x0)(5)):void 0}))})},H=function(e){var n=e.TargetElement,t=e.fn;return(0,N.jsx)("div",{className:C["flex-col"],children:M.map((function(e){return e.options?(0,N.jsxs)("div",{className:C.row,children:[(0,N.jsx)("span",{children:e.label}),(0,N.jsx)("select",{className:C["select-wrapper"],onChange:function(n){return t(e.propName,n.target.value)},children:e.options.map((function(e){return(0,N.jsx)("option",{className:C.option,value:e,children:e},(0,k.x0)(5))}))})]},e.id):(0,N.jsxs)("div",{className:C.row,children:[(0,N.jsx)("span",{children:e.label}),(0,N.jsx)("input",{className:C["props-input"],defaultValue:n.style[e.propName]||"",type:"".concat(e.type||"text"),onChange:function(n){return t(e.propName,n.target.value)}})]},e.id)}))})},D=function(e){var n=e.items,t=e.TargetElement,a=e.formRef,r=e.fn;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(J,{items:n,TargetElement:t}),(0,N.jsxs)("div",{className:C["div-center"],style:{marginTop:"auto"},children:[(0,N.jsx)(G,{position:"left",parent_node:(0,N.jsx)("div",{className:C["div-center"],children:(0,N.jsx)(p.G,{icon:f.qHV})}),children:(0,N.jsx)(H,{TargetElement:t,fn:r})}),(0,N.jsx)(G,{position:"left",parent_node:(0,N.jsx)("div",{className:C["div-center"],children:(0,N.jsx)(p.G,{icon:f.q2v})}),children:(0,N.jsx)(B,{handleChangeElementStyles:r})}),(0,N.jsx)("button",{className:C["btn-remove-element"],onClick:function(){var e;null===(e=a.current)||void 0===e||e.toggleForm()},children:(0,N.jsx)(p.G,{icon:f.acZ})})]})]})};function z(e,n){var t=(0,o.useRef)(),r=(0,o.useRef)([]),i=(0,o.useState)(null),s=(0,l.Z)(i,2),u=s[0],p=s[1];(0,o.useImperativeHandle)(n,(function(){return{setTargetElement:p,removeSelectedClass:function(){null===u||void 0===u||u.classList.remove("".concat(C.selecedElement)),p(null)}}}));var m=function(e,n){var t;switch(n){case"container":(t=document.createElement("div")).setAttribute("is_container",!0);break;case"heading-1":t=document.createElement("h1");break;case"heading-2":t=document.createElement("h2");break;case"heading-3":t=document.createElement("h3");break;case"paragraph":t=document.createElement("p");break;case"hanzi":(t=document.createElement("span")).setAttribute("data-readnable",!0);break;case"inline-block":t=document.createElement("span")}t.setAttribute("data-element-tag-name",n),e.appendChild(t),p(t)},_=function(){var e;if(null===(e=u.dataset)||void 0===e||!e.is_main_container){var n=u.parentNode,t=(0,a.Z)(Array.from(n.childNodes)),i=t.length,l=function(e){for(var n=e.parentNode.childNodes,t=0;t<n.length;t++)if(n[t]===e)return t;return-1}(u),o=i-1-l,c=null;o>-1&&(0===o&&(c=t[l-1]),o>=1&&(c=t[l+1])),r.current.push({parent_node:n,distance:o,removeNode:u,removeIndex:l,Node:c}),u.remove(),p(n)}},b=[{label:"create a element",tags:["container","hanzi","paragraph","inline-block","heading-1","heading-2","heading-3"],fn:m},{buttons:[{icon:f._3l,title:"editing element ",type:"checkbox",defaultChecked:(null===u||void 0===u?void 0:u.isContentEditable)||!1,fn:function(e){e?u.setAttribute("contenteditable",!0):u.removeAttribute("contenteditable")}},{icon:f.Vui,title:"remove selected element",type:"button",fn:_},{icon:f.BgY,title:"select parentNode",type:"button",fn:function(){p(u.parentNode)}}]}];return(0,d.Z)(["ArrowDown"],(function(){null!=u.nextSibling&&"#text"!==u.nextSibling.nodeName&&p(u.nextSibling)}),T.c),(0,d.Z)(["ArrowUp"],(function(){null!=u.previousSibling&&"#text"!==u.previousSibling.nodeName&&p(u.previousSibling)}),T.c),(0,d.Z)(["Delete"],_,T.c),(0,d.Z)(["Control","z"],(function(){var e=r.current.pop();e&&(e.distance>-1?(0===e.distance&&(e.Node?e.Node.insertAdjacentElement("afterend",e.removeNode):e.parent_node.append(e.removeNode)),e.distance>=1&&e.Node.insertAdjacentElement("beforebegin",e.removeNode)):e.parent_node.append(e.removeNode),p(e.parent_node.childNodes[e.removeIndex]))}),T.c),(0,d.Z)(["Backspace"],(function(){var e;null!==(e=u.dataset)&&void 0!==e&&e.is_main_container||p(u.parentNode)}),T.c),(0,d.Z)(["Alt","h"],(function(){"span"!==u.tagName.toLowerCase()?m(u,"hanzi"):c.Am.warn("kh\xf4ng l\u1ed3ng c\xe1c inline element v\u1edbi nhau!",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,d.Z)(["Alt","i"],(function(){"span"!==u.tagName.toLowerCase()?m(u,"inline-block"):c.Am.warn("kh\xf4ng l\u1ed3ng c\xe1c inline element v\u1edbi nhau!",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,d.Z)(["Alt","p"],(function(){"span"!==u.tagName.toLowerCase()?m(u,"paragraph"):c.Am.warn("kh\xf4ng \u0111\u1eb7t block element v\xe0o inline element !",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,d.Z)(["Alt","c"],(function(){"span"!==u.tagName.toLowerCase()?m(u,"container"):c.Am.warn("kh\xf4ng \u0111\u1eb7t block element v\xe0o inline element !",{position:c.Am.POSITION.BOTTOM_CENTER})})),(0,o.useEffect)((function(){return null===u||void 0===u||u.classList.add("".concat(C.selecedElement)),function(){null===u||void 0===u||u.classList.remove("".concat(C.selecedElement))}}),[u]),(0,N.jsx)("div",{className:C.wrapper,children:u&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(S,{TargetElement:u,ref:t}),(0,N.jsx)(D,{items:b,TargetElement:u,formRef:t,fn:function(e,n){u.style[e]=n}})]})})}var V=(0,o.forwardRef)(z),q=t(7241),Q=t(6250),U=(0,o.forwardRef)((function(e,n){var t=(0,o.useState)(null),a=(0,l.Z)(t,2),r=a[0],i=a[1];return(0,d.Z)(["Escape"],(function(){return i(null)}),T.c),(0,o.useImperativeHandle)(n,(function(){return{setData:i}})),r?(0,N.jsx)("div",{className:Q.Z.view_pinyin_tooltip,style:{top:r.react.top-1.5*r.react.height,left:r.react.left},children:r.text}):null}));function Y(e,n){var t=(0,o.useRef)(),d=(0,o.useRef)(),p=(0,o.useState)(!1),f=(0,l.Z)(p,2),m=f[0],_=f[1],b=(0,o.useRef)(),h=(0,o.useState)((function(){return JSON.parse(localStorage.getItem("tab_array"))||[]})),v=(0,l.Z)(h,2),x=v[0],g=v[1];(0,o.useEffect)((function(){x&&localStorage.setItem("tab_array",JSON.stringify(x))}),[x]);var E=function(e,n){u.Db.transaction("rw",u.Db.files,(0,i.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Db.files.where("_id").equals(e._id).modify((function(e){e.data=b.current.innerHTML})).then((function(){c.Am.success("Saved [ ".concat(e.name," ] "),{position:c.Am.POSITION.BOTTOM_CENTER})}));case 2:case"end":return n.stop()}}),n)})))).then((function(){n()})).catch((function(e){console.error(e.stack)}))},w=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}b.current.innerHTML=null,e.next=8;break;case 4:return e.next=6,u.Db.files.where("_id").equals(n).first();case 6:t=e.sent,b.current&&(b.current.innerHTML=t.data);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e=b.current;function n(e){if(m)t.current.setTargetElement(e.target);else{var n=window.getSelection(),a=n.toString();"hanzi"===n.focusNode.parentNode.dataset.elementTagName&&a.length?((0,q.wr)(a),d.current.setData({text:(0,s.ZP)(a.replace(/"\n"/g,"").split(/\s+/).filter(Boolean).join(" "),{segment:"segmentit",group:!0}).join(" "),react:n.getRangeAt(0).getBoundingClientRect()})):e.target.dataset.readnable&&(0,q.wr)(e.target.innerText)}}return null===e||void 0===e||e.addEventListener("click",n),function(){console.log("clean up"),null===e||void 0===e||e.removeEventListener("click",n)}}),[m]);return(0,o.useImperativeHandle)(n,(function(){return{addNewTab:function(e){g((function(n){return localStorage.setItem("tab_",JSON.stringify({tab:e,isEdit:m})),n.find((function(n){return n._id===e._id}))?(c.Am.info("[ ".concat(e.name," ] is opend."),{position:c.Am.POSITION.BOTTOM_CENTER,toastId:"custom-id"}),n):(c.Am.success("Open [ ".concat(e.name," ] !"),{position:c.Am.POSITION.BOTTOM_CENTER}),[].concat((0,a.Z)(n),[e]))}))}}})),(0,N.jsxs)("div",{className:Q.Z.wrapper,children:[(0,N.jsx)(j,{Viewer:w,onTabClose:function(e,n){var r=x.findIndex((function(n){return n._id===e._id})),i=(0,a.Z)(x);i.splice(r,1),m&&n?(t.current.removeSelectedClass(),E(e,(function(){b.current.innerHTML=null,_(!1),g(i)}))):g(i)},tab_array:x,edit_mode:m,Enable_fn:{toggleEditMode:function(e,n){n&&m?(t.current.removeSelectedClass(),E(n,(function(){return _(e)}))):_(e)}}}),(0,N.jsxs)("div",{className:Q.Z["main-wrapper"],style:{height:"".concat(m?99:100,"%")},children:[(0,N.jsx)("div",{ref:b,"data-is_main_container":!0,className:Q.Z["main-content"]}),(0,N.jsx)(U,{ref:d}),m&&(0,N.jsx)(V,{ref:t})]})]})}var W=(0,o.forwardRef)(Y)}}]);