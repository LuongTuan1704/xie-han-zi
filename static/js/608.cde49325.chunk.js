"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[608],{7608:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});var a=n(4165),r=n(5861),i=n(3433),l=n(9439),c=n(7313),o=n(4491),s=n(771),d=n(6250),u=n(259),p=n(1309),f="tab-controllers_wrapper__IrtVJ",m="tab-controllers_tabs__AKm3-",b="tab-controllers_btn-wrapper__QEJJ0",_="tab-controllers_tab_btn_wraper__Ca1p+",x="tab-controllers_tabActive__7wpT3",h="tab-controllers_tab_btn_delete__QJC4q",v="tab-controllers_tab_btn__-12lp",g=n(6417);var j=function(e){var t=e.tab_array,n=e.Viewer,a=e.onTabClose,r=e.edit_mode,i=e.Enable_fn,o=(0,c.useState)((function(){var e=JSON.parse(localStorage.getItem("tab_"));return null!==e&&void 0!==e&&e._id&&n(null===e||void 0===e?void 0:e._id),e||{}})),s=(0,l.Z)(o,2),d=s[0],j=s[1];return(0,c.useEffect)((function(){localStorage.setItem("tab_",JSON.stringify({tab:d.tab,isEdit:r}))}),[d,r]),(0,c.useEffect)((function(){var e=t[t.length-1];n(null===e||void 0===e?void 0:e._id),j({tab:e,isEdit:r})}),[t.length]),(0,g.jsxs)("div",{className:f,children:[(0,g.jsxs)("div",{className:b,children:[(0,g.jsx)("input",{id:"Enable_readnable",type:"checkbox",onChange:function(e){i.setReadnableContent(e.target.checked,d.tab._id)}}),(0,g.jsx)("label",{htmlFor:"Enable_readnable",title:"reader",children:(0,g.jsx)(u.G,{icon:p.lg3})})]}),(0,g.jsx)("div",{className:m,children:t.map((function(e){var t;return(0,g.jsxs)("div",{className:"".concat(_," ").concat((null===(t=d.tab)||void 0===t?void 0:t._id)===e._id?x:""),children:[(0,g.jsx)("button",{className:v,onClick:function(){j({tab:e,isEdit:r}),n(e._id)},children:e.name}),(0,g.jsx)("button",{className:h,onClick:function(){a(e,e._id===d.tab._id)},children:(0,g.jsx)(u.G,{icon:p.$9F})})]},e._id)}))}),(0,g.jsxs)("div",{className:b,children:[(0,g.jsx)("input",{id:"Enable_edit_mode",type:"checkbox",onChange:function(e){i.toggleEditMode(e.target.checked,d.tab)}}),(0,g.jsx)("label",{htmlFor:"Enable_edit_mode",title:"edit content",children:(0,g.jsx)(u.G,{icon:p._3l})})]})]})},E=n(3304),N={"float-form-content":"EditPanel_float-form-content__7d6I6",textarea:"EditPanel_textarea__Y-fFr","btn-group":"EditPanel_btn-group__WpbJe","reset-btn":"EditPanel_reset-btn__zgL+0","add-btn":"EditPanel_add-btn__ubJG0",wrapper:"EditPanel_wrapper__JEjCk",header:"EditPanel_header__WyqGL","close-edit-menu":"EditPanel_close-edit-menu__y6mu3","tippy-wrapper":"EditPanel_tippy-wrapper__HbFJl","props-input":"EditPanel_props-input__4dIrq",text_input:"EditPanel_text_input__LBD2-",section_heading:"EditPanel_section_heading__LbMeB","flex-col":"EditPanel_flex-col__8cuOg","flex-row":"EditPanel_flex-row__ZPp2R","btn-remove-element":"EditPanel_btn-remove-element__7HhEn","group-btns":"EditPanel_group-btns__UyB6q","tag-btn":"EditPanel_tag-btn__ePvvC",row:"EditPanel_row__GRBOo",selecedElement:"EditPanel_selecedElement__QVSgz","select-wrapper":"EditPanel_select-wrapper__qnUog",option:"EditPanel_option__ycASY","div-center":"EditPanel_div-center__CtiYt",buttons:"EditPanel_buttons__stwwF","checkbox-wrapper":"EditPanel_checkbox-wrapper__5i2N0"};function y(e,t){var n=(0,c.useState)(!0),a=(0,l.Z)(n,2),r=a[0],i=a[1];(0,E.Z)(["Escape"],(function(e){console.log("".concat(e," has been pressed.")),i(!1)}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,E.Z)(["f"],(function(e){console.log("".concat(e," has been pressed.")),i(!0)}),{overrideSystem:!1,ignoreInputFields:!0,repeatOnHold:!1}),(0,c.useImperativeHandle)(t,(function(){return{toggleForm:function(){i((function(e){return!e}))}}})),console.log(e.TargetElement);var o=(0,c.useRef)();return r&&(0,g.jsx)("div",{className:N["float-form-content"],children:(0,g.jsxs)("form",{onReset:function(e){e.preventDefault(),o.current.focus(),o.current.value=""},onSubmit:function(t){t.preventDefault(),function(t){var n=t.replaceAll("{",'<span data-text_view="true" >');n=(n=n.replaceAll("}","</span>")).replaceAll("\n","<br>"),e.TargetElement.insertAdjacentHTML("beforeend",n)}(o.current.value),o.current.value="",i(!1)},children:[(0,g.jsx)("textarea",{className:N.textarea,placeholder:"text here...",ref:o}),(0,g.jsxs)("div",{className:N["btn-group"],children:[(0,g.jsx)("button",{type:"submit",className:N["add-btn"],children:(0,g.jsx)(u.G,{icon:p.XSk})}),(0,g.jsx)("button",{type:"reset",className:N["reset-btn"],children:(0,g.jsx)(u.G,{icon:p.Vui})})]})]})})}var w=(0,c.forwardRef)(y),k=n(1413);var C=n(2751),T="color_SelectColorPanel__5BMDV",S="color_header__fQVIU",P="color_header-radio-wrapper__TS1mA",Z="color_main__XV7vN",O="color_item-wrapper__Jytd2",I=["#fafafa","#0f172a","#111827","#18181b","#171717","#1c1917","#020617","#030712","#09090b","#0a0a0a","#0c0a09","#eab308","#ea580c","#3b82f6","#8b5cf6","#be123c","#ef4444","#cbd5e1","#d1d5db","#d4d4d8","#d4d4d4","#d6d3d1","#fca5a5","#fdba74","#fcd34d","#fde047","#86efac","#93c5fd","#a5b4fc","#d8b4fe","#fda4af","#0dcc821a","#0dcc822a","#0dcc82","#9c88ff1a","#9c88ff2a","#9c88ff","#64a6f51a","#64a6f52a","#64a6f5"],A=[{label:"color",prop:"color"},{label:"bg-color",prop:"backgroundColor"},{label:"br-color",prop:"borderColor"}];var H=function(e){var t=e.handleChangeElementStyles,n=(0,c.useState)(A[0]),a=(0,l.Z)(n,2),r=a[0],i=a[1];return(0,g.jsxs)("div",{className:T,children:[(0,g.jsx)("div",{className:S,children:A.map((function(e){return(0,g.jsxs)("div",{className:P,children:[(0,g.jsx)("input",{type:"radio",name:"props-item",value:e.prop,id:e.label,onChange:function(e){i(e.target.value)}}),(0,g.jsx)("label",{htmlFor:"".concat(e.label),children:e.label})]},e.label)}))}),(0,g.jsxs)("div",{className:Z,children:[(0,g.jsxs)("div",{className:O,children:[(0,g.jsx)("input",{type:"radio",name:"color-item",value:"unset",id:"unset-cl",onChange:function(e){t(r,e.target.value)}}),(0,g.jsx)("label",{htmlFor:"unset-cl",style:{backgroundColor:"unset",border:"2px solid var(--text-color)"}})]}),I.map((function(e){return(0,g.jsxs)("div",{className:O,children:[(0,g.jsx)("input",{type:"radio",name:"color-item",value:e,id:e,onChange:function(e){t(r,e.target.value)}}),(0,g.jsx)("label",{htmlFor:"".concat(e),style:{backgroundColor:"".concat(e)}})]},e)}))]})]})},R=n(4346),F=[{id:(0,C.x0)(5),label:"display",propName:"display",options:["","flex","block"]},{id:(0,C.x0)(5),label:"gap",propName:"gap"},{id:(0,C.x0)(5),label:"justify-content",propName:"justifyContent",options:["","flex-start","center","flex-end"]},{id:(0,C.x0)(5),label:"align-items",propName:"alignItems",options:["","flex-start","center","flex-end"]},{id:(0,C.x0)(5),label:"Font size",propName:"fontSize"},{id:(0,C.x0)(5),label:"line height",propName:"lineHeight"},{id:(0,C.x0)(5),label:"text align",propName:"textAlign",options:["","left","center","right","justify"]},{id:(0,C.x0)(5),label:"margin",propName:"margin"},{id:(0,C.x0)(5),label:"padding",propName:"padding"},{id:(0,C.x0)(5),label:"border",propName:"border"},{id:(0,C.x0)(5),label:"border - radius",propName:"borderRadius"}],L=function(e){return(0,g.jsx)(R.ZP,{placement:e.position,interactive:!0,hideOnClick:!1,render:function(t){var n=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(t),t));return(0,g.jsx)("div",(0,k.Z)((0,k.Z)({className:N["tippy-wrapper"],tabIndex:"-1"},n),{},{children:e.children}))},children:e.parent_node})},G=(0,c.memo)((function(e){var t=e.items,n=e.TargetElement;return(0,g.jsx)(g.Fragment,{children:t.map((function(e){return(0,g.jsxs)("div",{children:[e.tags&&(0,g.jsx)(L,{position:"left-start",parent_node:(0,g.jsx)("div",{className:N["div-center"],children:(0,g.jsx)(u.G,{icon:p.NkB})},(0,C.x0)(5)),children:(0,g.jsx)("div",{className:N["tippy-wrapper"],children:(0,g.jsx)("div",{className:N["group-btns"],children:e.tags.map((function(t){return(0,g.jsx)("button",{className:N["tag-btn"],onClick:function(){e.fn(n,t)},children:t},(0,C.x0)(5))}))})})}),e.buttons&&(0,g.jsx)("div",{className:N.buttons,children:e.buttons.map((function(e){return"button"===e.type?(0,g.jsx)("div",{children:!n.dataset.is_main_container&&(0,g.jsx)("button",{title:e.title,className:N["btn-remove-element"],onClick:function(){e.fn(n)},children:(0,g.jsx)(u.G,{icon:e.icon})})},e.id):(0,g.jsx)("div",{children:(0,g.jsxs)("div",{className:N["checkbox-wrapper"],children:[(0,g.jsx)("input",{id:"".concat(e.id),type:"checkbox",defaultChecked:e.defaultChecked,onChange:function(t){return e.fn(t.target.checked)}}),(0,g.jsx)("label",{htmlFor:"".concat(e.id),title:e.title,children:(0,g.jsx)(u.G,{color:e.defaultChecked?"var(--LimeGreen)":"",icon:e.icon})})]},e.key)},e.id)}))},e.id)]},(0,C.x0)(5))}))})}),(function(e,t){return e.TargetElement.dataset.is_main_container===t.TargetElement.dataset.is_main_container})),M=function(e){var t=e.TargetElement,n=e.fn;return console.log("styles render!!!"),(0,g.jsx)("div",{className:N["flex-col"],children:F.map((function(e){return e.options?(0,g.jsxs)("div",{className:N.row,children:[(0,g.jsx)("span",{children:e.label}),(0,g.jsx)("select",{className:N["select-wrapper"],onChange:function(t){return n(e.propName,t.target.value)},children:e.options.map((function(e){return(0,g.jsx)("option",{className:N.option,value:e,children:e},(0,C.x0)(5))}))})]},e.id):(0,g.jsxs)("div",{className:N.row,children:[(0,g.jsx)("span",{children:e.label}),(0,g.jsx)("input",{className:N["props-input"],defaultValue:t.style[e.propName]||"",type:"".concat(e.type||"text"),onChange:function(t){return n(e.propName,t.target.value)}})]},e.id)}))})},J=function(e){var t=e.items,n=e.TargetElement,a=e.formRef,r=e.fn;return console.log("list render!!!"),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(G,{items:t,TargetElement:n}),(0,g.jsx)(L,{position:"left",parent_node:(0,g.jsx)("div",{className:N["div-center"],children:(0,g.jsx)(u.G,{icon:p.qHV})}),children:(0,g.jsx)(M,{TargetElement:n,fn:r})}),(0,g.jsx)(L,{position:"left",parent_node:(0,g.jsx)("div",{className:N["div-center"],children:(0,g.jsx)(u.G,{icon:p.q2v})}),children:(0,g.jsx)(H,{handleChangeElementStyles:r})}),(0,g.jsx)("div",{className:N["div-center"],style:{marginTop:"100%"},children:(0,g.jsx)("button",{className:N["btn-remove-element"],onClick:function(){var e;null===(e=a.current)||void 0===e||e.toggleForm()},children:(0,g.jsx)(u.G,{icon:p.acZ})})})]})};function D(e,t){var n=(0,c.useRef)(),a=(0,c.useState)(null),r=(0,l.Z)(a,2),i=r[0],o=r[1];(0,c.useImperativeHandle)(t,(function(){return{setTargetElement:o}}));var s=[{id:(0,C.x0)(5),label:"new element",tags:["H1","H2","H3","Div","p","span"],fn:function(e,t){var n;switch(t){case"Div":(n=document.createElement("div")).setAttribute("is_container",!0);break;case"H1":n=document.createElement("h1");break;case"H2":n=document.createElement("h2");break;case"H3":n=document.createElement("h3");break;case"p":(n=document.createElement("p")).setAttribute("contenteditable",!1);break;case"span":(n=document.createElement("span")).style.display="inline-block",n.setAttribute("contenteditable",!1)}n.style.margin="15px 0",n.style.minHeight="15px",e.appendChild(n),o(n)}},{id:(0,C.x0)(5),buttons:[{id:(0,C.x0)(5),icon:p.lg3,title:"enable speaker",type:"checkbox",defaultChecked:(null===i||void 0===i?void 0:i.dataset.readnable)||!1,fn:function(e){e?i.setAttribute("data-readnable",!0):i.removeAttribute("data-readnable",!0)}},{id:(0,C.x0)(5),icon:p._3l,title:"editing element ",type:"checkbox",defaultChecked:null===i||void 0===i?void 0:i.isContentEditable,fn:function(e){e?i.setAttribute("contenteditable",!0):i.removeAttribute("contenteditable")}},{id:(0,C.x0)(5),icon:p.Vui,title:"remove element",type:"button",fn:function(e){var t=e.parentNode;e.remove(),o(t)}},{id:(0,C.x0)(5),icon:p.BgY,title:"select parentNode",type:"button",fn:function(e){o(e.parentNode)}}]}];return(0,c.useEffect)((function(){return null===i||void 0===i||i.classList.add("".concat(N.selecedElement)),function(){null===i||void 0===i||i.classList.remove("".concat(N.selecedElement))}}),[i]),(0,g.jsx)("div",{className:N.wrapper,children:i&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(w,{TargetElement:i,ref:n}),(0,g.jsx)(J,{items:s,TargetElement:i,formRef:n,fn:function(e,t){i.style[e]=t}})]})})}var B=(0,c.forwardRef)(D);function V(e,t){var n=(0,c.useRef)(),u=(0,c.useState)(!1),p=(0,l.Z)(u,2),f=p[0],m=p[1],b=(0,c.useState)(!1),_=(0,l.Z)(b,2),x=_[0],h=_[1],v=(0,c.useRef)(),E=(0,c.useState)((function(){return JSON.parse(localStorage.getItem("tab_array"))||[]})),N=(0,l.Z)(E,2),y=N[0],w=N[1];(0,c.useEffect)((function(){y&&localStorage.setItem("tab_array",JSON.stringify(y))}),[y]);var k=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}v.current.innerHTML=null,e.next=8;break;case 4:return e.next=6,s.Db.files.where("_id").equals(t).first();case 6:n=e.sent,v.current.innerHTML=null===n||void 0===n?void 0:n.data;case 8:return e.abrupt("return");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){var e=v.current;function t(t){if(f&&!x){if(t.target.dataset.readnable){var a=new SpeechSynthesisUtterance(t.target.innerText);a.lang="zh-CN",speechSynthesis.speak(a),a.onend=function(){}}}else x&&(e.style.cursor="pointer",n.current.setTargetElement(t.target))}return e&&e.addEventListener("click",t),function(){console.log("clean up"),null===e||void 0===e||e.removeEventListener("click",t)}}),[x,f]);var C=function(e,t){s.Db.transaction("rw",s.Db.files,(0,r.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.Db.files.where("_id").equals(e._id).modify((function(e){e.data=v.current.innerHTML})).then((function(){o.Am.success("Saved [ ".concat(e.name," ] "),{position:o.Am.POSITION.BOTTOM_CENTER})}));case 2:case"end":return t.stop()}}),t)})))).catch((function(e){console.error(e.stack)})).then((function(){})),t()};return(0,c.useImperativeHandle)(t,(function(){return{addNewTab:function(e){w((function(t){return localStorage.setItem("tab_",JSON.stringify({tab:e,isEdit:x})),t.find((function(t){return t._id===e._id}))?(o.Am.info("[ ".concat(e.name," ] is opend."),{position:o.Am.POSITION.BOTTOM_CENTER,toastId:"custom-id"}),t):(o.Am.success("Open [ ".concat(e.name," ] !"),{position:o.Am.POSITION.BOTTOM_CENTER}),[].concat((0,i.Z)(t),[e]))}))}}})),(0,g.jsxs)("div",{className:d.Z.wrapper,children:[(0,g.jsx)(j,{Viewer:k,onTabClose:function(e,t){var n=y.findIndex((function(t){return t._id===e._id})),l=(0,i.Z)(y);l.splice(n,1),x&&t?s.Db.transaction("rw",s.Db.files,(0,r.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.Db.files.where("_id").equals(e._id).modify((function(e){e.data=v.current.innerHTML})).then((function(){v.current.innerHTML=null,w(l)}));case 2:o.Am.success("Saved [ ".concat(e.name," ] "),{position:o.Am.POSITION.BOTTOM_CENTER});case 3:case"end":return t.stop()}}),t)})))).catch((function(e){console.error(e.stack)})):(v.current.innerHTML=null,w(l))},tab_array:y,edit_mode:x,Enable_fn:{setReadnableContent:m,toggleEditMode:function(e,t){t&&x?C(t,(function(){return h(e)})):h(e)},save:C}}),(0,g.jsx)("div",{className:d.Z.main,children:(0,g.jsxs)("div",{className:d.Z["flex-row"],style:{height:"".concat(x?80:100,"%")},children:[(0,g.jsx)("div",{ref:v,"data-is_main_container":!0,className:d.Z["main-content"]}),x&&(0,g.jsx)(B,{ref:n})]})})]})}var q=(0,c.forwardRef)(V)}}]);