"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[47],{9047:function(e,t,n){n.r(t),n.d(t,{default:function(){return J}});var a=n(4165),r=n(5861),i=n(9439),s=n(1413),o=n(2751),c=n(807),p=n(7313),l=n(5859),d=n(259),u=n(1309),f=n(5476),_="Sidebar_Note_wrapper__5iR0R",h="Sidebar_Note_paginations-wrapper__k4gZE",x="Sidebar_Note_pagination-input-wrraper__UJtcw",g="Sidebar_Note_paginations-modify-page-input__Qi7gP",m=n(771),Z=n(7241);function b(e,t,n){return w.apply(this,arguments)}function w(){return(w=(0,r.Z)((0,a.Z)().mark((function e(t,n,r){var i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.itemPerPage,t-1<0&&(t=1),e.next=4,m.Db.folders.orderBy("id").offset((t-1)*i).limit(i).toArray();case 4:s=e.sent,r({type:"go_to_page",playload:{data:s,toPage:t}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r,i,s,o,c,p,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.db_name,r=void 0===n?"folders":n,i=t.paginations,s=i.page,o=i.itemPerPage,e.next=4,m.Db[r].orderBy("id").offset((s-1)*o).limit(o).toArray();case 4:return c=e.sent,e.next=7,m.Db[r].count();case 7:return p=e.sent,l=Math.ceil(p/o),e.abrupt("return",Promise.resolve({data:c,paginations:{toltalPage:l,toltalRecords:p}}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return j.apply(this,arguments)}function j(){return(j=(0,r.Z)((0,a.Z)().mark((function e(t,n){var r,i,s,o,c,p,l,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.path,i=t.type,s=t.paginations,o=n._id,c=n.name,p=(p=r).split("/"),l=p[0],e.t0=i,e.next="CREATE_FOLDER_AT_ROOT"===e.t0?8:"CREATE_FILE_AT_ROOT"===e.t0?11:"CREATE_FOLDER"===e.t0?16:"CREATE_FILE"===e.t0?24:30;break;case 8:return e.next=10,m.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 10:case 15:case 19:return e.abrupt("return",y({db_name:"folders",paginations:s}));case 11:return e.next=13,m.Db.folders.add({_id:o,path:o,name:c});case 13:return e.next=15,m.Db.files.add({_id:o,data:""});case 16:if(r){e.next=20;break}return e.next=19,m.Db.folders.add({_id:o,path:o,isFolder:!0,name:c,children:[]});case 20:return e.next=22,m.Db.folders.where("_id").equals(l).modify((function(e){var t=(0,Z.nG)([e],p,"_id");console.log("refObj ",t),t.children.push({_id:o,path:"".concat(r,"/").concat(o),isFolder:!0,name:c,children:[]})})).then((function(){return y({db_name:"folders",paginations:s})}));case 22:return d=e.sent,e.abrupt("return",d);case 24:return e.next=26,m.Db.folders.where("_id").equals(l).modify((function(e){(0,Z.nG)([e],p,"_id").children.push({_id:o,path:"".concat(r,"/").concat(o),name:c})})).then((function(){return y({db_name:"folders",paginations:s})}));case 26:return d=e.sent,e.next=29,m.Db.files.add({_id:o,data:""});case 29:return e.abrupt("return",d);case 30:throw new Error("invalid action type!");case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return N.apply(this,arguments)}function N(){return(N=(0,r.Z)((0,a.Z)().mark((function e(t){var n,r,i,s,o,c,p,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,r=t.type,i=t.paginations,s=(s=n).split("/"),o=s.length-1,c=s[0],e.next=7,m.Db.folders.where("_id").equals(c).first();case 7:p=e.sent,e.t0=r,e.next="DELETE_FOLDER"===e.t0?11:"DELETE_FILE"===e.t0?23:33;break;case 11:if(console.log("delete folder at",n,"type",r),c!==s[o]){e.next=18;break}return e.next=15,m.Db.folders.where("_id").equals(c).delete();case 15:l=(0,Z.x_)([p],"_id"),e.next=20;break;case 18:return e.next=20,m.Db.folders.where("_id").equals(c).modify((function(e){var t=(0,Z.nG)([e],s.slice(0,o),"_id");t.children=t.children.filter((function(e){return e._id!==s[o]})),l=(0,Z.x_)([t],"_id")}));case 20:return e.next=22,m.Db.files.where("_id").anyOf(l).delete();case 22:case 32:return e.abrupt("return",y({db_name:"folders",paginations:i}));case 23:if(c!==s[o]){e.next=28;break}return e.next=26,m.Db.folders.where("_id").equals(c).delete();case 26:e.next=30;break;case 28:return e.next=30,m.Db.folders.where("_id").equals(c).modify((function(e){var t=(0,Z.nG)([e],s.slice(0,o),"_id");t.children=t.children.filter((function(e){return e._id!==s[o]}))}));case 30:return e.next=32,m.Db.files.where("_id").equals(s[o]).delete();case 33:throw new Error("invalid action type!");case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){return P.apply(this,arguments)}function P(){return(P=(0,r.Z)((0,a.Z)().mark((function e(t,n){var r,i,s,o,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.path,i=t.paginations,s=(s=r).split("/"),o=s[0],c=s.length-1,o!==s[c]){e.next=10;break}return e.next=8,m.Db.folders.where("_id").equals(o).modify((function(e){e.name=n}));case 8:e.next=12;break;case 10:return e.next=12,m.Db.folders.where("_id").equals(o).modify((function(e){(0,Z.nG)([e],s,"_id").name=n}));case 12:return e.abrupt("return",y({db_name:"folders",paginations:i}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=n(4942),L=n(4491),C=n(4976),F=n(6016),A="List_wrapper__vkZ3n",T="List_item__A5fJI",S="List_main__nuAi5",O="List_title__HdbVJ",G="List_item_icon__OmPkR",I=n(6417);var q=function e(t){var n=t.dispatch,_=t.paginations,h=t.items,x=(0,p.useContext)(C.Ut),g=(0,p.useState)((function(){return JSON.parse(localStorage.getItem("folders_state"))||{}})),m=(0,i.Z)(g,2),Z=m[0],b=m[1],w=(0,p.useState)({}),y=(0,i.Z)(w,2),v=y[0],j=y[1],N=(0,p.useState)({type:"CREATE_FILE",isShow:!1}),P=(0,i.Z)(N,2),q=P[0],B=P[1];return(0,p.useEffect)((function(){localStorage.setItem("folders_state",JSON.stringify(Z))}),[Z]),(0,I.jsx)("ul",{className:A,children:h.map((function(t){return(0,I.jsxs)("li",{className:T,onClick:function(e){e.stopPropagation(),t.children?b((0,s.Z)((0,s.Z)({},Z),{},(0,R.Z)({},t._id,!Z[t._id]))):x.onclickSubItem(t)},children:[(0,I.jsx)(c.W4,{id:"#".concat(t._id),children:(0,I.jsxs)("div",{className:S,children:[(0,I.jsx)("div",{className:G,children:t.children?Z[t._id]?(0,I.jsx)(d.G,{color:"#eab308",icon:u.cC_}):(0,I.jsx)(d.G,{color:"#ca8a04",icon:u.Pk}):(0,I.jsx)(d.G,{color:"#f1f5f9",icon:u.gMD})}),v._id===t._id?(0,I.jsx)(l.Z,{tabIndex:-1,autoFocus:!0,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.stopPropagation(),!r.target.value){e.next=10;break}return e.next=4,D({path:t.path,paginations:_},r.target.value);case 4:i=e.sent,n({playload:{paginations:i.paginations,data:i.data}}),j({}),console.log("renamed"),e.next=11;break;case 10:j({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}):(0,I.jsx)("div",{className:O,title:t.name,children:t.name})]})}),(0,I.jsxs)(c.xV,{id:"#".concat(t._id),className:f.Z.context_menu_warpper,children:[t.children&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),!Z[t._id]&&b((0,s.Z)((0,s.Z)({},Z),{},(0,R.Z)({},t._id,!Z[t._id]))),B({showAt:t._id,type:"CREATE_FILE",placeholder:"create new file",path:t.path,isShow:!0})},children:[(0,I.jsx)(d.G,{icon:u.b7h})," ",(0,I.jsx)("span",{children:"new file"})]}),(0,I.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),!Z[t._id]&&b((0,s.Z)((0,s.Z)({},Z),{},(0,R.Z)({},t._id,!Z[t._id]))),B({showAt:t._id,type:"CREATE_FOLDER",placeholder:"create new group",path:t.path,isShow:!0})},children:[(0,I.jsx)(d.G,{color:"#ca8a04",icon:u.x58})," ",(0,I.jsx)("span",{children:"new group"})]})]}),(0,I.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),j({_id:t._id})},children:[(0,I.jsx)(d.G,{color:"#1db489",icon:u.BKg})," ",(0,I.jsx)("span",{children:"rename"})]}),(0,I.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),(0,L.Am)((0,I.jsx)(F.Z,{customMsg:"".concat(t.name),fn:(0,r.Z)((0,a.Z)().mark((function e(){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.isFolder?"DELETE_FOLDER":"DELETE_FILE",e.next=3,k({path:t.path,type:r,paginations:_});case 3:i=e.sent,n({playload:{paginations:i.paginations,data:i.data}});case 5:case"end":return e.stop()}}),e)})))}))},children:[(0,I.jsx)(d.G,{color:"#b91c1c",icon:u.Vui})," ",(0,I.jsx)("span",{children:"remove"})]})]}),Z[t._id]&&t.children&&(0,I.jsxs)(I.Fragment,{children:[q.isShow&&q.showAt===t._id&&(0,I.jsx)(l.Z,{tabIndex:-1,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,type:"text",placeholder:"".concat(q.placeholder),autoFocus:!0,onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),!t.target.value){e.next=10;break}return r=(0,o.x0)(5),e.next=5,E({path:q.path,type:q.type,paginations:_},{_id:r,name:t.target.value});case 5:i=e.sent,n({playload:{paginations:i.paginations,data:i.data}}),B({}),e.next=11;break;case 10:B({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,I.jsx)(e,{dispatch:n,paginations:_,items:t.children})]})]},t._id)}))})},B=function(e,t){return"go_to_page"===t.type?(0,s.Z)((0,s.Z)({},e),{},{paginations:(0,s.Z)((0,s.Z)({},e.paginations),{},{page:t.playload.toPage}),datas:t.playload.data}):(0,s.Z)((0,s.Z)({},e),{},{paginations:(0,s.Z)((0,s.Z)({},e.paginations),t.playload.paginations),datas:t.playload.data})},W={paginations:{page:1,itemPerPage:10,toltalPage:null,toltalRecords:null},datas:[]};var J=function(){console.log("note!!!");var e=(0,p.useReducer)(B,W),t=(0,i.Z)(e,2),n=t[0],s=t[1],m=(0,p.useState)({}),Z=(0,i.Z)(m,2),w=Z[0],v=Z[1];return(0,p.useEffect)((function(){(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y({db_name:"folders",paginations:n.paginations});case 2:t=e.sent,s({playload:{paginations:t.paginations,data:t.data}});case 4:case"end":return e.stop()}}),e)})))()}),[]),(0,I.jsxs)("div",{className:_,children:[(0,I.jsx)("div",{style:{flexGrow:1},children:(0,I.jsxs)(c.W4,{id:"#root-tree-folder",children:[(0,I.jsxs)("div",{style:{marginLeft:"-16px"},children:[(0,I.jsx)(q,{dispatch:s,paginations:n.paginations,items:n.datas}),w.isShow&&(0,I.jsx)(l.Z,{tabIndex:-1,autoFocus:!0,styleWrapper:f.Z["input-wrraper"],className:f.Z.input,type:"text",placeholder:"".concat(w.placeholder),onBlur:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),r=(0,o.x0)(5),!t.target.value.trim()){e.next=10;break}return e.next=5,E({path:"",type:w.type,paginations:n.paginations},{_id:r,name:t.target.value});case 5:i=e.sent,s({playload:{paginations:i.paginations,data:i.data}}),v({}),e.next=11;break;case 10:v({});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]}),(0,I.jsxs)(c.xV,{id:"#root-tree-folder",className:f.Z.context_menu_warpper,children:[(0,I.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),v({type:"CREATE_FILE_AT_ROOT",isShow:!0})},children:[(0,I.jsx)(d.G,{icon:u.b7h}),(0,I.jsx)("span",{children:"new file"})]}),(0,I.jsxs)(c.sN,{className:f.Z.context_menu_item,onClick:function(e){e.stopPropagation(),v({type:"CREATE_FOLDER_AT_ROOT",isShow:!0})},children:[(0,I.jsx)(d.G,{color:"#ca8a04",icon:u.x58}),(0,I.jsx)("span",{children:"new group"})]})]})]})}),(0,I.jsxs)("div",{className:h,children:[(0,I.jsx)(l.Z,{styleWrapper:x,className:g,type:"number",min:0,max:n.paginations.toltalPage,onChangefn:function(e){+e&&b(+e,n.paginations,s)},placeholder:n.paginations.page})," ","of ",n.paginations.toltalPage,"/",n.paginations.toltalRecords,(0,I.jsx)("button",{style:{marginLeft:"8px",cursor:"pointer"},onClick:function(){b(n.paginations.toltalPage,n.paginations,s)},children:"new"})]})]})}}}]);