"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[183],{1835:function(e,n,t){t.r(n),t.d(n,{default:function(){return y}});var r=t(1413),a=t(9439),i=t(7313),s=t(3453),c=t(72),o="HanziComponentStyle_wrapper__ePplx",l="HanziComponentStyle_Hanzi-wrapper__IDIbd",u="HanziComponentStyle_quiz-info__KtDWc",d="HanziComponentStyle_pinyin-wrapper__roeuL",m="HanziComponentStyle_controler__ynIIG",h="HanziComponentStyle_btn__azqZ+",f="HanziComponentStyle_right-section__Z2Esh",p=t(259),_=t(1309),v="Loading_loading-wrapper__5Ti6M",x="Loading_loading__OIcbi",g=t(6417);function j(e,n){var t=e.position;return(0,g.jsx)("div",{style:{position:"fixed"===t?t:"absolute"},className:v,ref:n,children:(0,g.jsx)("div",{className:x})})}var b=(0,i.forwardRef)(j);function w(e){var n=e.character,t=e.showPinyin,v=void 0===t||t,x=e.options,j=(0,i.useState)(!1),w=(0,a.Z)(j,2),y=w[0],Z=w[1],k=(0,i.useState)("amimation"),N=(0,a.Z)(k,2),C=N[0],T=N[1],S=(0,i.useState)(!1),z=(0,a.Z)(S,2),I=z[0],D=z[1],F=(0,i.useState)(!1),R=(0,a.Z)(F,2),L=R[0],A=R[1],P=(0,i.useRef)(),O=(0,i.useState)(null),V=(0,a.Z)(O,2),G=V[0],H=V[1],E=(0,i.useRef)(),q=new SpeechSynthesisUtterance(n);q.lang="zh-CN",q.volume=1;var Q="quiz"===C?"draw":I?"pause":"amimation",M=function(){T((function(e){return"amimation"===e?"quiz":"amimation"}))};(0,i.useEffect)((function(){Z(!0);var e=P.current,t=s.Z.create(e,n,(0,r.Z)((0,r.Z)({},x),{},{onLoadCharDataSuccess:function(){Z(!1)},onLoadCharDataError:function(e){B.current.innerHTML="".concat(e)}}));return H(t),function(){e.innerHTML=null}}),[n,x]),(0,i.useEffect)((function(){"quiz"===C&&G.quiz({onMistake:function(){var e,n;null!==(n=(e=E.current).innerText)&&void 0!==n||(e.innerText="wrong!");var t=setTimeout((function(){clearTimeout(t),E.current.innerText=null}),800)},onCorrectStroke:function(){var e,n;null!==(n=(e=E.current).innerText)&&void 0!==n||(e.innerText="correct!");var t=setTimeout((function(){clearTimeout(t),E.current.innerText=null}),800)},onComplete:function(e){var n=setTimeout((function(){clearTimeout(n),M()}),1e3)}})}),[C,G]);var U=(0,i.useCallback)((function(){L||"quiz"===C||(A(!0),D(!0),G.animateCharacter({onComplete:function(){A(!1),D(!1)}})),I&&L&&"quiz"!==C?G.pauseAnimation():G.resumeAnimation(),"quiz"!==C&&D(!I)}),[G,I,L,C]),B=(0,i.useRef)(),J=(0,i.useMemo)((function(){return(0,c.ZP)(n,{heteronym:!0})[0].map((function(e,n){return(0,g.jsx)("span",{className:"pinyin",children:e},n)}))}),[n]);return(0,g.jsxs)("div",{className:o,"data-character":n,children:[y&&(0,g.jsx)(b,{ref:B}),"quiz"===C&&(0,g.jsx)("div",{className:u,children:(0,g.jsx)("div",{ref:E})}),(0,g.jsx)("div",{className:l,style:{visibility:"".concat(y?"hidden":"visible")},ref:P,onClick:U,title:Q}),v&&(0,g.jsx)("div",{className:d,children:J}),(0,g.jsx)("div",{className:m,children:(0,g.jsxs)("div",{className:f,children:[(0,g.jsx)("button",{className:h,onClick:function(e){e.target.style.color="var(--LimeGreen)",speechSynthesis.speaking||(speechSynthesis.speak(q),q.onend=function(){this.style.color="inherit"}.bind(e.target))},children:(0,g.jsx)(p.G,{icon:_.j1t})}),(0,g.jsx)("button",{className:h,onClick:M,style:{color:"".concat("amimation"===C?"inherit":"var(--LimeGreen)")},children:(0,g.jsx)(p.G,{icon:_.TzT})})]})})]})}var y=(0,i.memo)(w)},1981:function(e,n,t){t.d(n,{Z:function(){return v}});var r=t(9439),a=t(4165),i=t(5861),s=t(7313),c="FormData_wrapper__NyJqU",o="FormData_form-btn-group__67+HP",l="FormData_btnSubmit__LpozE",u="FormData_btnReset__+Cuwk",d=t(259),m=t(1309),h=t(6535),f=t(6417);function p(e,n,t){var r=new SpeechSynthesisUtterance(t);return r.lang="zh-CN",speechSynthesis.speak(r),e[n].scrollIntoView({behavior:"smooth",block:"center"}),e[n].style.borderColor="var(--LimeGreen)",new Promise((function(e){r.onend=function(){e(!0)}}))}var _=function(e){return new Promise(function(){var n=(0,i.Z)((0,a.Z)().mark((function n(t){var r,i;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=(0,a.Z)().mark((function n(t){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p(e,t,e[t].dataset.character).then((function(){e[t].style.borderColor="transparent"}));case 2:case"end":return n.stop()}}),n)})),i=0;case 2:if(!(i<e.length)){n.next=7;break}return n.delegateYield(r(i),"t0",4);case 4:i++,n.next=2;break;case 7:t(!0);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())};var v=function(e){var n=(0,s.useRef)(),t=(0,s.useState)(""),a=(0,r.Z)(t,2),i=a[0],p=a[1],v=(0,s.useState)(!1),x=(0,r.Z)(v,2),g=x[0],j=x[1];return(0,f.jsx)("div",{id:"form-wrapper",className:c,"data-f":!0,children:(0,f.jsxs)("form",{onReset:function(e){e.preventDefault(),n.current.focus(),p("")},onSubmit:function(t){t.preventDefault(),"PinyinScreen"===e.type?(0,h.X$)("toPinyin",i):(0,h.X$)("emitData",i),p(""),n.current.focus()},children:[(0,f.jsx)("textarea",{ref:n,className:"textarea",spellCheck:!1,value:i,onChange:function(e){p(e.target.value)},tabIndex:1}),(0,f.jsxs)("div",{className:o,children:[(0,f.jsx)("button",{type:"submit",tabIndex:2,disabled:!(i.trim().length>0)||g,className:"".concat(i&&l),children:(0,f.jsx)(d.G,{icon:m.XCy})}),(0,f.jsx)("button",{type:"reset",tabIndex:3,disabled:!(i.trim().length>0)||g,className:"".concat(i&&u),children:(0,f.jsx)(d.G,{icon:m.g82})}),(0,f.jsx)("button",{disabled:g,onClick:function(){!function(e){var n=e.id,t=e.fn;t();var r=Array.from(document.querySelector("#".concat(n)).childNodes);_(r).then((function(){t()}))}({id:e.ttsp,fn:function(){return j((function(e){return!e}))}})},children:(0,f.jsx)(d.G,{icon:m.AQZ})})]})]})})}},183:function(e,n,t){t.r(n),t.d(n,{default:function(){return ce}});var r=t(3433),a=t(9439),i=t(7313),s=t(2751),c=t(1981),o=t(6250),l=t(6535),u=t(4165),d=t(4925),m=t(1413),h=t(5861),f=t(4942),p=t(72),_=t(4491),v=t(771),x={wrapper:"Form_wrapper__09h5k","form-header":"Form_form-header__hktGi","close-form":"Form_close-form__GAz5G","Field-group":"Form_Field-group__6OkGQ",label:"Form_label__I4yxr","form-btn-group":"Form_form-btn-group__DLlbt",btnSubmit:"Form_btnSubmit__n5KBY",btnReset:"Form_btnReset__tPmE9",input:"Form_input__emf-M"},g=t(259),j=t(1309),b=t(6417);function w(e,n){var t=(0,i.useState)(!0),c=(0,a.Z)(t,2),o=c[0],l=c[1],d=(0,i.useRef)(),w=(0,i.useRef)();return(0,i.useImperativeHandle)(n,(function(){return{toggleForm:function(){l((function(e){return!e}))}}})),o&&(0,b.jsxs)("div",{id:"form-wrapper",className:x.wrapper,children:[(0,b.jsxs)("div",{className:x["form-header"],children:[(0,b.jsx)("span",{children:e.tag.tag_name}),(0,b.jsx)("button",{className:x["close-form"],onClick:function(){return e.back()},children:(0,b.jsx)(g.G,{icon:j.g82})})]}),(0,b.jsxs)("form",{onReset:function(e){e.target.reset(),d.current.focus()},onSubmit:function(n){return function(e,n,t){n.preventDefault();var i=new FormData(n.target);n.target.reset();var c=Array.from(i.entries()).reduce((function(e,n){var t=(0,a.Z)(n,2),r=t[0],i=t[1];return"note"===r&&(i=i.replaceAll("\n","<br>")),(0,m.Z)((0,m.Z)({},e),{},(0,f.Z)({},r,i))}),{});(0,r.Z)(c.hanzi).filter((function(e){return/[\u4e00-\u9fa5]/g.test(e)})).length>0?v.Db.transaction("rw",v.Db.datas,(0,h.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v.Db.datas.add((0,m.Z)((0,m.Z)({_id:(0,s.x0)(5),tag_id:e.tag._id},c),{},{is_a_learned_word:!1,view_count:0,createdAt:new Date})).then((function(){t.current.focus(),_.Am.success("Add data sucessfully!",{position:_.Am.POSITION.BOTTOM_LEFT})}));case 2:case"end":return n.stop()}}),n)})))).catch(console.error):(t.current.focus(),_.Am.error("Faild to add data!",{position:_.Am.POSITION.BOTTOM_LEFT}))}(e,n,d)},children:[(0,b.jsxs)("div",{className:x["Field-group"],children:[(0,b.jsxs)("div",{className:x.item,children:[(0,b.jsx)("div",{className:x.label,children:"hanzi"}),(0,b.jsx)("input",{tabIndex:1,className:x.input,name:"hanzi",ref:d,onBlur:function(e){var n=e.target.value,t=n.length>2?{segment:"segmentit",group:!0}:{heteronym:!0};w.current.value=(0,p.ZP)(n,t).join(" , ")}})]}),(0,b.jsxs)("div",{className:x.item,children:[(0,b.jsx)("div",{className:x.label,children:"Pinyin"}),(0,b.jsx)("input",{tabIndex:-1,className:x.input,ref:w,name:"pinyin"})]})]}),(0,b.jsxs)("div",{className:x["Field-group"],children:[(0,b.jsxs)("div",{className:x.item,children:[(0,b.jsx)("div",{className:x.label,children:"Han Viet"}),(0,b.jsx)("input",{tabIndex:2,className:x.input,name:"han_viet"})," "]}),(0,b.jsxs)("div",{className:x.item,children:[(0,b.jsx)("div",{className:x.label,children:"Vietnamese"}),(0,b.jsx)("input",{tabIndex:2,className:x.input,name:"Vietnamese_meaning"})," "]})]}),(0,b.jsx)("div",{className:x.label,children:"note"}),(0,b.jsx)("textarea",{className:x.input,spellCheck:!1,name:"note",tabIndex:3}),(0,b.jsxs)("div",{className:x["form-btn-group"],children:[(0,b.jsx)("button",{type:"submit",tabIndex:4,className:x.btnSubmit,children:(0,b.jsx)(g.G,{icon:j.XCy})}),(0,b.jsx)("button",{type:"reset",tabIndex:5,className:x.btnReset,children:(0,b.jsx)(g.G,{icon:j.g82})})]})]})]})}var y=(0,i.forwardRef)(w),Z=t(4733),k=t(8566),N=t(7241),C=t(4976),T=t(1835),S="styles_ViewDetail-wrapper__twP2C",z="styles_header__vLVlz",I="styles_close-form__SMAWn",D="styles_wrapper__eCgvi",F="styles_HanziComponents-wrapper__sXnJP",R="styles_content-wrapper__zJ-Ts",L="styles_list__Ubz9m",A="styles_note__PY0i5",P="styles_footer__s4H31",O="checkbox_regular-checkbox__c1J35";function V(e,n){e.fn;var t=(0,i.useContext)(C.a7),s=(0,i.useState)({}),c=(0,a.Z)(s,2),o=c[0],l=c[1],u=o.hanzi?(0,r.Z)(o.hanzi).filter((function(e){return/[\u4e00-\u9fa5]/g.test(e)})):[];(0,i.useImperativeHandle)(n,(function(){return{setViewDetail:l}}));var d=(0,i.useCallback)((function(e,n){return null!==o&&void 0!==o&&o.hanzi?e.length>1?e.map((function(e,r){return(0,b.jsx)(T.default,{character:e,showPinyin:n.showPinyin,options:t.hanziComponentOptions},r)})):(0,b.jsx)(T.default,{character:e[0],showPinyin:n.showPinyin,options:t.hanziComponentOptions}):null}),[o]);return(null===o||void 0===o?void 0:o.hanzi)&&(0,b.jsxs)("div",{className:S,children:[(0,b.jsx)("div",{className:z,children:(0,b.jsx)("button",{className:I,onClick:function(){(0,N.se)("datas","_id",{key:o._id,field:"view_count",newValue:o.view_count+1}).then((function(){l({})}))},children:(0,b.jsx)(g.G,{icon:j.$9F})})}),(0,b.jsxs)("div",{className:D,children:[(0,b.jsx)("div",{className:F,children:d(u,{showPinyin:!1})}),(0,b.jsxs)("div",{className:R,children:[(0,b.jsxs)("ul",{className:L,children:[(0,b.jsxs)("li",{style:{cursor:"pointer"},onClick:function(){var e=new SpeechSynthesisUtterance(o.hanzi);speechSynthesis.speaking||(e.lang="zh-CN",e.volume=1,speechSynthesis.speak(e))},children:["hanzi : ",(0,b.jsx)("span",{children:o.hanzi})]}),(0,b.jsxs)("li",{children:["pinyin : ",(0,b.jsx)("span",{children:o.pinyin})]}),(0,b.jsxs)("li",{children:["Han Viet : ",(0,b.jsx)("span",{children:o.han_viet})]}),(0,b.jsxs)("li",{children:["Vietnamese :"," ",(0,b.jsx)("span",{children:o.Vietnamese_meaning})]})]}),(0,b.jsx)("div",{className:A,dangerouslySetInnerHTML:{__html:o.note}})]})]}),(0,b.jsxs)("div",{className:P,children:[(0,b.jsxs)("span",{children:["learned"," ",(0,b.jsx)("input",{className:O,type:"checkbox",id:"checkbox-1-2",defaultChecked:o.is_a_learned_word,onChange:function(e){return(0,N.se)("datas","_id",{key:o._id,field:"is_a_learned_word",newValue:e.target.checked})}}),(0,b.jsx)("label",{htmlFor:"checkbox-1-2"})]}),(0,b.jsxs)("span",{title:"View count",children:[(0,b.jsx)(g.G,{icon:j.Mdf,color:"hsl(163, 72%, 41%)"})," ",o.view_count]})]})]})}var G=(0,i.forwardRef)(V),H=function(e,n){var t="c-v"===n?"vietnamese":"chinese";return{_id:e._id,type:n,ui:"Translate",data:e,q:"translate [ ".concat(e["c-v"===n?"hanzi":"Vietnamese_meaning"]," ] to ").concat(t),answer:"".concat(e["c-v"===n?"Vietnamese_meaning":"hanzi"])}},E=function(e,n){if(n.listRender){for(var t=[["Vietnamese_meaning","hanzi"],["pinyin","hanzi"]],r=t.length,a=[[],[]],i=0;i<n.row;++i){var s=Math.floor(Math.random()*r);a[0][i]={a:e[i][t[s][0]],match:e[i][t[s][1]]},a[1][i]={b:e[i][t[s][1]],match:e[i][t[s][0]]}}(0,N.zz)(a[0]),(0,N.zz)(a[1]);for(var c={QuestionList:[],type:"Chooses",rows:n.row,isFinal:n.isFinal},o=0;o<a[0].length;++o)c.QuestionList.push({a:{q:a[0][o].a,match:a[0][o].match},b:{q:a[1][o].b,match:a[1][o].match}});return c}for(var l=void 0,u=0;u<e.length;u++)n.tempQTestArrayID.current.includes(e[u]._id)||(l=e[u]);if(l)return Math.random()>=.5?H(l,"c-v"):H(l,"v-c")},q=function(e,n){if(console.log(e.answer),!e.answer.trim())return{isOk:!0,match:100};var t=(0,r.Z)(e.answer.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),a=(0,r.Z)(n.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),i=.6*t.length,s=0,c=0;if("c-v"===e.type)for(var o=0;o<a.length;o++)t.includes(a[o])&&s++;if("v-c"===e.type){if(!e.data.Vietnamese_meaning.trim())return{isOk:!0,match:100};t.filter((function(e){return!!a.includes(e)&&(s++,!0)}))}for(var l=0;l<a.length;l++)t[l]===a[l]&&c++;return c===t.length?{isOk:!0,match:100}:s>i?{isOk:!0,match:~~(s/t.length*100)}:{isOk:!1,match:~~(s/t.length*100)}};function Q(e){var n=e.data,t=e.style;return(0,b.jsxs)("li",{style:(0,m.Z)({},t),className:o.Z.T_row,children:[(0,b.jsx)("div",{"data-selected":0,"data-match":n.a.match,onClick:function(n){n.stopPropagation(),e.match(n)},className:o.Z.Item,children:n.a.q}),(0,b.jsx)("div",{"data-selected":0,"data-match":n.b.q,onClick:function(n){n.stopPropagation(),e.match(n)},className:o.Z.Item,children:n.b.q})]})}var M={Translate:function(e){var n;return(0,b.jsxs)("div",{style:{width:"50%"},children:[(0,b.jsx)("div",{className:o.Z["T-text"],onClick:function(){if("c-v"===e.datas.type){var n=new SpeechSynthesisUtterance(e.datas.data.hanzi);speechSynthesis.speaking||(n.lang="zh-CN",n.volume=1,speechSynthesis.speak(n))}},children:null===(n=e.datas)||void 0===n?void 0:n.q}),(0,b.jsx)("div",{className:o.Z["T-form"],children:(0,b.jsx)("form",{onSubmit:e.handleSubmit,children:(0,b.jsx)("input",{type:"search",name:"answer"})})})]})},Chooses:function(e){var n=e.datas.QuestionList.length,t=(0,i.useRef)(0),r=(0,i.useRef)(null);(0,i.useEffect)((function(){return function(){t.current=0,r.current=null}}),[]);var a=function(a){if(!+a.target.dataset.selected)if(r.current)if(a.target.style.border="2px solid var(--BrightRed)",r.current.dataset.match===a.target.dataset.match){if(a.target.style.border="none",r.current.style.border="none",a.target.style.backgroundColor="var(--bg_green-hover)",r.current.style.backgroundColor="var(--bg_green-hover)",a.target.dataset.selected=1,r.current.dataset.selected=1,r.current=null,t.current++,t.current>=n&&!e.datas.isFinal)var i=setTimeout((function(){e.nextQuestion(),clearTimeout(i)}),1500);if(t.current>=n&&e.datas.isFinal)var s=setTimeout((function(){t.current=0,e.reset(!0),clearTimeout(s)}),1500)}else var c=setTimeout((function(){a.target.style.border="none",r.current.style.border="none",a.target.dataset.selected=0,r.current.dataset.selected=0,r.current=null,clearTimeout(c)}),500);else a.target.style.border="2px solid var(--BrightRed)",r.current=a.target,r.current.dataset.selected=1};return(0,b.jsx)("div",{className:o.Z["T-wrapper"],children:(0,b.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:(0,N.C1)(e.datas.QuestionList,5).map((function(e){return(0,b.jsx)("ul",{className:o.Z["T-list"],children:e.map((function(e){return(0,b.jsx)(Q,{data:e,style:{height:"calc(100% /5)"},match:a},(0,s.x0)(5))}))},(0,s.x0)(5))}))})})}};function U(e){var n=e.tag,t=e.datas,r=e.props,s=(0,i.useState)(!1),c=(0,a.Z)(s,2),l=c[0],d=c[1],m=(0,i.useState)({ui:"Translate"}),f=(0,a.Z)(m,2),p=f[0],_=f[1],x=(0,i.useRef)(),w=(0,i.useRef)([]),y=(0,i.useRef)({UI:M[(null===p||void 0===p?void 0:p.ui)||"Translate"]});(0,i.useLayoutEffect)((function(){console.log("reset"),y.current={UI:M[(null===p||void 0===p?void 0:p.ui)||"Translate"]}}),[l,null===p||void 0===p?void 0:p.ui]),(0,i.useEffect)((function(){return l&&(y.current={UI:M.Translate}),(0,h.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.Db.tags.orderBy("id").toArray();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return e._id===n._id}))[0].QTestArrayID);case 4:case"end":return e.stop()}}),e)})))().then((function(e){w.current=e,e.length===t.length?d(!0):_(E(t,{tempQTestArrayID:w}))})),(0,h.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.se)("tags","_id",{key:n._id,field:"QTestArrayID",newValue:w.current}).then((function(){w.current=[]}));case 2:case"end":return e.stop()}}),e)})))}),[]);var Z=l?100:~~(w.current.length/t.length*100),k=(0,b.jsx)("button",{type:"reset",onClick:function(){(0,N.se)("tags","_id",{key:n._id,field:"QTestArrayID",newValue:[]}).then((function(){w.current=[],d(!1),_(E(t,{tempQTestArrayID:w}))}))},children:"reset"});return(0,b.jsx)("div",{className:o.Z["test-wrapper"],children:(0,b.jsxs)("div",{className:o.Z["test-container"],ref:x,"data-match":0,"data-progress":Z,children:[(0,b.jsx)("button",{className:o.Z["close-btn"],onClick:function(){r.back()},children:(0,b.jsx)(g.G,{icon:j.g82})}),l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h3",{children:"test complited!"}),k]}):(0,b.jsx)(y.current.UI,{datas:p,handleSubmit:function(e){e.preventDefault();var n=Array.from(new FormData(e.target).entries())[0][1],r=q(p,n);x.current.dataset.match="match : ".concat(r.match," %"),x.current.style.border="2px solid ".concat(r.isOk?"var(--LimeGreen)":"var(--BrightRed)"),r.isOk&&w.current.push(p._id);var a=setTimeout((function(){if(clearTimeout(a),x.current.style.border="2px solid var(--boder-color)",x.current.dataset.match="match : 0 %",w.current.length===t.length)return y.current={UI:M.Chooses},void _(E(t,{isFinal:!0,listRender:!0,row:t.length}));if(r.isOk){var n=Math.floor(Math.random()*t.length);switch(n){case 2:case 4:case 6:y.current={UI:M.Chooses},_(E(t,{isFinal:!1,listRender:!0,row:n}));break;default:_(E(t,{tempQTestArrayID:w}))}}e.target.reset()}),1500)},reset:d,nextQuestion:function(){_(E(t,{tempQTestArrayID:w}))}})]})})}var B=["style"],J=16,X={POSITION:_.Am.POSITION.BOTTOM_CENTER},Y={View:Symbol("view"),Form:Symbol("form"),Quiz:Symbol("quiz")},W={CardItem:Symbol("card"),ListItem:Symbol("item")};function K(e,n){return $.apply(this,arguments)}function $(){return $=(0,h.Z)((0,u.Z)().mark((function e(n,t){var a,i=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e){var a=e[n].split(" "),i=t.split(" ");return"hanzi"===n?(0,r.Z)(e.hanzi).some((function(e){return(0,r.Z)(t).includes(e)})):a.some((function(e){return i.includes(e.toLowerCase())}))},"global"!==(i.length>2&&void 0!==i[2]?i[2]:"global")){e.next=4;break}return e.abrupt("return",v.Db.transaction("rw",v.Db.datas,(0,h.Z)((0,u.Z)().mark((function e(){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.Db.datas.orderBy("_id").filter(a).toArray();case 2:return n=e.sent,e.abrupt("return",Promise.resolve(n));case 4:case"end":return e.stop()}}),e)})))));case 4:return e.abrupt("return",Promise.resolve(JSON.parse(sessionStorage.getItem("cache-data")).filter(a)||[]));case 5:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function ee(e){var n=e.tagActive,t=e.props,r=e.datas;return(0,b.jsx)("ul",{className:o.Z.ul,children:null===r||void 0===r?void 0:r.map((function(e){return(0,b.jsxs)("li",{onClick:function(){var n;null===(n=t.viewDetailRef.current)||void 0===n||n.setViewDetail(e)},children:[(0,b.jsx)("span",{onClick:function(n){n.stopPropagation();var t=new SpeechSynthesisUtterance(e.hanzi);speechSynthesis.speaking||(t.lang="zh-CN",t.volume=1,speechSynthesis.speak(t))},children:e.hanzi}),(0,b.jsx)("span",{children:e.pinyin}),(0,b.jsx)("span",{children:e.han_viet}),(0,b.jsx)("span",{children:e.Vietnamese_meaning}),(0,b.jsx)("button",{onClick:function(r){r.stopPropagation(),(0,N.se)("tags","_id",{key:n._id,field:"QTestArrayID",newValue:n.QTestArrayID.filter((function(n){return n!==e._id}))}).then((function(){(0,N.D2)("datas","_id",e._id).then((function(){_.Am.info("deleted : ".concat(e._id),X),(0,N.Li)("datas","tag_id",{key:n._id}).then(t.fn.setDatas)}))}))},children:(0,b.jsx)(g.G,{icon:j.Vui,color:"var(--BrightRed"})})]},e._id)}))})}function ne(e,n){var t=(0,i.useRef)(),r=(0,i.useRef)(),s=(0,i.useState)(""),c=(0,a.Z)(s,2),l=c[0],u=c[1],h=(0,i.useState)(Y.View),f=(0,a.Z)(h,2),p=f[0],_=f[1],v=(0,i.useState)(W.ListItem),x=(0,a.Z)(v,2),w=x[0],C=x[1],T=(0,i.useState)([]),S=(0,a.Z)(T,2),z=S[0],I=S[1];(0,i.useImperativeHandle)(n,(function(){return{setTag:u}})),(0,i.useEffect)((function(){(0,N.Li)("datas","tag_id",{key:l._id}).then(I)}),[l,p]),(0,i.useEffect)((function(){return sessionStorage.setItem("cache-data",JSON.stringify(z)),function(){sessionStorage.setItem("cache-data",JSON.stringify([]))}}),[l,z]);var D=(0,i.useCallback)((function(e){e.preventDefault();var n=(0,N.Fm)(e),t=n["search-value"].trim().toLowerCase();t&&(n["search-wrapper"]?K(n["search-type"],t).then(I):K(n["search-type"],t,"local").then(I))}),[]);return(0,b.jsxs)("div",{className:o.Z.wrapper,children:[p===Y.View&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(G,{ref:r}),(0,b.jsx)("div",{ref:t,className:o.Z["list-wrapper"],children:w!==W.ListItem?(0,b.jsx)(k.Z,{children:function(e){var n=e.height,t=e.width,a=5;t<920&&(a=4),t<645&&(a=3),t<375&&(a=2);var s=(0,N.C1)(z,a);return(0,b.jsx)(Z.Ym,{className:"List",columnWidth:t/a-J/a,rowHeight:n/2,innerElementType:(0,i.forwardRef)((function(e,n){var t=e.style,r=(0,d.Z)(e,B);return(0,b.jsx)("div",(0,m.Z)({ref:n,style:(0,m.Z)((0,m.Z)({},t),{},{paddingLeft:J,paddingTop:J})},r))})),rowCount:s.length,columnCount:a,height:n,width:t,children:function(e){var n=e.columnIndex,t=e.rowIndex,a=e.style;return function(e,n,t){return(0,b.jsx)(b.Fragment,{children:e&&(0,b.jsx)("div",{style:(0,m.Z)((0,m.Z)({},n),{},{left:n.left+J,top:n.top+J,width:n.width-J,height:n.height-J}),className:o.Z.card,children:(0,b.jsxs)("div",{className:o.Z.content,onClick:function(){var n;null===(n=t.viewDetailRef.current)||void 0===n||n.setViewDetail(e)},children:[(0,b.jsx)("div",{className:o.Z.front,children:e.hanzi}),(0,b.jsx)("div",{className:o.Z.back,children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:e.pinyin}),(0,b.jsx)("div",{children:e.han_viet}),(0,b.jsx)("div",{children:e.Vietnamese_meaning})]})})]})},e._id)})}(s[t][n],a,{viewDetailRef:r,tag:l,setDatas:I})}})}}):(0,b.jsx)(ee,{datas:z,tagActive:l,props:{viewDetailRef:r,fn:I}})}),(0,b.jsx)("div",{className:o.Z.bt_bar,children:(0,b.jsxs)("div",{className:o.Z.wrapper,children:[(0,b.jsx)("label",{className:o.Z["slide-input"],children:(0,b.jsx)("input",{onChange:function(e){null===t||void 0===t||t.current.style.setProperty("--Hanzi_FontSize","".concat(e.target.value,"rem"))},type:"range",defaultValue:2.5,step:.5,min:1,max:5})}),(0,b.jsxs)("div",{className:o.Z["search-wrapper"],children:[(0,b.jsxs)("form",{onSubmit:D,children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("select",{name:"search-type",children:[(0,b.jsx)("option",{value:"hanzi",defaultValue:"hanzi",children:"hanzi"}),(0,b.jsx)("option",{value:"pinyin",children:"pinyin"}),(0,b.jsx)("option",{value:"Vietnamese_meaning",children:"Vietnamese"})]}),(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"checkbox",defaultChecked:!0,name:"search-wrapper"})," ","-g"]})]}),(0,b.jsxs)("div",{className:o.Z["input-wrapper"],children:[(0,b.jsx)("input",{type:"search",name:"search-value",placeholder:"search ..."}),(0,b.jsx)("button",{type:"submit",children:(0,b.jsx)(g.G,{icon:j.wn1})})]})]}),(0,b.jsx)("button",{onClick:function(){(0,N.Li)("datas","tag_id",{key:l._id}).then(I)},children:(0,b.jsx)(g.G,{icon:j.QDM})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{title:"form",onClick:function(){return _(Y.Form)},children:(0,b.jsx)(g.G,{icon:j.yXf})}),(0,b.jsx)("button",{onClick:function(){return _(Y.Quiz)},children:(0,b.jsx)(g.G,{icon:j.qxT})}),(0,b.jsx)("button",{onClick:function(){C((function(e){return e===W.ListItem?W.CardItem:W.ListItem}))},children:(0,b.jsx)(g.G,{color:"".concat(w===W.ListItem?"var(--LimeGreen)":""),icon:j.ZYZ})})]})]})})]}),p===Y.Form&&(0,b.jsx)("div",{className:o.Z["form-wrapper"],children:(0,b.jsx)(y,{tag:l,back:function(){_(Y.View)}})}),p===Y.Quiz&&(0,b.jsx)(U,{tag:l,datas:z,props:{back:function(){_(Y.View)}}})]})}var te=(0,i.forwardRef)(ne),re=i.lazy((function(){return Promise.resolve().then(t.bind(t,1835))})),ae=i.lazy((function(){return t.e(608).then(t.bind(t,7608))})),ie=i.lazy((function(){return t.e(793).then(t.bind(t,8793))}));function se(e,n){var t=(0,i.useRef)(),u=(0,i.useRef)(),d=(0,i.useState)([]),m=(0,a.Z)(d,2),h=m[0],f=m[1],p=(0,i.useState)(null),_=(0,a.Z)(p,2),v=_[0],x=_[1],g=(0,i.useCallback)((function(n){var t=n.detail;if(t){var a=(0,r.Z)(t).join(" ").trim().split(/\s+/).filter((function(e){return/[\u4e00-\u9fa5]/g.test(e)})).map((function(e){return{Char_id:(0,s.x0)(5),char:e}}));f(a),e.onHistoryChange({_id:(0,s.x0)(5),_value:t})}else f([])}),[]);return(0,i.useEffect)((function(){return(0,l.on)("emitData",g),function(){(0,l.S1)("emitData",g)}}),[]),(0,i.useImperativeHandle)(n,(function(){var e;return{setArrayOfHanzi:function(e){if("view_pinyin"!==v){var n=(0,r.Z)(e).join(" ").trim().split(/\s+/).filter((function(e){return/[\u4e00-\u9fa5]/g.test(e)})).map((function(e){return{Char_id:(0,s.x0)(5),char:e}}));f(n)}else(0,l.X$)("toPinyin",e)},setScreen:x,setTag:null===(e=u.current)||void 0===e?void 0:e.setTag,getFormData:g,addTab:function(e){var n;null===(n=t.current)||void 0===n||n.addNewTab(e),h.length&&f([])}}})),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(i.Suspense,{fallback:(0,b.jsx)("div",{children:"Loading..."}),children:["viewr_char"===v&&(0,b.jsxs)("div",{className:o.Z.view_char_wrapper,children:[(0,b.jsx)(c.Z,{ttsp:"App-view-id"}),(0,b.jsx)("div",{id:"App-view-id",className:o.Z["App-viewer"],children:h.map((function(n){var t=n.Char_id,r=n.char;return(0,b.jsx)(re,{character:r,options:e.hanziComponentOptions},t)}))})]}),"view_pinyin"===v&&(0,b.jsx)(ie,{hanziComponentOptions:e.hanziComponentOptions}),"note"===v&&(0,b.jsx)(ae,{ref:t})]}),"tags"===v&&(0,b.jsx)(te,{ref:u})]})}var ce=(0,i.forwardRef)(se)},6535:function(e,n,t){function r(e,n){document.addEventListener(e,n)}function a(e,n){document.removeEventListener(e,n)}function i(e,n){var t=new CustomEvent(e,{detail:n});document.dispatchEvent(t)}t.d(n,{S1:function(){return a},X$:function(){return i},on:function(){return r}})},6250:function(e,n){n.Z={"App-viewer":"main_App-viewer__daWhl",view_char_wrapper:"main_view_char_wrapper__GUE+C",wrapper:"main_wrapper__sdIYc",header:"main_header__3tX03","ml-auto":"main_ml-auto__fSPg5",btns:"main_btns__KQE-4",p_wp:"main_p_wp__lO+D5",hanzi_:"main_hanzi___mHki6","text-wrapper":"main_text-wrapper__9cRri",char_wrapper:"main_char_wrapper__1xmmw",char_pinyin:"main_char_pinyin__5ZAKQ",char_hanzi:"main_char_hanzi__ryER9","slide-input":"main_slide-input__WMIv2",main:"main_main__+3qZg","flex-row":"main_flex-row__0PHK6","main-content":"main_main-content__SWJRq","list-wrapper":"main_list-wrapper__xbh9D",card:"main_card__wZbH1",content:"main_content__-BumF",front:"main_front__0T9mG",back:"main_back__YexG-",ul:"main_ul__bnnev",bt_bar:"main_bt_bar__-F7ub","search-wrapper":"main_search-wrapper__AJ+lz","input-wrapper":"main_input-wrapper__bOp7n","test-wrapper":"main_test-wrapper__hq2Dy","test-container":"main_test-container__Zp3Ye","close-btn":"main_close-btn__rMuza","T-text":"main_T-text__RvitD","T-form":"main_T-form__TE9B6","T-wrapper":"main_T-wrapper__PPm--","T-submit":"main_T-submit__xy73m","T-list":"main_T-list__4fZy3",T_row:"main_T_row__23N2P",Item:"main_Item__6khwV"}}}]);