"use strict";(self.webpackChunkxie_han_zi=self.webpackChunkxie_han_zi||[]).push([[766],{1766:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var r=n(4165),a=n(5861),s=n(9439),i=n(1413),c=n(3433),l=n(7313),u=n(3304),o=n(2751),d=n(259),h=n(1309),f=n(6250),m=n(771),x=n(2352),v=n(7241),g=n(6169),p=n(6417),j=function(e,t){return{_id:e._id,type:t,ui:"Translate",data:e,translateText:e["c-v"===t?"hanzi":"Vietnamese_meaning"],lang:"c-v"===t?"Vi\u1ec7t":"Trung",answer:"".concat(e["c-v"===t?"Vietnamese_meaning":"hanzi"])}},y=function(e,t){if(t.listRender){for(var n=[["Vietnamese_meaning","hanzi"],["pinyin","hanzi"]],r=n.length,a=[[],[]],s=0;s<t.row;++s){var i=Math.floor(Math.random()*r);a[0][s]={a:e[s][n[i][0]],match:e[s][n[i][1]]},a[1][s]={b:e[s][n[i][1]],match:e[s][n[i][0]]}}for(var c={QuestionList:[],type:"Chooses",rows:t.row,isFinal:t.isFinal},l=(0,v.C1)(a[0],5),u=(0,v.C1)(a[1],5),o=0;o<l.length;++o){(0,v.zz)(l[o]),(0,v.zz)(u[o]);for(var d=[],h=0;h<l[o].length;++h)d.push({a:{q:l[o][h].a,match:l[o][h].match},b:{q:u[o][h].b,match:u[o][h].match}});c.QuestionList.push(d)}return c}for(var f=void 0,m=0;m<e.length;m++)t.tempQTestArrayID.current.includes(e[m]._id)||(f=e[m]);if(f)return Math.random()>=.5?j(f,"c-v"):j(f,"v-c")},b=function(e,t){if(!e.answer.trim())return{isOk:!0,match:100};var n=(0,c.Z)(e.answer.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),r=(0,c.Z)(t.toLowerCase()).filter((function(e){return![" ",","].includes(e)})),a=.6*n.length,s=0,i=0;if("c-v"===e.type)for(var l=0;l<r.length;l++)n.includes(r[l])&&s++;if("v-c"===e.type){if(!e.data.Vietnamese_meaning.trim())return{isOk:!0,match:100};n.filter((function(e){return!!r.includes(e)&&(s++,!0)}))}for(var u=0;u<r.length;u++)n[u]===r[u]&&i++;return i===n.length?{isOk:!0,match:100}:s>a?{isOk:!0,match:~~(s/n.length*100)}:{isOk:!1,match:~~(s/n.length*100)}};function Z(e){var t=e.data,n=e.style,r=e.index,a=(0,l.useRef)();return(0,l.useEffect)((function(){var e=a.current;e.style.transition="all ".concat(500*(r+1),"ms ease"),e.classList.add(f.Z.opacity)}),[]),(0,p.jsxs)("li",{ref:a,style:(0,i.Z)({},n),className:f.Z.T_row,children:[(0,p.jsx)("div",{"data-selected":0,"data-match":t.a.match,onClick:e.match,className:f.Z.Item,children:t.a.q}),(0,p.jsx)("div",{"data-selected":0,"data-match":t.b.q,onClick:e.match,className:f.Z.Item,children:t.b.q})]},(0,o.x0)(12))}var T={Translate:function(e){var t,n,r,a=(0,l.useRef)(null),s=e.state,i=s.index,c=s.length,u=s.incorrect,o=s.score,m=s.Q_ignore,x=null===(t=e.datas)||void 0===t?void 0:t.type;return(0,p.jsxs)("div",{className:f.Z["Q-wrapper"],children:[(0,p.jsx)("header",{children:!("c-v"===x&&m)&&(0,p.jsxs)(p.Fragment,{children:["D\u1ecbch t\u1eeb v\u1ef1ng ph\xeda d\u01b0\u1edbi sang ti\u1ebfng"," ",null===(n=e.datas)||void 0===n?void 0:n.lang]})}),(0,p.jsxs)("main",{children:[(0,p.jsx)("div",{className:f.Z["T-Item"],onClick:function(){"c-v"===x&&(0,v.rU)(e.datas.data.hanzi)},children:(0,p.jsxs)("div",{className:f.Z.text_wp,children:[(0,p.jsx)("div",{style:{cursor:"pointer"},children:null===(r=e.datas)||void 0===r?void 0:r.translateText}),"c-v"===x?(0,p.jsx)("span",{children:e.datas.data.pinyin}):null]})}),(0,p.jsx)("div",{className:f.Z["T-Item"],children:"c-v"===x&&m?(0,p.jsxs)("div",{className:f.Z.text_wp,children:[(0,p.jsx)("span",{"data-answer":!0,children:e.datas.answer}),(0,p.jsx)("button",{title:"next questions",className:f.Z["next-btn"],onClick:function(){return e.handleSubmit()},children:(0,p.jsx)(d.G,{icon:h.cLY})})]}):(0,p.jsx)("form",{onSubmit:function(t){e.handleSubmit(t,a.current),t.target.children[0].disabled=!0},children:(0,p.jsx)("input",{type:"text",name:"answer",autoComplete:"off",placeholder:"nh\u1eadp b\u1ea3n d\u1ecbch"})})})]}),(0,p.jsxs)("footer",{ref:a,children:[(0,p.jsxs)("div",{className:f.Z.state,children:[(0,p.jsxs)("div",{className:f.Z["flex-row"],children:[(0,p.jsx)("span",{title:"index",style:{color:"var(--text-color)"},children:i})," / ",(0,p.jsx)("span",{title:"total questions",children:c})]}),(0,p.jsxs)("div",{children:["incorrect :"," ",(0,p.jsx)("span",{title:"incorrect",style:{color:"var(--BrightRed)"},children:u})]}),(0,p.jsxs)("div",{children:["score :"," ",(0,p.jsx)("span",{style:{color:"var(--LimeGreen)"},children:o})]})]}),(0,p.jsx)("div",{className:f.Z["display-status"]})]})]})},Chooses:function(e){var t,n=(0,l.useState)(0),r=(0,s.Z)(n,2),a=r[0],i=r[1],c=(0,l.useRef)(0),u=(0,l.useRef)(null);if((0,l.useEffect)((function(){return function(){c.current=0,u.current=null}}),[]),e.datas.QuestionList){var d=null===(t=e.datas)||void 0===t?void 0:t.QuestionList[a].length,h=function(t){if(t.stopPropagation(),!+t.target.dataset.selected)if(u.current)if(t.target.style.border="2px solid var(--BrightRed)",u.current.dataset.match===t.target.dataset.match){if(t.target.style.border="none",u.current.style.border="none",t.target.style.backgroundColor="var(--bg_green-hover)",u.current.style.backgroundColor="var(--bg_green-hover)",t.target.dataset.selected=1,u.current.dataset.selected=1,u.current=null,c.current++,c.current>=d&&!e.datas.isFinal)var n=setTimeout((function(){e.nextQuestion(),clearTimeout(n)}),1500);if(c.current>=d&&e.datas.isFinal)var r=setTimeout((function(){if(c.current=0,clearTimeout(r),a<e.datas.QuestionList.length-1)return i((function(e){return e+1})),void clearTimeout(r);e.reset(!0)}),1500)}else var s=setTimeout((function(){t.target.style.border="none",u.current.style.border="none",t.target.dataset.selected=0,u.current.dataset.selected=0,u.current=null,clearTimeout(s)}),500);else t.target.style.border="2px solid var(--BrightRed)",u.current=t.target,u.current.dataset.selected=1};return(0,p.jsx)("div",{className:f.Z["T-wrapper"],children:(0,p.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:(0,p.jsx)("ul",{className:f.Z["T-list"],children:e.datas.QuestionList[a].map((function(e,t){return(0,p.jsx)(Z,{index:t,data:e,style:{height:"calc(100% /5)"},match:h},(0,o.x0)(12))}))},(0,o.x0)(5))})})}}};function w(e){var t=e.tag,n=e.datas,i=e.props,c=(0,l.useState)(!1),o=(0,s.Z)(c,2),j=o[0],Z=o[1],w=(0,l.useState)({}),_=(0,s.Z)(w,2),k=_[0],C=_[1],N=(0,x.Z)(!1),Q=(0,s.Z)(N,2),R=Q[0],I=Q[1],L=(0,l.useRef)({UI:T.Translate}),z=(0,l.useRef)([]),D=(0,l.useRef)(0),F=(0,l.useRef)(t.MaxScore||0),S=(0,l.useRef)(0),V=(0,l.useRef)(0),A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.round(100/n.length*e/100)},M=function(){return C(y(n,{tempQTestArrayID:z}))},q={index:z.current.length,length:n.length,incorrect:S.current,score:D.current,Q_ignore:R};return(0,u.Z)(["Escape"],i.back,g.c),(0,l.useLayoutEffect)((function(){L.current={UI:T.Translate},D.current>F.current&&0!==F.current&&(F.current=D.current)}),[j,k]),(0,l.useEffect)((function(){return(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Db.tags.orderBy("id").toArray();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e._id===t._id}))[0].QTestArrayID);case 4:case"end":return e.stop()}}),e)})))().then((function(e){z.current=e,e.length===n.length?Z(!0):M()})),(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("update tempQTestArrayID"),!t._id){e.next=7;break}return e.next=4,(0,v.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:z.current}).then((function(){z.current=[]}));case 4:if(0===D.current){e.next=7;break}return e.next=7,(0,v.se)("tags","_id",{key:t._id,field:"MaxScore",newValue:D.current}).then((function(){D.current=0,F.current=0}));case 7:case"end":return e.stop()}}),e)})))}),[]),(0,p.jsx)("div",{className:f.Z["test-wrapper"],children:(0,p.jsxs)("div",{className:f.Z["test-container"],children:[(0,p.jsxs)("div",{className:f.Z.tag,children:["#","[ ",t.tag_name," ]"]}),(0,p.jsxs)("label",{className:f.Z["test-setting"],htmlFor:"next",children:[(0,p.jsx)("input",{id:"next",type:"checkbox",onChange:I})," ",(0,p.jsx)("span",{children:"d\u1ecbch t\u1eeb Ch->Vn"})]}),(0,p.jsx)("button",{title:"press Esc to close",className:f.Z["close-btn"],onClick:i.back,children:(0,p.jsx)(d.G,{icon:h.g82})}),j?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:"\u0110\xe3 ho\xe0n th\xe0nh"}),F.current&&(0,p.jsxs)("div",{children:["max score : ",F.current]}),(0,p.jsxs)("div",{children:["score : ",D.current]}),(0,p.jsx)("button",{type:"reset",onClick:function(){(0,v.se)("tags","_id",{key:t._id,field:"QTestArrayID",newValue:[]}).then((function(){V.current=0,S.current=0,z.current=[],Z(!1),M()}))},children:"reset"})]}):(0,p.jsx)(L.current.UI,{datas:k,state:q,handleSubmit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return z.current.push(k._id),M();if(e.preventDefault(),z.current.length===n.length)return L.current={UI:T.Chooses},C(y(n,{isFinal:!0,listRender:!0,row:n.length}));var r=Array.from(new FormData(e.target).entries())[0][1],a=b(k,r);a.match?100===a.match?(D.current+=A(a.match),t.children[1].innerText="ch\xednh x\xe1c \ud83d\ude00"):(a.match>60&&(D.current+=A(a.match-20)),a.match>80&&(D.current+=A(a.match)),t.children[1].innerText="g\u1ea7n \u0111\xfang \ud83d\ude05 ( ".concat(a.match,"%)")):(++V.current,D.current-=A(100),t.children[1].innerText="sai r\u1ed3i \ud83d\ude2d"),a.isOk?z.current.push(k._id):(++V.current,V.current>1&&(++S.current,t.children[1].innerText="\u0111\xe1p \xe1n : ".concat(k.answer)));var s=setTimeout((function(){if(e.target.children[0].disabled=!1,e.target.children[0].focus(),t.children[1].innerText="",a.isOk){V.current=0;var r=Math.floor(Math.random()*n.length);r>2&&r<7?(L.current={UI:T.Chooses},C(y(n,{isFinal:!1,listRender:!0,row:r}))):M()}else V.current>=2&&(V.current=0,M());e.target.reset(),clearTimeout(s)}),1800)},reset:Z,nextQuestion:M})]})})}}}]);